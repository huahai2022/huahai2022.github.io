<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ¦‚ç‡æ‰©å±•æ¨¡å‹</title>
      <link href="/2023/07/25/gai-lu-kuo-zhan-mo-xing/"/>
      <url>/2023/07/25/gai-lu-kuo-zhan-mo-xing/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.bilibili.com/video/BV1b541197HX/?spm_id_from=333.999.0.0&amp;vd_source=b176201190025ae11ffeced1d766effe">54ã€Probabilistic Diffusion Modelæ¦‚ç‡æ‰©æ•£æ¨¡å‹ç†è®ºä¸å®Œæ•´PyTorchä»£ç è¯¦ç»†è§£è¯»_å“”å“©å“”å“©_bilibili</a>   Bç«™æ‰æ˜¯æˆ‘çš„å¤§å­¦ï¼ŒğŸ™</p><p><img src="https://i0.hdslb.com/bfs/new_dyn/a180978fc2337febe001ab17001a6a27373596439.jpg@1048w_!web-dynamic.webp" alt="img"></p><p>Diffusion modelæ˜¯ä¸€ç§æ–°çš„æœ€å…ˆè¿›çš„ç”Ÿæˆæ¨¡å‹ï¼Œå¯ä»¥ç”Ÿæˆå¤šæ ·åŒ–çš„é«˜åˆ†è¾¨ç‡å›¾åƒã€‚åœ¨OpenAIã€Nvidiaå’ŒGoogleæˆåŠŸè®­ç»ƒå¤§å‹æ¨¡å‹åï¼Œå®ƒä»¬å·²ç»å¼•èµ·äº†å¾ˆå¤šå…³æ³¨ã€‚åŸºäºæ‰©æ•£æ¨¡å‹çš„ç¤ºä¾‹æ¶æ„åŒ…æ‹¬GLIDEã€DALLE-2ã€Imagenå’Œå®Œæ•´çš„å¼€æºstable diffusionã€‚</p><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230726211313770.png" alt="image-20230726211313770"></p><h1 id="Outline"><a href="#Outline" class="headerlink" title="Outline"></a>Outline</h1><h5 id="1-Introduction-Denoising-Diffusion-Model"><a href="#1-Introduction-Denoising-Diffusion-Model" class="headerlink" title="1.Introduction(Denoising Diffusion Model)"></a>1.Introduction(Denoising Diffusion Model)</h5><p>Diffusion Modelsæ˜¯ç”Ÿæˆæ¨¡å‹ï¼Œæ„å‘³ç€å®ƒä»¬ç”¨äºç”Ÿæˆä¸å®ƒä»¬è®­ç»ƒçš„æ•°æ®ç±»ä¼¼çš„æ•°æ®ã€‚ä»æ ¹æœ¬ä¸Šè®²ï¼ŒDiffusion Modelsé€šè¿‡è¿ç»­æ·»åŠ Gaussian noiseæ¥ç ´åè®­ç»ƒæ•°æ®ï¼Œç„¶åå­¦ä¹ é€šè¿‡åè½¬è¿™ä¸ªåŠ noisingçš„è¿‡ç¨‹æ¥æ¢å¤æ•°æ®ã€‚è®­ç»ƒåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†éšæœºæŠ½æ ·çš„noiseé€šè¿‡å­¦ä¹ å¾—åˆ°çš„denoisingè¿‡ç¨‹æ¥ç”Ÿæˆæ•°æ®ã€‚</p><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230726211913551.png" alt="image-20230726211913551"></p><p>GANå’ŒVAEæ˜¯ä¸¤ç§é‡è¦çš„ç”Ÿæˆæ¨¡å‹ï¼Œåœ¨å¤šä¸ªåº”ç”¨ä¸­éƒ½å–å¾—äº†å¾ˆå¤§çš„æˆåŠŸå’Œè®¤å¯ã€‚GANè¡¨ç°å‡ºè‰²ï¼Œä½†æ˜¯ç”±äºå¤šç§æŒ‘æˆ˜ï¼ˆä¾‹å¦‚mode collapseå’Œvanishing gradientsç­‰ï¼‰ï¼Œå…¶è¾“å‡ºç¼ºä¹å¤šæ ·æ€§ï¼Œä¸”å¾ˆéš¾è®­ç»ƒã€‚VAEæœ‰æœ€ç¨³å›ºçš„ç†è®ºåŸºç¡€ï¼Œä½†æ˜¯åœ¨VAEä¸­å»ºæ¨¡è‰¯å¥½çš„æŸå¤±å‡½æ•°æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œè¿™ä½¿å¾—å®ƒä»¬çš„è¾“å‡ºæ˜¯æ¬¡ä¼˜çš„ã€‚</p><p>Diffusion Modelingçš„å…³é”®æ¦‚å¿µåœ¨äºï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå»ºç«‹ä¸€ä¸ªå­¦ä¹ æ¨¡å‹ï¼Œèƒ½å¤Ÿå­¦ä¹ ç”±äºå™ªå£°è€Œå¯¼è‡´çš„ä¿¡æ¯ç³»ç»Ÿæ€§è¡°å‡ï¼Œé‚£ä¹ˆå°±åº”è¯¥èƒ½å¤Ÿåè½¬è¿™ä¸ªè¿‡ç¨‹ï¼Œä»å™ªå£°ä¸­æ¢å¤ä¿¡æ¯ã€‚è¿™ä¸ªæ¦‚å¿µä¸VAEç›¸ä¼¼ï¼Œå®ƒå°è¯•é€šè¿‡é¦–å…ˆå°†æ•°æ®æŠ•å½±åˆ°æ½œåœ¨ç©ºé—´ï¼Œç„¶åå°†å…¶æ¢å¤åˆ°åˆå§‹çŠ¶æ€æ¥ä¼˜åŒ–ç›®æ ‡å‡½æ•°ã€‚ç„¶è€Œï¼Œç³»ç»Ÿçš„ç›®æ ‡ä¸æ˜¯å­¦ä¹ æ•°æ®åˆ†å¸ƒï¼Œè€Œæ˜¯åœ¨Markové“¾ä¸­å»ºæ¨¡ä¸€ç³»åˆ—å™ªå£°åˆ†å¸ƒï¼Œå¹¶é€šè¿‡åˆ†å±‚æ–¹å¼æ¥è§£ç æ•°æ®ï¼Œä»è€Œæ’¤æ¶ˆ/æ¶ˆé™¤æ•°æ®ä¸­çš„å™ªå£°ã€‚<img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230726213728259.png" alt="image-20230726213728259"></p><p>Diffusion modelå¯ä»¥è¢«çœ‹ä½œæ˜¯latent variable modelã€‚latent variableæ„å‘³ç€æˆ‘ä»¬æ˜¯æŒ‡ä¸€ä¸ªéšè—çš„è¿ç»­ç‰¹å¾ç©ºé—´ã€‚è¿™æ ·ï¼Œå®ƒä»¬å¯èƒ½çœ‹èµ·æ¥ç±»ä¼¼äºvariational autoencoders (VAEs)ã€‚</p><p>æœ‰å‡ ç§åŸºäºæ‰©æ•£çš„ç”Ÿæˆæ¨¡å‹æå‡ºäº†ç±»ä¼¼çš„æƒ³æ³•ï¼ŒåŒ…æ‹¬diffusion probabilistic modelsï¼ˆSohl-Dickstein et al.ï¼Œ2015å¹´ï¼‰ï¼Œnoise-conditioned score networkï¼ˆNCSN; Yangï¼†Ermonï¼Œ2019å¹´ï¼‰å’Œdenoising diffusion probabilistic modelsï¼ˆDDPM; Hoç­‰äººï¼Œ2020å¹´ï¼‰ã€‚</p><p>åœ¨å®è·µä¸­ï¼ŒDiffusion modelä½¿ç”¨äº†Tæ­¥çš„Markové“¾æ¥å»ºæ¨¡ã€‚è¿™é‡Œï¼ŒMarkové“¾æ„å‘³ç€æ¯ä¸€æ­¥åªä¾èµ–äºå‰ä¸€æ­¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¸©å’Œçš„å‡è®¾ã€‚é‡è¦çš„æ˜¯ï¼Œä¸ flow-based modelsä¸åŒï¼Œæˆ‘ä»¬ä¸å—é™äºä½¿ç”¨ç‰¹å®šç±»å‹çš„ç¥ç»ç½‘ç»œã€‚</p><p>æ›´å…·ä½“åœ°è¯´ï¼ŒDiffusion Modelæ˜¯ä¸€ç§æ½œåœ¨å˜é‡æ¨¡å‹ï¼Œä½¿ç”¨å›ºå®šçš„Markové“¾å°†æ•°æ®æ˜ å°„åˆ°æ½œåœ¨ç©ºé—´ã€‚è¯¥é“¾é€æ¸æ·»åŠ å™ªå£°åˆ°æ•°æ®ä¸­ï¼Œä»¥è·å¾—è¿‘ä¼¼åéªŒq(x1:T | x0)åˆ†å¸ƒï¼Œå…¶ä¸­x1,â€¦.XTæ˜¯å…·æœ‰ç›¸åŒç»´åº¦çš„æ½œåœ¨å˜é‡ã€‚åœ¨ä¸‹é¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ç”¨äºå›¾åƒæ•°æ®çš„è¿™æ ·çš„Markové“¾çš„è¡¨ç°ã€‚</p><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230726214006809.png" alt="image-20230726214006809"></p><h5 id="2-Forward-diffusion-process"><a href="#2-Forward-diffusion-process" class="headerlink" title="2.Forward diffusion process"></a>2.Forward diffusion process</h5><h5 id="3-Reverse-diffusion-process"><a href="#3-Reverse-diffusion-process" class="headerlink" title="3.Reverse diffusion process"></a>3.Reverse diffusion process</h5><h5 id="4-Architecture"><a href="#4-Architecture" class="headerlink" title="4.Architecture"></a>4.Architecture</h5><h5 id="5-Training-and-sampling-algorithms"><a href="#5-Training-and-sampling-algorithms" class="headerlink" title="5.Training and sampling algorithms"></a>5.Training and sampling algorithms</h5><h5 id="6-Conditioned-Generation"><a href="#6-Conditioned-Generation" class="headerlink" title="6.Conditioned Generation"></a>6.Conditioned Generation</h5><h5 id="7-Stable-diffusion-Latent-diffusion-model"><a href="#7-Stable-diffusion-Latent-diffusion-model" class="headerlink" title="7.Stable diffusion: Latent diffusion model"></a>7.Stable diffusion: Latent diffusion model</h5><h5 id="8-Summary"><a href="#8-Summary" class="headerlink" title="8.Summary"></a>8.Summary</h5>]]></content>
      
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šç»´å‘é‡çš„ä¹˜ç§¯</title>
      <link href="/2023/07/19/duo-wei-xiang-liang-de-cheng-ji/"/>
      <url>/2023/07/19/duo-wei-xiang-liang-de-cheng-ji/</url>
      
        <content type="html"><![CDATA[<p>shape=[2,2,3]çš„ä¸‰ç»´çŸ©é˜µï¼Œå¯ä»¥è§†ä¸º2ä¸ªshape=[2,3]çš„äºŒç»´çŸ©é˜µå †å åœ¨ä¸€èµ·ï¼ï¼æœ€åä¸¤ç»´æ‰æ˜¯æœ‰æ•°æ®çš„çŸ©é˜µï¼Œå‰é¢çš„ç»´åº¦åªæ˜¯çŸ©é˜µçš„æ’åˆ—è€Œå·²ï¼</p><p>æ‰€ä»¥åœ¨çŸ©é˜µè¿ç®—çš„æ—¶å€™ï¼Œå…¶å®æœ€åéƒ½å¯ä»¥è½¬æˆæˆ‘ä»¬å¸¸è§çš„äºŒç»´çŸ©é˜µè¿ç®—ï¼Œéµå¾ªçš„åŸåˆ™æ˜¯ï¼šåœ¨å¤šç»´çŸ©é˜µç›¸ä¹˜ä¸­ï¼Œéœ€æœ€åä¸¤ç»´æ»¡è¶³shapeåŒ¹é…åŸåˆ™ï¼Œæœ€åä¸¤ç»´æ‰æ˜¯æœ‰æ•°æ®çš„çŸ©é˜µï¼Œå‰é¢çš„ç»´åº¦åªæ˜¯çŸ©é˜µçš„æ’åˆ—è€Œå·²ï¼</p><p>æ¯”å¦‚è¯´æ˜¯ä¸€ä¸ªè¾“å…¥[64,3,32,32]ï¼Œç¬¬ä¸€ç»´åº¦è¡¨ç¤ºbatch_sizeï¼Œç¬¬äºŒç»´åº¦è¡¨ç¤ºé€šé“æ•°ã€‚</p><pre class="line-numbers language-none"><code class="language-none">a = [[[ 1.  2.  3.]  [ 4.  5.  6.]] [[ 7.  8.  9.]  [10. 11. 12.]]]b = [[[ 1.  2.]  [ 3.  4.]  [ 5.  6.]] [[ 7.  8.]  [ 9. 10.]  [11. 12.]]]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230719132230670.png" alt="image-20230719132230670"></p><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230719132230670.png"></p><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230719132259087.png" alt="image-20230719132259087"></p>]]></content>
      
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç™¾åº¦AI</title>
      <link href="/2023/07/17/bai-du-ai/"/>
      <url>/2023/07/17/bai-du-ai/</url>
      
        <content type="html"><![CDATA[<p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230717090749273.png" alt="image-20230717090749273"></p><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230722075209939.png" alt="image-20230722075209939"></p>]]></content>
      
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaä¸­çš„æ•°æ®ç»“æ„</title>
      <link href="/2023/07/15/java-zhong-de-shu-ju-jie-gou/"/>
      <url>/2023/07/15/java-zhong-de-shu-ju-jie-gou/</url>
      
        <content type="html"><![CDATA[<h5 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><ul><li>Listï¼ŒSetï¼ŒMapéƒ½æ˜¯æ¥å£ï¼Œå‰ä¸¤ä¸ªç»§æ‰¿Collectionæ¥å£ï¼ŒMapä¸ºç‹¬ç«‹çš„æ¥å£ã€‚</li><li>Setä¸‹é¢æœ‰HashSet,LinkedHashSet,TreeSet</li><li>Listä¸‹é¢æœ‰ArrayList,Vector,LinkedList</li><li>Mapä¸‹é¢æœ‰Hashtable,LinkedHashMap,HashMap,TreeMap</li><li>Collectionæ¥å£ä¸‹é¢è¿˜æœ‰ä¸ªQueueæ¥å£ï¼Œæœ‰PriorityQueueç±»</li></ul><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230715155010903.png" alt="image-20230715155010903"></p><ul><li>LinkedListæ—¢å¯ä»¥å®ç°Queueæ¥å£,ä¹Ÿå¯ä»¥å®ç°Listæ¥å£.åªä¸è¿‡å‘¢, LinkedListå®ç°äº†Queueæ¥å£ã€‚Queueæ¥å£çª„åŒ–äº†å¯¹LinkedListçš„æ–¹æ³•çš„è®¿é—®æƒé™ï¼ˆå³åœ¨æ–¹æ³•ä¸­çš„å‚æ•°ç±»å‹å¦‚æœæ˜¯Queueæ—¶ï¼Œå°±å®Œå…¨åªèƒ½è®¿é—®Queueæ¥å£æ‰€å®šä¹‰çš„æ–¹æ³• äº†ï¼Œè€Œä¸èƒ½ç›´æ¥è®¿é—® LinkedListçš„éQueueçš„æ–¹æ³•ï¼‰ï¼Œä»¥ä½¿å¾—åªæœ‰æ°å½“çš„æ–¹æ³•æ‰å¯ä»¥ä½¿ç”¨ã€‚</li></ul><h5 id="Listæœ‰åºï¼Œå¯é‡å¤"><a href="#Listæœ‰åºï¼Œå¯é‡å¤" class="headerlink" title="Listæœ‰åºï¼Œå¯é‡å¤"></a>Listæœ‰åºï¼Œå¯é‡å¤</h5><p>ArrayListä¼˜ç‚¹ï¼šåº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ã€‚ç¼ºç‚¹çº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜ã€‚</p><p>Vectorä¼˜ç‚¹ï¼šåº•å±‚æ˜¯æ•°ç»„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ã€‚ç¼ºç‚¹çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½ã€‚</p><p>LinkedListä¼˜ç‚¹ï¼šåº•å±‚æ˜¯é“¾è¡¨ï¼ŒæŸ¥è¯¢æ…¢ï¼Œå¢åˆ å¿«ã€‚ç¼ºç‚¹çº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜ã€‚</p><h5 id="Setæ— åºï¼Œå”¯ä¸€"><a href="#Setæ— åºï¼Œå”¯ä¸€" class="headerlink" title="Setæ— åºï¼Œå”¯ä¸€"></a>Setæ— åºï¼Œå”¯ä¸€</h5><p>HashSet:åº•å±‚æ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨(æ— åºï¼Œå”¯ä¸€)ã€‚å¦‚ä½•ä¿è¯å…ƒç´ å”¯ä¸€æ€§ï¼Ÿä¾èµ–ä¸¤ä¸ªæ–¹æ³•ï¼šhashCode()å’Œequals()ã€‚ä¸»è¦ç”¨æ¥æ’åºã€‚</p><p>LinkedHashSet:åº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨å’Œå“ˆå¸Œè¡¨ã€‚(FIFOæ’å…¥æœ‰åºï¼Œå”¯ä¸€)ç”±é“¾è¡¨ä¿è¯å…ƒç´ æœ‰åºï¼Œç”±å“ˆå¸Œè¡¨ä¿è¯å…ƒç´ å”¯ä¸€ã€‚ä¸»è¦ç”¨æ¥ä¿è¯FIFOæœ‰åºçš„é›†åˆã€‚</p><p>TreeSet:åº•å±‚æ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ã€‚(å”¯ä¸€ï¼Œæœ‰åºï¼‰1.å¦‚ä½•ä¿è¯å…ƒç´ æ’åºï¼šè‡ªç„¶æ’åºï¼Œæ¯”è¾ƒå™¨æ’åºã€‚2.å¦‚ä½•ä¿è¯å…ƒç´ å”¯ä¸€æ€§ï¼šæ ¹æ®æ¯”è¾ƒçš„è¿”å›å€¼æ˜¯å¦æ˜¯0æ¥å†³å®šã€‚é€šç”¨çš„å­˜å‚¨æ•°æ®çš„é›†åˆã€‚</p><pre class="line-numbers language-none"><code class="language-none">å”¯ä¸€å—?æ˜¯ï¼šSetæ’åºå—?æ˜¯ï¼šTreeSetæˆ–LinkedHashSetå¦ï¼šHashSetå¦‚æœä½ çŸ¥é“æ˜¯Setï¼Œä½†æ˜¯ä¸çŸ¥é“æ˜¯å“ªä¸ªSetï¼Œå°±ç”¨HashSetã€‚å¦ï¼šListè¦å®‰å…¨å—?æ˜¯ï¼šVectorå¦ï¼šArrayListæˆ–è€…LinkedListæŸ¥è¯¢å¤šï¼šArrayListå¢åˆ å¤šï¼šLinkedListå¦‚æœä½ çŸ¥é“æ˜¯Listï¼Œä½†æ˜¯ä¸çŸ¥é“æ˜¯å“ªä¸ªListï¼Œå°±ç”¨ArrayListã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="Mapæ¥å£"><a href="#Mapæ¥å£" class="headerlink" title="Mapæ¥å£"></a>Mapæ¥å£</h5><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230715161752563.png" alt="image-20230715161752563"></p><p>Mapæ¥å£å®ç°äº†ä¸‰ä¸ªé‡è¦çš„ç±»ï¼Œåˆ†åˆ«æ˜¯HashMapã€TreeMapå’ŒHashTable</p><ul><li>TreeMapæ˜¯æœ‰åºçš„ï¼ŒHashMapå’ŒHashTableæ˜¯æ— åºçš„ã€‚</li><li>Hashtableçš„æ–¹æ³•æ˜¯åŒæ­¥çš„ï¼ŒHashMapçš„æ–¹æ³•ä¸æ˜¯åŒæ­¥çš„ï¼Œè¿™æ˜¯ä¸¤è€…æœ€ä¸»è¦çš„åŒºåˆ«ã€‚</li></ul><p>è¿™å°±æ„å‘³ç€ï¼š</p><ul><li><p>hashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒHashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></li><li><p>HashMapæ•ˆç‡è¾ƒé«˜ï¼ŒHashTableæ•ˆç‡è¾ƒä½ã€‚</p><p>å¦‚æœå¯¹åŒæ­¥æ€§æˆ–ä¸é—ç•™ä»£ç çš„å…¼å®¹æ€§æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œå»ºè®®ä½¿ç”¨HashMapã€‚ æŸ¥çœ‹Hashtableçš„æºä»£ç å°±å¯ä»¥å‘ç°ï¼Œé™¤æ„é€ å‡½æ•°å¤–ï¼ŒHashtableçš„æ‰€æœ‰ public æ–¹æ³•å£°æ˜ä¸­éƒ½æœ‰ synchronizedå…³é”®å­—ï¼Œè€ŒHashMapçš„æºç ä¸­åˆ™æ²¡æœ‰ã€‚</p></li><li><p>Hashtableä¸å…è®¸nullå€¼ï¼ŒHashMapå…è®¸nullå€¼ï¼ˆkeyå’Œvalueéƒ½å…è®¸ï¼‰</p></li><li><p>çˆ¶ç±»ä¸åŒï¼šHashtableçš„çˆ¶ç±»æ˜¯Dictionaryï¼ŒHashMapçš„çˆ¶ç±»æ˜¯AbstractMap</p></li></ul><h5 id="TreeSetçš„æ’åº"><a href="#TreeSetçš„æ’åº" class="headerlink" title="TreeSetçš„æ’åº"></a>TreeSetçš„æ’åº</h5><pre class="line-numbers language-none"><code class="language-none">1.åŸºæœ¬æ•°æ®ç±»å‹å¯ä»¥ç›´æ¥æ’åº2.å¼•ç”¨æ•°æ®ç±»å‹å¯ä»¥ä½¿ç”¨è‡ªç„¶æ’åºå’Œæ¯”è¾ƒå™¨æ’åº2.1è‡ªç„¶æ’åºï¼šä¾‹å¦‚Studentç±»ä¸­å®ç°Comparableæ¥å£ï¼Œé‡å†™Comparableæ¥å£ä¸­çš„Comparetoæ–¹æ³•public class Student implements Comparable&lt;Student&gt;{private String name;private int age;public int compareTo(Student s){int num=this.name.length()-s.name.length();int num1=num==0?this.name.compareTo(s.name):num;int num2=num1==0?this.age-s.age:num1;return num2;}}2.2æ¯”è¾ƒå™¨æ’åºï¼šå•ç‹¬åˆ›å»ºä¸€ä¸ªæ¯”è¾ƒç±»ï¼Œè¿™é‡Œä»¥MyComparatorä¸ºä¾‹ï¼Œå¹¶ä¸”è¦è®©ä»–ç»§æ‰¿Comparatoræ¥å£ï¼›é‡å†™Comparatoræ¥å£ä¸­çš„Compareæ¥å£ã€‚public class MyComparator implements Comparator&lt;Student&gt;{public int compare(Student s1,Student s2){int num=s1.getName().length()-s2.getName().length();int num1=num==0?s1.getName().compareTo(s2.getName()):num;int num2=num1==0?s1.getAge()-s2.getAge():num2;}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcode</title>
      <link href="/2023/07/15/leetcode/"/>
      <url>/2023/07/15/leetcode/</url>
      
        <content type="html"><![CDATA[<h5 id="leetcode1362-æœ€æ¥è¿‘çš„å› æ•°"><a href="#leetcode1362-æœ€æ¥è¿‘çš„å› æ•°" class="headerlink" title="leetcode1362.æœ€æ¥è¿‘çš„å› æ•°"></a>leetcode1362.æœ€æ¥è¿‘çš„å› æ•°</h5><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230715104042344.png" alt="image-20230715104042344"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">closestDivisors</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> divisor<span class="token operator">=</span>num<span class="token operator">==</span><span class="token number">1</span><span class="token operator">?</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>num<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>divisor<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>divisor<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            i<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>divisor<span class="token operator">/</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">def</span> <span class="token function">closestDivisor</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>        divisor <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">else</span> num <span class="token operator">+</span> <span class="token number">2</span>        i<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>divisor<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">while</span> divisor <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>    i <span class="token operator">-=</span> <span class="token number">1</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>i<span class="token punctuation">,</span>divisor<span class="token operator">/</span>i<span class="token punctuation">]</span><span class="token comment">#ä¸Šä¸€ä¸ªå¥½ä¸€ç‚¹</span><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">closestDivisors</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment">#------------------ä¸­å¿ƒå¼€èŠ±----------------</span>        <span class="token keyword">def</span> <span class="token function">calc</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>num <span class="token operator">**</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> num <span class="token operator">%</span> x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> num <span class="token operator">//</span> x<span class="token punctuation">]</span>        res1 <span class="token operator">=</span> calc<span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        res2 <span class="token operator">=</span> calc<span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> res1 <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>res1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>res1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>res2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>res2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">else</span> res2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">package mainimport (    "fmt"    "math")func closestDivisors(num int) []int {    divisor := num + 1    if num == 1 {        divisor = num + 1    } else {        divisor = num + 2    }    i := int(math.Sqrt(float64(divisor)))    for divisor%i &gt; 1 {        i--    }    return []int{i, divisor / i}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="äºŒå‰æœç´¢æ ‘"><a href="#äºŒå‰æœç´¢æ ‘" class="headerlink" title="äºŒå‰æœç´¢æ ‘"></a>äºŒå‰æœç´¢æ ‘</h5><pre class="line-numbers language-none"><code class="language-none">äºŒå‰æœç´¢æ ‘ï¼ˆBinary Search Treeï¼ŒBSTï¼‰æ˜¯ä¸€ç§åŸºäºäºŒå‰æ ‘çš„æ•°æ®ç»“æ„ã€‚å®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š1. å¯¹äºä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒçš„å·¦å­æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½å°äºè¯¥èŠ‚ç‚¹çš„å€¼ã€‚2. å¯¹äºä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒçš„å³å­æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºè¯¥èŠ‚ç‚¹çš„å€¼ã€‚3. å·¦å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æœç´¢æ ‘ã€‚å› æ­¤ï¼ŒäºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ã€‚å®ƒæ”¯æŒæ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œï¼Œå®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(log n)ã€‚åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼ŒäºŒå‰æœç´¢æ ‘çš„é«˜åº¦å¯èƒ½ä¼šé€€åŒ–ä¸ºé“¾è¡¨ï¼Œè¿™æ—¶å€™æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¼šé€€åŒ–ä¸º O(n)ã€‚äºŒå‰æœç´¢æ ‘å¯ä»¥ç”¨æ¥å®ç°ä¸€äº›é«˜æ•ˆçš„ç®—æ³•ï¼Œå¦‚äºŒå‰æœç´¢ã€äºŒå‰æ’åºæ ‘ã€AVLæ ‘ã€çº¢é»‘æ ‘ç­‰ã€‚å®ƒä¹Ÿè¢«å¹¿æ³›åº”ç”¨äºæ•°æ®åº“ã€æœç´¢å¼•æ“ã€æ–‡ä»¶ç³»ç»Ÿç­‰é¢†åŸŸã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="leetcode108"><a href="#leetcode108" class="headerlink" title="leetcode108"></a>leetcode108</h5><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230715142725906.png" alt="image-20230715142725906"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span> <span class="token function">sortedArrayToVST</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">helper</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>nums<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span> <span class="token function">helper</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>nums<span class="token punctuation">,</span><span class="token keyword">int</span> left<span class="token punctuation">,</span><span class="token keyword">int</span> right<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>left<span class="token operator">&gt;</span>right<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> mid<span class="token operator">=</span><span class="token punctuation">(</span>left<span class="token operator">+</span>right<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>        <span class="token class-name">TreeNode</span> root<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        root<span class="token punctuation">.</span>left<span class="token operator">=</span><span class="token function">helper</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span>left<span class="token punctuation">,</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        root<span class="token punctuation">.</span>right<span class="token operator">=</span><span class="token function">helper</span><span class="token punctuation">(</span>nums<span class="token punctuation">.</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> root<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Definition for a binary tree node.</span><span class="token comment"># class TreeNode:</span><span class="token comment">#     def __init__(self, val=0, left=None, right=None):</span><span class="token comment">#         self.val = val</span><span class="token comment">#         self.left = left</span><span class="token comment">#         self.right = right</span><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">sortedArrayToBST</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>nums<span class="token punctuation">:</span>List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>TreeNode<span class="token punctuation">:</span>        <span class="token keyword">def</span> <span class="token function">helper</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> left<span class="token operator">&gt;</span>right<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token boolean">None</span>           mid<span class="token operator">=</span><span class="token punctuation">(</span>left<span class="token operator">+</span>right<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>            root<span class="token operator">=</span>TreeNode<span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span>            root<span class="token punctuation">.</span>left<span class="token operator">=</span>helper<span class="token punctuation">(</span>left<span class="token punctuation">,</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>            root<span class="token punctuation">.</span>right<span class="token operator">=</span>helper<span class="token punctuation">(</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>right<span class="token punctuation">)</span>            <span class="token keyword">return</span> root        <span class="token keyword">return</span> helper<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">/** * Definition for a binary tree node. * type TreeNode struct { *     Val int *     Left *TreeNode *     Right *TreeNode * } */</span><span class="token keyword">func</span> <span class="token function">sortedArrayToBST</span><span class="token punctuation">(</span>nums <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>TreeNode <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">helper</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">helper</span><span class="token punctuation">(</span>nums <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span>left <span class="token builtin">int</span><span class="token punctuation">,</span>right <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>TreeNode<span class="token punctuation">{</span>    <span class="token keyword">if</span> left<span class="token operator">&gt;</span>right<span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">nil</span>    <span class="token punctuation">}</span>    mid<span class="token operator">:=</span><span class="token punctuation">(</span>left<span class="token operator">+</span>right<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>    root<span class="token operator">:=</span><span class="token operator">&amp;</span>TreeNode<span class="token punctuation">{</span>Val<span class="token punctuation">:</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">}</span>    root<span class="token punctuation">.</span>Left<span class="token operator">=</span><span class="token function">helper</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span>left<span class="token punctuation">,</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    root<span class="token punctuation">.</span>Right<span class="token operator">=</span><span class="token function">helper</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>right<span class="token punctuation">)</span>    <span class="token keyword">return</span> root<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="leetcode1382"><a href="#leetcode1382" class="headerlink" title="leetcode1382"></a>leetcode1382</h5><p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230715151610608.png" alt="image-20230715151610608"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Definition for a binary tree node. * public class TreeNode { *     int val; *     TreeNode left; *     TreeNode right; *     TreeNode() {} *     TreeNode(int val) { this.val = val; } *     TreeNode(int val, TreeNode left, TreeNode right) { *         this.val = val; *         this.left = left; *         this.right = right; *     } * } */</span><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> inorderSeq<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span> <span class="token function">balanceBST</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">getInorder</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>inorderSeq<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getInorder</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> tree<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>left<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">getInorder</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        inorderSeq<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>right<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">getInorder</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span><span class="token keyword">int</span> r<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> mid<span class="token operator">=</span><span class="token punctuation">(</span>l<span class="token operator">+</span>r<span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token class-name">TreeNode</span> root<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span>inorderSeq<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>l<span class="token operator">&lt;=</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            root<span class="token punctuation">.</span>left<span class="token operator">=</span><span class="token function">build</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;=</span>r<span class="token punctuation">)</span><span class="token punctuation">{</span>            root<span class="token punctuation">.</span>right<span class="token operator">=</span><span class="token function">build</span><span class="token punctuation">(</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> root<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Definition for a binary tree node.</span><span class="token comment"># class TreeNode:</span><span class="token comment">#     def __init__(self, val=0, left=None, right=None):</span><span class="token comment">#         self.val = val</span><span class="token comment">#         self.left = left</span><span class="token comment">#         self.right = right</span><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">inOrder</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>root<span class="token punctuation">,</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> root<span class="token operator">==</span><span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        self<span class="token punctuation">.</span>inOrder<span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">,</span>nums<span class="token punctuation">)</span>        nums<span class="token punctuation">.</span>append<span class="token punctuation">(</span>root<span class="token punctuation">.</span>val<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>inOrder<span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">,</span>nums<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>nums<span class="token punctuation">,</span>left<span class="token punctuation">,</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> left<span class="token operator">&gt;</span>right<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>        mid<span class="token operator">=</span><span class="token punctuation">(</span>left<span class="token operator">+</span>right<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>        root<span class="token operator">=</span>TreeNode<span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span>        root<span class="token punctuation">.</span>left<span class="token operator">=</span>self<span class="token punctuation">.</span>process<span class="token punctuation">(</span>nums<span class="token punctuation">,</span>left<span class="token punctuation">,</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        root<span class="token punctuation">.</span>right<span class="token operator">=</span>self<span class="token punctuation">.</span>process<span class="token punctuation">(</span>nums<span class="token punctuation">,</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>right<span class="token punctuation">)</span>        <span class="token keyword">return</span> root    <span class="token keyword">def</span> <span class="token function">balanceBST</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> root<span class="token punctuation">:</span> TreeNode<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> TreeNode<span class="token punctuation">:</span>        nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>inOrder<span class="token punctuation">(</span>root<span class="token punctuation">,</span>nums<span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>process<span class="token punctuation">(</span>nums<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">/** * Definition for a binary tree node. * type TreeNode struct { *     Val int *     Left *TreeNode *     Right *TreeNode * } */</span><span class="token keyword">func</span> <span class="token function">balanceBST</span><span class="token punctuation">(</span>root <span class="token operator">*</span>TreeNode<span class="token punctuation">)</span> <span class="token operator">*</span>TreeNode <span class="token punctuation">{</span>    nums<span class="token operator">:=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">var</span> inorder <span class="token keyword">func</span><span class="token punctuation">(</span>node <span class="token operator">*</span>TreeNode<span class="token punctuation">)</span>    inorder <span class="token operator">=</span><span class="token keyword">func</span><span class="token punctuation">(</span>node <span class="token operator">*</span>TreeNode<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> node<span class="token operator">==</span><span class="token boolean">nil</span><span class="token punctuation">{</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>        <span class="token function">inorder</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>Left<span class="token punctuation">)</span>        nums<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span>node<span class="token punctuation">.</span>Val<span class="token punctuation">)</span>        <span class="token function">inorder</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>Right<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">inorder</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>    <span class="token keyword">var</span> buildTree <span class="token keyword">func</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>r <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>TreeNode    buildTree<span class="token operator">=</span><span class="token keyword">func</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>r <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>TreeNode<span class="token punctuation">{</span>        mid<span class="token operator">:=</span><span class="token punctuation">(</span>l<span class="token operator">+</span>r<span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">1</span>        node<span class="token operator">:=</span><span class="token operator">&amp;</span>TreeNode<span class="token punctuation">{</span>Val<span class="token punctuation">:</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">}</span>        <span class="token keyword">if</span> l<span class="token operator">&lt;=</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">{</span>            node<span class="token punctuation">.</span>Left<span class="token operator">=</span><span class="token function">buildTree</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> r<span class="token operator">&gt;=</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">{</span>            node<span class="token punctuation">.</span>Right<span class="token operator">=</span><span class="token function">buildTree</span><span class="token punctuation">(</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>r<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> node    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">buildTree</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">#<span class="token constant">AVL</span>æ—‹è½¬å¹³è¡¡äºŒå‰æ ‘æ—‹è½¬çš„æƒ…å†µä¸€å…±æœ‰<span class="token number">4</span>ç§æƒ…å†µï¼šæ–°åŠ å…¥èŠ‚ç‚¹ä¸º node<span class="token punctuation">.</span>left çš„å·¦å­©å­ï¼Œ <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> ã€‚ç›´æ¥å¯¹nodeèŠ‚ç‚¹å³æ—‹ã€‚æ–°åŠ å…¥èŠ‚ç‚¹ä¸º node<span class="token punctuation">.</span>left çš„å³å­©å­ï¼Œ <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> ã€‚è¿™æ—¶å€™è¦å…ˆå¯¹node<span class="token punctuation">.</span>leftå·¦æ—‹ï¼Œè°ƒæ•´ä¸º<span class="token number">1</span>çš„æƒ…å†µï¼Œå†è¿›è¡Œå³æ—‹ã€‚æ–°åŠ å…¥èŠ‚ç‚¹ä¸º node<span class="token punctuation">.</span>right çš„å³å­©å­ï¼Œ <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> ã€‚ç›´æ¥å¯¹nodeèŠ‚ç‚¹å·¦æ—‹ã€‚æ–°åŠ å…¥èŠ‚ç‚¹ä¸º node<span class="token punctuation">.</span>right çš„å·¦å­©å­ï¼Œ <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> ã€‚è¿™æ—¶å€™è¦å…ˆå¯¹node<span class="token punctuation">.</span>rightå³æ—‹ï¼Œè°ƒæ•´ä¸º<span class="token number">3</span>çš„æƒ…å†µï¼Œå†è¿›è¡Œå·¦æ—‹ã€‚<span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span> <span class="token function">balanceBST</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> root<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TreeNode</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> nodeHeight<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">TreeNode</span> newRoot<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TreeNode</span><span class="token punctuation">&gt;</span></span> stack<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">TreeNode</span> node<span class="token operator">=</span>root<span class="token punctuation">;</span>        <span class="token comment">//å…ˆåºéå†,åˆ©ç”¨æ ˆå¾ˆå·§å¦™</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>node<span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">||</span><span class="token operator">!</span>stack<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>node<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                newRoot<span class="token operator">=</span><span class="token function">insert</span><span class="token punctuation">(</span>newRoot<span class="token punctuation">,</span>node<span class="token punctuation">.</span>val<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>                stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>                node<span class="token operator">=</span>node<span class="token punctuation">.</span>left<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span><span class="token punctuation">{</span>                node<span class="token operator">=</span>stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                node<span class="token operator">=</span>node<span class="token punctuation">.</span>right<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> newRoot<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token class-name">TreeNode</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> root<span class="token punctuation">,</span><span class="token keyword">int</span> val<span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TreeNode</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> nodeHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>root<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            root<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>            nodeHeight<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> root<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">TreeNode</span> node<span class="token operator">=</span>root<span class="token punctuation">;</span>        <span class="token keyword">int</span> cmp<span class="token operator">=</span>val<span class="token operator">-</span>node<span class="token punctuation">.</span>val<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>cmp<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">//å·¦å­æ ‘æ’å…¥</span>            node<span class="token punctuation">.</span>left<span class="token operator">=</span><span class="token function">insert</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">,</span>val<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>nodeHeight<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span>nodeHeight<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token operator">&gt;</span>node<span class="token punctuation">.</span>left<span class="token punctuation">.</span>val<span class="token punctuation">)</span><span class="token punctuation">{</span>                    node<span class="token punctuation">.</span>left<span class="token operator">=</span><span class="token function">rotateLeft</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                node<span class="token operator">=</span><span class="token function">rotateLeft</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cmp<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            node<span class="token punctuation">.</span>right<span class="token operator">=</span><span class="token function">insert</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">,</span>val<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>nodeHeight<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span>nodeHeight<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token operator">&lt;</span>node<span class="token punctuation">.</span>right<span class="token punctuation">.</span>val<span class="token punctuation">)</span><span class="token punctuation">{</span>                node<span class="token punctuation">.</span>right<span class="token operator">=</span><span class="token function">rotateRight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span><span class="token class-name">NodeHeight</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            node<span class="token operator">=</span><span class="token function">rotateLeft</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> height<span class="token operator">=</span><span class="token function">getCurNodeNewHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>    nodeHeight<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> node<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token class-name">TreeNode</span> <span class="token function">rotateLeft</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> node<span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TreeNode</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> nodeHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">TreeNode</span> right<span class="token operator">=</span>node<span class="token punctuation">.</span>right<span class="token punctuation">;</span>    node<span class="token punctuation">.</span>right<span class="token operator">=</span>right<span class="token punctuation">.</span>left<span class="token punctuation">;</span>    right<span class="token punctuation">.</span>left<span class="token operator">=</span>node<span class="token punctuation">;</span>    <span class="token keyword">int</span> newNodeHeight<span class="token operator">=</span><span class="token function">getCurNodeNewHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>    nodeHeight<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span>newNodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> newRightHeight<span class="token operator">=</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>newNodeHeight<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>right<span class="token punctuation">.</span>right<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>    nodeHeight<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span>newRightHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> right<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token class-name">TreeNode</span> <span class="token function">rotateRight</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> node<span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TreeNode</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> nodeHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// ---æŒ‡é’ˆè°ƒæ•´</span>        <span class="token class-name">TreeNode</span> left <span class="token operator">=</span> node<span class="token punctuation">.</span>left<span class="token punctuation">;</span>        node<span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">.</span>right<span class="token punctuation">;</span>        left<span class="token punctuation">.</span>right <span class="token operator">=</span> node<span class="token punctuation">;</span>        <span class="token comment">// ---é«˜åº¦æ›´æ–°</span>        <span class="token comment">// å…ˆæ›´æ–°nodeèŠ‚ç‚¹çš„é«˜åº¦ï¼Œè¿™ä¸ªæ—¶å€™nodeæ˜¯rightèŠ‚ç‚¹çš„å·¦å­©å­</span>        <span class="token keyword">int</span> newNodeHeight <span class="token operator">=</span> <span class="token function">getCurNodeNewHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ›´æ–°nodeèŠ‚ç‚¹é«˜åº¦</span>        nodeHeight<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span>newNodeHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// newNodeHeightæ˜¯ç°åœ¨leftèŠ‚ç‚¹å³å­æ ‘é«˜åº¦ï¼ŒåŸç†ä¸€æ ·ï¼Œå–ç°åœ¨rightå·¦å³å­æ ‘æœ€å¤§é«˜åº¦+1</span>        <span class="token keyword">int</span> newLeftHeight <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>newNodeHeight<span class="token punctuation">,</span>nodeHeight<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span>left<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">// æ›´æ–°åŸleftèŠ‚ç‚¹é«˜åº¦</span>        nodeHeight<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span>newLeftHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> left<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–å½“å‰èŠ‚ç‚¹çš„æ–°é«˜åº¦     * @param node node     * @param nodeHeight nodeé«˜åº¦ç¼“å­˜     * @return å½“å‰nodeçš„æ–°é«˜åº¦     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">getCurNodeNewHeight</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> node<span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TreeNode</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> nodeHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// nodeèŠ‚ç‚¹çš„é«˜åº¦ï¼Œä¸ºç°åœ¨nodeå·¦å³å­æ ‘æœ€å¤§é«˜åº¦+1</span>        <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>nodeHeight<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>nodeHeight<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å·¦æ—‹è½¬<img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230716112659587.png" alt="image-20230716112659587"></p><p>å³æ—‹è½¬<img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230716112722681.png" alt="image-20230716112722681"></p><p>åŒæ—‹è½¬<img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230716112751501.png" alt="image-20230716112751501"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LLMå®ç°æœ¬åœ°çŸ¥è¯†åº“é—®ç­”é¡¹ç›®ä¸­çš„ä¸€äº›ç¬”è®°</title>
      <link href="/2023/07/10/llm-shi-xian-ben-di-zhi-shi-ku-wen-da-xiang-mu-zhong-de-yi-xie-bi-ji/"/>
      <url>/2023/07/10/llm-shi-xian-ben-di-zhi-shi-ku-wen-da-xiang-mu-zhong-de-yi-xie-bi-ji/</url>
      
        <content type="html"><![CDATA[<p><img src="https://dradon.oss-cn-hangzhou.aliyuncs.com/img/image-20230620085336168.png" alt="image-20230620085336168"></p><h5 id="AutoModel-from-pretrained"><a href="#AutoModel-from-pretrained" class="headerlink" title="AutoModel.from_pretrained()"></a>AutoModel.from_pretrained()</h5><pre class="line-numbers language-text" data-language="text"><code class="language-text">AuroModel.from_pretrained()æ˜¯Hugging Face Transformersåº“ä¸­ç”¨äºåŠ è½½é¢„è®­ç»ƒæ¨¡å‹çš„æ–¹æ³•ã€‚å®ƒå¯ä»¥ä»æœ¬åœ°æ–‡ä»¶ã€Hugging Face Hubã€URLç­‰å¤šç§æ¥æºåŠ è½½é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ¨¡å‹å¯¹è±¡ï¼Œç”¨äºåç»­çš„é¢„æµ‹å’Œè®­ç»ƒã€‚å…·ä½“æ¥è¯´ï¼ŒAutoModel.from_pretrained()æ–¹æ³•çš„å‚æ•°å¦‚ä¸‹ï¼š- `checkpoint`ï¼šå¿…éœ€å‚æ•°ï¼Œè¡¨ç¤ºè¦åŠ è½½çš„æ¨¡å‹çš„åç§°ã€è·¯å¾„æˆ–URLã€‚- `config`ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¦ä½¿ç”¨çš„æ¨¡å‹é…ç½®ã€‚å¦‚æœæœªæŒ‡å®šï¼Œä¼šæ ¹æ®æ¨¡å‹åç§°è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªé»˜è®¤çš„é…ç½®æ–‡ä»¶ã€‚- `torch_dtype`ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¦ä½¿ç”¨çš„PyTorchå¼ é‡æ•°æ®ç±»å‹ã€‚é»˜è®¤ä¸º`torch.float32`ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º`torch.float16`æˆ–`torch.bfloat16`ã€‚- `trust_remote_code`ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦ä¿¡ä»»ä»è¿œç¨‹æºåŠ è½½çš„ä»£ç ï¼ˆå¦‚Hugging Face Hubï¼‰ã€‚é»˜è®¤ä¸º`False`ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º`True`ã€‚- `cache_dir`ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¦ä½¿ç”¨çš„ç¼“å­˜ç›®å½•ã€‚å¦‚æœæœªæŒ‡å®šï¼Œä¼šä½¿ç”¨é»˜è®¤çš„ç¼“å­˜ç›®å½•ï¼ˆ`~/.cache/huggingface/transformers`ï¼‰ã€‚- `force_download`ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¼ºåˆ¶é‡æ–°ä¸‹è½½æ¨¡å‹ã€‚é»˜è®¤ä¸º`False`ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º`True`ã€‚- `resume_download`ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦ä»ä¸Šæ¬¡ä¸‹è½½çš„ä½ç½®æ¢å¤ä¸‹è½½ã€‚é»˜è®¤ä¸º`False`ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º`True`ã€‚- `proxies`ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¦ä½¿ç”¨çš„ä»£ç†è®¾ç½®ã€‚é»˜è®¤ä¸º`None`ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºä»£ç†URLå­—ç¬¦ä¸²æˆ–ä»£ç†å­—å…¸ã€‚- `local_files_only`ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦åªä»æœ¬åœ°æ–‡ä»¶åŠ è½½æ¨¡å‹ã€‚é»˜è®¤ä¸º`False`ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º`True`ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`LoaderClass.from_pretrained()`æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`checkpoint`ï¼Œè¡¨ç¤ºè¦åŠ è½½çš„æ¨¡å‹çš„åç§°ã€è·¯å¾„æˆ–URLã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯`config`ï¼Œè¡¨ç¤ºè¦ä½¿ç”¨çš„æ¨¡å‹é…ç½®ï¼Œè¿™é‡Œä½¿ç”¨äº†å·²ç»åŠ è½½å¥½çš„`self.model_config`ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°`torch_dtype`è¡¨ç¤ºè¦ä½¿ç”¨çš„PyTorchå¼ é‡æ•°æ®ç±»å‹ï¼Œè¿™é‡Œæ ¹æ®`self.bf16`çš„å€¼é€‰æ‹©äº†`torch.bfloat16`æˆ–`torch.float16`ã€‚ç¬¬å››ä¸ªå‚æ•°`trust_remote_code`è¡¨ç¤ºæ˜¯å¦ä¿¡ä»»ä»è¿œç¨‹æºï¼ˆå¦‚Hugging Face Hubï¼‰åŠ è½½çš„ä»£ç ï¼Œè¿™é‡Œè®¾ç½®ä¸º`True`ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="torch-dfloat16å’Œtorch-float16"><a href="#torch-dfloat16å’Œtorch-float16" class="headerlink" title="torch.dfloat16å’Œtorch.float16"></a>torch.dfloat16å’Œtorch.float16</h5><pre class="line-numbers language-text" data-language="text"><code class="language-text">`torch.bfloat16`å’Œ`torch.float16`æ˜¯PyTorchå¼ é‡çš„ä¸¤ç§ä¸åŒæ•°æ®ç±»å‹ï¼Œå®ƒä»¬åœ¨å­˜å‚¨ç²¾åº¦å’Œå†…å­˜å ç”¨æ–¹é¢æœ‰æ‰€ä¸åŒã€‚å…·ä½“æ¥è¯´ï¼Œ`torch.bfloat16`æ˜¯ä¸€ç§16ä½æµ®ç‚¹æ•°æ•°æ®ç±»å‹ï¼Œå®ƒå¯ä»¥å­˜å‚¨æ›´å¤§çš„æ•°å€¼èŒƒå›´ï¼Œä½†ç²¾åº¦ç›¸å¯¹è¾ƒä½ã€‚è¿™ç§æ•°æ®ç±»å‹é€šå¸¸ç”¨äºæ·±åº¦ç¥ç»ç½‘ç»œçš„è®­ç»ƒå’Œæ¨ç†ä¸­ï¼Œå¯ä»¥åŠ é€Ÿè¿ç®—å¹¶å‡å°‘å†…å­˜å ç”¨ã€‚ä½†æ˜¯ï¼Œç”±äºç²¾åº¦è¾ƒä½ï¼Œå¯èƒ½ä¼šå¯¹æ¨¡å‹çš„å‡†ç¡®æ€§äº§ç”Ÿä¸€å®šçš„å½±å“ã€‚åœ¨ä½¿ç”¨`torch.bfloat16`æ—¶ï¼Œéœ€è¦æ³¨æ„æ•°å€¼èŒƒå›´çš„é™åˆ¶ï¼Œä»¥é¿å…æ•°å€¼æº¢å‡ºæˆ–ä¸‹æº¢çš„é—®é¢˜ã€‚è€Œ`torch.float16`æ˜¯å¦ä¸€ç§16ä½æµ®ç‚¹æ•°æ•°æ®ç±»å‹ï¼Œå®ƒå¯ä»¥å­˜å‚¨è¾ƒå°çš„æ•°å€¼èŒƒå›´ï¼Œä½†ç²¾åº¦ç›¸å¯¹è¾ƒé«˜ã€‚è¿™ç§æ•°æ®ç±»å‹é€šå¸¸ç”¨äºè®¡ç®—æœºè§†è§‰ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰ä»»åŠ¡ä¸­ï¼Œå¯ä»¥æé«˜æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚ä½†æ˜¯ï¼Œç”±äºå­˜å‚¨ç²¾åº¦è¾ƒé«˜ï¼Œå†…å­˜å ç”¨å’Œè®¡ç®—å¤æ‚åº¦ä¹Ÿç›¸åº”è¾ƒé«˜ã€‚å› æ­¤ï¼Œé€‰æ‹©ä½¿ç”¨å“ªç§æ•°æ®ç±»å‹å–å†³äºå…·ä½“çš„ä»»åŠ¡éœ€æ±‚å’Œç¡¬ä»¶é™åˆ¶ã€‚åœ¨ä½¿ç”¨`torch.bfloat16`æ—¶ï¼Œéœ€è¦æ³¨æ„æ•°å€¼èŒƒå›´çš„é™åˆ¶ï¼Œä»¥é¿å…æ•°å€¼æº¢å‡ºæˆ–ä¸‹æº¢çš„é—®é¢˜ï¼›åœ¨ä½¿ç”¨`torch.float16`æ—¶ï¼Œåˆ™éœ€è¦æ³¨æ„å†…å­˜å ç”¨å’Œè®¡ç®—å¤æ‚åº¦çš„é—®é¢˜ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="from-accelerate-import-dispatch-modelçš„è§£é‡Š"><a href="#from-accelerate-import-dispatch-modelçš„è§£é‡Š" class="headerlink" title="from accelerate import dispatch_modelçš„è§£é‡Š"></a>from accelerate import dispatch_modelçš„è§£é‡Š</h5><pre class="line-numbers language-none"><code class="language-none">`dispatch_model`æ˜¯`accelerate`åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ ¹æ®å½“å‰ç¡¬ä»¶ç¯å¢ƒå’Œè®¾ç½®è‡ªåŠ¨é€‰æ‹©åŠ é€Ÿå™¨ï¼Œä»¥åŠ é€Ÿæ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†ã€‚å…·ä½“æ¥è¯´ï¼Œ`dispatch_model`å‡½æ•°ä¼šæ ¹æ®ä»¥ä¸‹å‡ ä¸ªå› ç´ è‡ªåŠ¨é€‰æ‹©åŠ é€Ÿå™¨ï¼š1. ç¡¬ä»¶ç¯å¢ƒï¼šåŠ é€Ÿå™¨çš„é€‰æ‹©ä¼šæ ¹æ®è®¡ç®—æœºçš„GPUç±»å‹ã€æ•°é‡å’Œæ€§èƒ½ç­‰å› ç´ è¿›è¡Œä¼˜åŒ–ã€‚2. PyTorchç‰ˆæœ¬ï¼šåŠ é€Ÿå™¨çš„é€‰æ‹©ä¼šæ ¹æ®ä½¿ç”¨çš„PyTorchç‰ˆæœ¬è¿›è¡Œä¼˜åŒ–ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°æé«˜æ€§èƒ½ã€‚3. åŠ é€Ÿå™¨ç±»å‹ï¼šæ ¹æ®ç”¨æˆ·è®¾ç½®çš„åŠ é€Ÿå™¨ç±»å‹ï¼ˆä¾‹å¦‚æ··åˆç²¾åº¦è®­ç»ƒã€åˆ†å¸ƒå¼è®­ç»ƒç­‰ï¼‰ï¼Œé€‰æ‹©æœ€ä½³çš„åŠ é€Ÿå™¨å®ç°ã€‚ä½¿ç”¨`dispatch_model`å‡½æ•°å¯ä»¥ç®€åŒ–æ¨¡å‹è®­ç»ƒå’Œæ¨ç†çš„ä»£ç ç¼–å†™ï¼Œå¹¶æé«˜æ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†æ•ˆç‡ã€‚å…·ä½“æ¥è¯´ï¼Œä½ å¯ä»¥å°†æ¨¡å‹å¯¹è±¡ä¼ é€’ç»™`dispatch_model`å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³çš„åŠ é€Ÿå™¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªå·²ç»ä½¿ç”¨åŠ é€Ÿå™¨çš„æ¨¡å‹å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨`dispatch_model`å‡½æ•°è¿›è¡Œæ¨¡å‹è®­ç»ƒçš„ç¤ºä¾‹ï¼š```from accelerate import dispatch_model# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹model = LoaderClass.from_pretrained(checkpoint)# è‡ªåŠ¨é€‰æ‹©åŠ é€Ÿå™¨model, optimizer, train_loader, valid_loader = dispatch_model(model, optimizer, train_loader, valid_loader)# è®­ç»ƒæ¨¡å‹for epoch in range(num_epochs):    for batch in train_loader:        ...```åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`dispatch_model`å‡½æ•°ä¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³çš„åŠ é€Ÿå™¨ï¼Œå¹¶å°†åŠ é€Ÿå™¨åº”ç”¨åˆ°æ¨¡å‹ã€ä¼˜åŒ–å™¨å’Œæ•°æ®åŠ è½½å™¨ä¸­ï¼Œä»è€Œæé«˜æ¨¡å‹çš„è®­ç»ƒæ•ˆç‡ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="float"><a href="#float" class="headerlink" title=".float()"></a>.float()</h5><pre class="line-numbers language-none"><code class="language-none">åœ¨PyTorchä¸­ï¼Œ`.float()`æ˜¯`Tensor`ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå°†`Tensor`å¯¹è±¡è½¬æ¢ä¸ºæµ®ç‚¹æ•°ç±»å‹ã€‚åœ¨æ¨¡å‹ä¸­ä½¿ç”¨`.float()`é€šå¸¸ç”¨äºå°†è¾“å…¥æ•°æ®çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºæµ®ç‚¹æ•°ç±»å‹ï¼Œä»¥ä¾¿äºæ¨¡å‹èƒ½å¤Ÿæ­£ç¡®å¤„ç†æ•°æ®ã€‚è¿™æ˜¯å› ä¸ºåœ¨PyTorchä¸­ï¼Œæ¨¡å‹çš„è¾“å…¥å’Œå‚æ•°é€šå¸¸æ˜¯æµ®ç‚¹æ•°ç±»å‹ï¼Œå¦‚æœè¾“å…¥æ•°æ®çš„æ•°æ®ç±»å‹ä¸æ¨¡å‹æœŸæœ›çš„æ•°æ®ç±»å‹ä¸ä¸€è‡´ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹æ— æ³•æ­£ç¡®å¤„ç†æ•°æ®ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†åœ¨æ¨¡å‹ä¸­ä½¿ç”¨`.float()`æ–¹æ³•å°†è¾“å…¥æ•°æ®è½¬æ¢ä¸ºæµ®ç‚¹æ•°ç±»å‹ï¼š```pythonimport torch.nn as nn# å®šä¹‰ä¸€ä¸ªæ¨¡å‹class MyModel(nn.Module):    def __init__(self):        super(MyModel, self).__init__()        self.conv1 = nn.Conv2d(3, 16, kernel_size=3)        self.fc1 = nn.Linear(16 * 6 * 6, 10)    def forward(self, x):        x = self.conv1(x)        x = x.view(-1, 16 * 6 * 6)        x = self.fc1(x)        return x# å®ä¾‹åŒ–æ¨¡å‹å¹¶å°†å…¶ç§»åŠ¨åˆ°GPUä¸Šmodel = MyModel().cuda()# å®šä¹‰ä¸€ä¸ªè¾“å…¥æ•°æ®input_data = torch.randn(1, 3, 32, 32)# å°†è¾“å…¥æ•°æ®è½¬æ¢ä¸ºæµ®ç‚¹æ•°ç±»å‹å¹¶å°†å…¶ç§»åŠ¨åˆ°GPUä¸Šinput_data = input_data.float().cuda()# ä½¿ç”¨æ¨¡å‹è¿›è¡Œæ¨ç†outputs = model(input_data)```åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª`MyModel`æ¨¡å‹ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°GPUä¸Šã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè¾“å…¥æ•°æ®`input_data`ï¼Œå¹¶ä½¿ç”¨`.float()`æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°ç±»å‹ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°GPUä¸Šã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡å‹å¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ¨ç†ï¼Œå¹¶å¾—åˆ°è¾“å‡ºç»“æœã€‚é€šè¿‡å°†è¾“å…¥æ•°æ®è½¬æ¢ä¸ºæµ®ç‚¹æ•°ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ¨¡å‹èƒ½å¤Ÿæ­£ç¡®å¤„ç†æ•°æ®ï¼Œå¹¶é¿å…å‡ºç°æ•°æ®ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="load-in-8bitçš„ä½œç”¨"><a href="#load-in-8bitçš„ä½œç”¨" class="headerlink" title="load_in_8bitçš„ä½œç”¨"></a>load_in_8bitçš„ä½œç”¨</h5><pre class="line-numbers language-none"><code class="language-none">load_in_8bit`æ˜¯ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å˜é‡ï¼Œé€šå¸¸ç”¨äºæ§åˆ¶æ•°æ®åŠ è½½æ—¶çš„ç²¾åº¦ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœ`load_in_8bit`ä¸ºTrueï¼Œåˆ™æ•°æ®å°†ä»¥8ä½æ•´æ•°çš„å½¢å¼åŠ è½½ï¼Œå¦åˆ™å°†ä»¥32ä½æµ®ç‚¹æ•°çš„å½¢å¼åŠ è½½ã€‚åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œä¸ºäº†æé«˜æ¨¡å‹è®­ç»ƒå’Œæ¨ç†çš„æ•ˆç‡ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ä½ç²¾åº¦çš„æ•°æ®è¡¨ç¤ºæ–¹å¼ï¼Œä¾‹å¦‚8ä½æ•´æ•°ã€‚è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘æ•°æ®çš„å­˜å‚¨å’Œä¼ è¾“å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åŠ é€Ÿè®¡ç®—è¿‡ç¨‹ã€‚ä½†æ˜¯ï¼Œä½ç²¾åº¦çš„æ•°æ®è¡¨ç¤ºæ–¹å¼å¯èƒ½ä¼šå¯¹æ¨¡å‹çš„æ€§èƒ½å’Œç²¾åº¦äº§ç”Ÿä¸€å®šçš„å½±å“ï¼Œå› æ­¤éœ€è¦æ ¹æ®å…·ä½“çš„æƒ…å†µè¿›è¡Œé€‰æ‹©ã€‚åœ¨å…·ä½“çš„å®ç°ä¸­ï¼Œ`load_in_8bit`é€šå¸¸ä¼šä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™æ•°æ®åŠ è½½å™¨æˆ–æ¨¡å‹çš„æ„é€ å‡½æ•°ï¼Œç”¨äºæ§åˆ¶æ•°æ®çš„åŠ è½½ç²¾åº¦ã€‚ä¾‹å¦‚ï¼Œåœ¨PyTorchä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®`torch.utils.data.DataLoader`ç±»çš„`dtype`å‚æ•°æ¥æ§åˆ¶æ•°æ®çš„åŠ è½½ç²¾åº¦ã€‚è€Œåœ¨TensorFlowä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æ•°æ®åŠ è½½å™¨çš„`dtype`å‚æ•°æˆ–æ¨¡å‹çš„`dtype`å±æ€§æ¥æ§åˆ¶æ•°æ®çš„åŠ è½½ç²¾åº¦ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="æ¨¡å‹å¯¹åº”çš„tokenizer"><a href="#æ¨¡å‹å¯¹åº”çš„tokenizer" class="headerlink" title="æ¨¡å‹å¯¹åº”çš„tokenizer"></a>æ¨¡å‹å¯¹åº”çš„tokenizer</h5><pre class="line-numbers language-none"><code class="language-none">åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­ï¼Œæ–‡æœ¬æ•°æ®éœ€è¦è¢«è½¬æ¢ä¸ºæ•°å­—æ‰èƒ½è¢«æ¨¡å‹å¤„ç†ã€‚è¿™ä¸ªè½¬æ¢è¿‡ç¨‹è¢«ç§°ä¸º"tokenization"ï¼Œå®ƒå°†åŸå§‹æ–‡æœ¬åˆ†æˆä¸€ç³»åˆ—"token"ï¼Œå¹¶å°†æ¯ä¸ªtokenæ˜ å°„åˆ°ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°IDã€‚æ¨¡å‹æ¥æ”¶è¿™äº›æ•´æ•°IDä½œä¸ºè¾“å…¥ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æ¥è®¡ç®—è¾“å‡ºã€‚åœ¨Hugging Face Transformersåº“ä¸­ï¼Œæ¯ä¸ªæ¨¡å‹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„tokenizerï¼Œç”¨äºå°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºæ¨¡å‹éœ€è¦çš„æ ¼å¼ã€‚tokenizerå°†è¾“å…¥æ–‡æœ¬åˆ†æˆtokenï¼Œå¹¶å°†æ¯ä¸ªtokenæ˜ å°„åˆ°ä¸€ä¸ªæ•´æ•°IDã€‚tokenizerè¿˜å¯ä»¥æ‰§è¡Œå…¶ä»–çš„é¢„å¤„ç†æ­¥éª¤ï¼Œä¾‹å¦‚æˆªæ–­ã€å¡«å……ç­‰ç­‰ã€‚if type(model) is transformers.LlamaForCausalLM:tokenizer = LlamaTokenizer.from_pretrained(checkpoint, clean_up_tokenization_spaces=True)å›ç­”ä½ çš„é—®é¢˜ï¼Œè¿™æ®µä»£ç æ£€æŸ¥æ¨¡å‹æ˜¯å¦æ˜¯`LlamaForCausalLM`ç±»çš„å®ä¾‹ã€‚å¦‚æœæ˜¯ï¼Œå°±ä½¿ç”¨`LlamaTokenizer`ç±»çš„`from_pretrained`æ–¹æ³•åŠ è½½ç›¸åº”çš„tokenizerã€‚è¿™ä¸ªtokenizerå°†è¾“å…¥æ–‡æœ¬åˆ†æˆtokenï¼Œå¹¶å°†æ¯ä¸ªtokenæ˜ å°„åˆ°ä¸€ä¸ªæ•´æ•°IDï¼Œä»¥ä¾¿æ¨¡å‹å¯ä»¥å¤„ç†ã€‚åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œtokenizerçš„ä½œç”¨æ˜¯å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºæ¨¡å‹éœ€è¦çš„æ ¼å¼ï¼Œä»¥ä¾¿æ¨¡å‹å¯ä»¥è®¡ç®—è¾“å‡ºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„æ¨¡å‹å¯èƒ½éœ€è¦ä¸åŒçš„tokenizerã€‚å¦‚æœä½¿ç”¨é”™è¯¯çš„tokenizerï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹æ— æ³•æ­£ç¡®å¤„ç†è¾“å…¥æ•°æ®ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨æ¨¡å‹ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„tokenizerå¯¹è¾“å…¥æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="cls-x3D-get-class-from-dynamic-module-class-reference-x3D-â€fnlp-x2F-moss-moon-003-sftâ€“modeling-moss-MossForCausalLMâ€ï¼Œ-pretrained-model-name-or-path-x3D-checkpoint-ä»€ä¹ˆæ„æ€"><a href="#cls-x3D-get-class-from-dynamic-module-class-reference-x3D-â€fnlp-x2F-moss-moon-003-sftâ€“modeling-moss-MossForCausalLMâ€ï¼Œ-pretrained-model-name-or-path-x3D-checkpoint-ä»€ä¹ˆæ„æ€" class="headerlink" title="cls = get_class_from_dynamic_module(class_reference=â€fnlp/moss-moon-003-sftâ€“modeling_moss.MossForCausalLMâ€ï¼Œ pretrained_model_name_or_path=checkpoint)ä»€ä¹ˆæ„æ€"></a>cls = get_class_from_dynamic_module(class_reference=â€fnlp/moss-moon-003-sftâ€“modeling_moss.MossForCausalLMâ€ï¼Œ pretrained_model_name_or_path=checkpoint)ä»€ä¹ˆæ„æ€</h5><pre class="line-numbers language-none"><code class="language-none">è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ä»åŠ¨æ€æ¨¡å—ä¸­è·å–ä¸€ä¸ªç±»å¯¹è±¡ã€‚å…·ä½“æ¥è¯´ï¼Œè¯¥å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š- `class_reference`ï¼šç±»çš„å¼•ç”¨ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¼•ç”¨æ˜¯ `fnlp/moss-moon-003-sft--modeling_moss.MossForCausalLM`ï¼Œè¿™æ„å‘³ç€è¯¥å‡½æ•°å°†å°è¯•ä» `fnlp/moss-moon-003-sft--modeling_moss` åŠ¨æ€æ¨¡å—ä¸­è·å–ä¸€ä¸ªåä¸º `MossForCausalLM` çš„ç±»ã€‚- `pretrained_model_name_or_path`ï¼šé¢„è®­ç»ƒæ¨¡å‹çš„åç§°æˆ–è·¯å¾„ã€‚è¯¥å‚æ•°ç”¨äºå®ä¾‹åŒ– `MossForCausalLM` ç±»çš„å¯¹è±¡ã€‚è¯¥å‡½æ•°çš„å®ç°å¯èƒ½ç±»ä¼¼äºä»¥ä¸‹ä»£ç ï¼š```pythondef get_class_from_dynamic_module(class_reference,pretrained_model_name_or_path):    # ä»ç±»å¼•ç”¨ä¸­è·å–æ¨¡å—åç§°å’Œç±»åç§°    module_name, class_name = class_reference.rsplit(".", 1)    # åŠ¨æ€å¯¼å…¥æ¨¡å—    module = importlib.import_module(module_name)    # ä»æ¨¡å—ä¸­è·å–ç±»å¯¹è±¡    cls = getattr(module, class_name)    # å®ä¾‹åŒ–å¯¹è±¡å¹¶è¿”å›    return cls.from_pretrained(pretrained_model_name_or_path)```è¿™ä¸ªå‡½æ•°é¦–å…ˆå°†ç±»å¼•ç”¨åˆ†è§£æˆæ¨¡å—åç§°å’Œç±»åç§°ã€‚ç„¶åï¼Œå®ƒåŠ¨æ€åœ°å¯¼å…¥æ¨¡å—ï¼Œå¹¶ä»æ¨¡å—ä¸­è·å–ç±»å¯¹è±¡ã€‚æœ€åï¼Œå®ƒä½¿ç”¨ç»™å®šçš„é¢„è®­ç»ƒæ¨¡å‹åç§°æˆ–è·¯å¾„å®ä¾‹åŒ–ç±»å¯¹è±¡ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="åˆ†æä»£ç with-init-empty-weights"><a href="#åˆ†æä»£ç with-init-empty-weights" class="headerlink" title="åˆ†æä»£ç with init_empty_weights():"></a>åˆ†æä»£ç with init_empty_weights():</h5><pre><code>model = LoaderClass.from_config(self.model_config,trust_remote_code = True)model.tie_weights()</code></pre><pre class="line-numbers language-none"><code class="language-none">è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ä½¿ç”¨ä¸€ä¸ªç©ºçš„æƒé‡åˆå§‹åŒ–æ¨¡å‹ï¼Œç„¶åå°†æ¨¡å‹çš„æƒé‡ç»‘å®šåˆ°æ¨¡å‹ä¸­çš„æ‰€æœ‰å…±äº«å±‚ã€‚è¿™ä¸ªæ“ä½œé€šå¸¸ç”¨äºåŠ è½½å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹çš„é…ç½®ï¼Œä½†æ˜¯ä¸æƒ³ä½¿ç”¨å®ƒçš„æƒé‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç©ºçš„æƒé‡åˆå§‹åŒ–æ¨¡å‹ï¼Œç„¶åå°†æ¨¡å‹çš„æƒé‡ç»‘å®šåˆ°æ¨¡å‹ä¸­çš„å…±äº«å±‚ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥åœ¨ä¸ä½¿ç”¨å·²æœ‰æ¨¡å‹çš„æƒé‡çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å·²æœ‰æ¨¡å‹çš„é…ç½®æ¥æ„å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`LoaderClass`æ˜¯ä¸€ä¸ªç”¨äºåŠ è½½æ¨¡å‹çš„ç±»ï¼Œ`from_config`æ–¹æ³•ç”¨äºæ ¹æ®ç»™å®šçš„é…ç½®åˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹å¯¹è±¡ï¼Œ`trust_remote_code`å‚æ•°è®¾ç½®ä¸º`True`è¡¨ç¤ºä¿¡ä»»è¿œç¨‹ä»£ç ï¼Œå¯ä»¥ç”¨äºä»è¿œç¨‹åŠ è½½æ¨¡å‹ã€‚`tie_weights`æ–¹æ³•ç”¨äºå°†æ¨¡å‹ä¸­çš„å…±äº«å±‚ç»‘å®šåˆ°ä¸€èµ·ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥å…±äº«ç›¸åŒçš„æƒé‡ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ¨¡å‹å‚æ•°çš„æ•°é‡ï¼Œæé«˜æ¨¡å‹çš„è®­ç»ƒæ•ˆç‡ã€‚`with`è¯­å¥æ˜¯Pythonä¸­çš„ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†èµ„æºçš„ç”³è¯·å’Œé‡Šæ”¾ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`with init_empty_weights():`è¯­å¥ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨`init_empty_weights()`ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨åœ¨è¿›å…¥ä¸Šä¸‹æ–‡æ—¶æ‰§è¡Œä¸€äº›æ“ä½œï¼Œç„¶ååœ¨é€€å‡ºä¸Šä¸‹æ–‡æ—¶å†æ‰§è¡Œä¸€äº›æ“ä½œã€‚åœ¨è¿™é‡Œï¼Œ`init_empty_weights()`ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ä½œç”¨æ˜¯ç”¨ä¸€ä¸ªç©ºçš„æƒé‡åˆå§‹åŒ–æ¨¡å‹ï¼Œå½“é€€å‡ºä¸Šä¸‹æ–‡æ—¶ï¼Œæ¨¡å‹å°†è¢«ä¿å­˜åœ¨`model`å˜é‡ä¸­ã€‚ä½¿ç”¨`with`è¯­å¥çš„å¥½å¤„æ˜¯ï¼Œåœ¨é€€å‡ºä¸Šä¸‹æ–‡æ—¶ï¼ŒPythonä¼šè‡ªåŠ¨è°ƒç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„`__exit__()`æ–¹æ³•ï¼Œé‡Šæ”¾èµ„æºå¹¶æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨ä»£ç ä¸­æ˜¾å¼åœ°è°ƒç”¨èµ„æºé‡Šæ”¾å’Œæ¸…ç†æ“ä½œï¼Œä»è€Œä½¿ä»£ç æ›´åŠ ç®€æ´å’Œå¯è¯»ã€‚åŒæ—¶ï¼Œä½¿ç”¨`with`è¯­å¥è¿˜å¯ä»¥ç¡®ä¿èµ„æºçš„æ­£ç¡®é‡Šæ”¾ï¼Œæ— è®ºä»£ç ä¸­æ˜¯å¦å‡ºç°äº†å¼‚å¸¸æˆ–é”™è¯¯ï¼Œéƒ½å¯ä»¥ä¿è¯èµ„æºè¢«æ­£ç¡®é‡Šæ”¾ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="åœ¨pythonä¸­ï¼Œæ¨¡å—å’ŒåŒ…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#åœ¨pythonä¸­ï¼Œæ¨¡å—å’ŒåŒ…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="åœ¨pythonä¸­ï¼Œæ¨¡å—å’ŒåŒ…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"></a>åœ¨pythonä¸­ï¼Œæ¨¡å—å’ŒåŒ…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</h5><pre class="line-numbers language-none"><code class="language-none">åœ¨Pythonä¸­ï¼Œæ¨¡å—å’ŒåŒ…éƒ½æ˜¯ç»„ç»‡ä»£ç çš„æ–¹å¼ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œä½¿ç”¨æ–¹å¼ç•¥æœ‰ä¸åŒã€‚æ¨¡å—æ˜¯Pythonä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å«Pythonä»£ç çš„æ–‡ä»¶ï¼Œé€šå¸¸ä»¥`.py`ä¸ºæ‰©å±•åã€‚æ¨¡å—å¯ä»¥åŒ…å«å®šä¹‰å˜é‡ã€å‡½æ•°ã€ç±»å’Œè¯­å¥çš„ä»£ç ï¼Œå¯ä»¥è¢«å…¶ä»–æ¨¡å—æˆ–ç¨‹åºå¯¼å…¥å’Œä½¿ç”¨ã€‚åœ¨Pythonä¸­ï¼Œå¯ä»¥ä½¿ç”¨`import`è¯­å¥å¯¼å…¥ä¸€ä¸ªæ¨¡å—ï¼Œå¹¶ä½¿ç”¨æ¨¡å—ä¸­å®šä¹‰çš„å˜é‡ã€å‡½æ•°å’Œç±»ç­‰ã€‚åŒ…æ˜¯Pythonä¸­å¦ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ç›®å½•ã€‚åŒ…é€šå¸¸åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„`__init__.py`æ–‡ä»¶ï¼Œç”¨äºæŒ‡å®šåŒ…çš„åˆå§‹åŒ–ä»£ç å’Œå¯¼å…¥çš„æ¨¡å—åˆ—è¡¨ã€‚åœ¨Pythonä¸­ï¼Œå¯ä»¥ä½¿ç”¨`import`è¯­å¥å¯¼å…¥ä¸€ä¸ªåŒ…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`from ... import`è¯­å¥å¯¼å…¥ä¸€ä¸ªåŒ…ä¸­çš„æ¨¡å—ã€å˜é‡ã€å‡½æ•°å’Œç±»ç­‰ã€‚å› æ­¤ï¼Œæ¨¡å—å’ŒåŒ…çš„åŒºåˆ«åœ¨äºï¼š1. æ¨¡å—æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«Pythonä»£ç ï¼›åŒ…æ˜¯ä¸€ä¸ªç›®å½•ï¼ŒåŒ…å«å¤šä¸ªæ¨¡å—å’Œä¸€ä¸ª`__init__.py`æ–‡ä»¶ã€‚2. æ¨¡å—é€šå¸¸åŒ…å«ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œå¯ä»¥è¢«å…¶ä»–æ¨¡å—æˆ–ç¨‹åºå¯¼å…¥å’Œä½¿ç”¨ï¼›åŒ…é€šå¸¸åŒ…å«å¤šä¸ªç›¸å…³çš„æ¨¡å—ï¼Œç”¨äºç»„ç»‡å’Œç®¡ç†ä»£ç ã€‚3. åœ¨Pythonä¸­ï¼Œå¯ä»¥ä½¿ç”¨`import`è¯­å¥å¯¼å…¥ä¸€ä¸ªæ¨¡å—æˆ–åŒ…ï¼Œä½†æ˜¯å¯¼å…¥åŒ…æ—¶éœ€è¦æŒ‡å®šå…·ä½“çš„æ¨¡å—æˆ–å­åŒ…åç§°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¨¡å—å’ŒåŒ…æ˜¯Pythonä¸­éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç»„ç»‡å’Œç®¡ç†ä»£ç ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œåº”è¯¥æ ¹æ®éœ€è¦åˆç†åœ°ä½¿ç”¨æ¨¡å—å’ŒåŒ…ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="loggingæ–‡ä»¶æ—¥å¿—"><a href="#loggingæ–‡ä»¶æ—¥å¿—" class="headerlink" title="loggingæ–‡ä»¶æ—¥å¿—"></a>loggingæ–‡ä»¶æ—¥å¿—</h5><pre class="line-numbers language-none"><code class="language-none">åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `logging` æ¨¡å—æ¥è¾“å‡ºæ—¥å¿—ã€‚è¯¥æ¨¡å—æä¾›äº†ä¸€ç§çµæ´»ä¸”å¯å®šåˆ¶çš„æ–¹å¼æ¥è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œå¹¶å¯ä»¥æ§åˆ¶æ—¥å¿—çš„è¾“å‡ºçº§åˆ«ã€æ ¼å¼å’Œç›®æ ‡ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ `logging` æ¨¡å—è¾“å‡ºæ—¥å¿—ï¼š```pythonimport logging# é…ç½®æ—¥å¿—ä¿¡æ¯logging.basicConfig(filename='example.log', level=logging.DEBUG, format='%(asctime)s %(levelname)s %(message)s')# è¾“å‡ºæ—¥å¿—ä¿¡æ¯logging.debug('This is a debug message')logging.info('This is an info message')logging.warning('This is a warning message')logging.error('This is an error message')logging.critical('This is a critical message')```åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ `basicConfig()` æ–¹æ³•é…ç½®äº†æ—¥å¿—ä¿¡æ¯ï¼ŒæŒ‡å®šäº†æ—¥å¿—æ–‡ä»¶çš„åç§°ä¸º `example.log`ï¼Œæ—¥å¿—çº§åˆ«ä¸º `DEBUG`ï¼Œæ—¥å¿—æ ¼å¼ä¸º `%(asctime)s %(levelname)s %(message)s`ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ `logging` æ¨¡å—çš„ä¸åŒæ–¹æ³•è¾“å‡ºä¸åŒçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ã€‚è¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯å°†è¢«å†™å…¥åˆ°æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”æ ¹æ®é…ç½®çš„æ—¥å¿—çº§åˆ«ï¼Œåªæœ‰ç­‰äºæˆ–é«˜äºè¯¥çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯æ‰ä¼šè¢«è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œç”±äºæŒ‡å®šçš„æ—¥å¿—çº§åˆ«ä¸º `DEBUG`ï¼Œå› æ­¤æ‰€æœ‰çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯éƒ½ä¼šè¢«è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚å½“ç„¶ï¼Œæ‚¨è¿˜å¯ä»¥æ ¹æ®éœ€è¦è¿›ä¸€æ­¥é…ç½®æ—¥å¿—ä¿¡æ¯ï¼Œå¦‚æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ã€å¤‡ä»½æ•°é‡ç­‰ï¼Œä»¥åŠå°†æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€é‚®ä»¶ç­‰ç›®æ ‡ã€‚æ›´å¤šå…³äº `logging` æ¨¡å—çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.python.org/3/library/logging.htmlã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="å‘é‡åº“ç”Ÿæˆä¸­FAISSç±»æ¢ç©¶"><a href="#å‘é‡åº“ç”Ÿæˆä¸­FAISSç±»æ¢ç©¶" class="headerlink" title="å‘é‡åº“ç”Ÿæˆä¸­FAISSç±»æ¢ç©¶"></a>å‘é‡åº“ç”Ÿæˆä¸­FAISSç±»æ¢ç©¶</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python">    <span class="token comment">#FAISSå‘é‡çš„åˆå§‹åŒ–</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        embedding_function<span class="token punctuation">:</span> Callable<span class="token punctuation">,</span>  <span class="token comment">#ä¸€ä¸ªå¯ä»¥è°ƒç”¨çš„å¯¹è±¡(å‡½æ•°æˆ–è€…æ–¹æ³•)ï¼Œç”¨äºå°†æ–‡æœ¬è½¬åŒ–ä¸ºå‘é‡</span>        index<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>       <span class="token comment">#å‘é‡ç´¢å¼•åº“ï¼Œç”¨äºå­˜å‚¨å‘é‡å’Œå®ç°æ£€ç´¢åŠŸèƒ½</span>        docstore<span class="token punctuation">:</span> Docstore<span class="token punctuation">,</span>   <span class="token comment">#æ–‡æœ¬å­˜å‚¨åº“ï¼Œç”¨äºå­˜å‚¨åŸå§‹æ–‡æœ¬å’Œæ–‡æœ¬çš„å…ƒæ•°æ®ä¿¡æ¯</span>        index_to_docstore_id<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">#ä¸€ä¸ªå­—å…¸ï¼Œç”¨äºå°†å‘é‡ç´¢å¼•åº“çš„IDæ˜ å°„åˆ°æ–‡æœ¬å­˜å‚¨åº“ä¸­çš„ID</span>        relevance_score_fn<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>             Callable<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span>        <span class="token punctuation">]</span> <span class="token operator">=</span> _default_relevance_score_fn<span class="token punctuation">,</span>    <span class="token comment">#ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡(å‡½æ•°æˆ–è€…æ–¹æ³•)ï¼Œç”¨äºè®¡ç®—æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§å¾—åˆ†(å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºå†…ç½®çš„ç›¸å…³æ€§å¾—åˆ†å‡½æ•°)</span>        normalize_L2<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>      <span class="token comment">#æ˜¯å¦å¯¹å‘é‡è¿›è¡ŒL2å½’ä¸€åŒ–</span>    <span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Initialize with necessary components."""</span>        self<span class="token punctuation">.</span>embedding_function <span class="token operator">=</span> embedding_function        self<span class="token punctuation">.</span>index <span class="token operator">=</span> index        self<span class="token punctuation">.</span>docstore <span class="token operator">=</span> docstore        self<span class="token punctuation">.</span>index_to_docstore_id <span class="token operator">=</span> index_to_docstore_id        self<span class="token punctuation">.</span>relevance_score_fn <span class="token operator">=</span> relevance_score_fn        self<span class="token punctuation">.</span>_normalize_L2 <span class="token operator">=</span> normalize_L2        <span class="token comment">###indexå¦‚ä½•æŒ‡å®šå’Œå®šä¹‰</span>IndexFlatL2ï¼šåŸºäº L2 è·ç¦»åº¦é‡çš„ Flat ç´¢å¼•ï¼Œé€‚ç”¨äºå°è§„æ¨¡çš„å‘é‡æ£€ç´¢å’Œç²¾ç¡®æ£€ç´¢ã€‚IndexIVFFlatï¼šåŸºäºå€’æ’ç´¢å¼•ï¼ˆInverted Fileï¼‰çš„ Flat ç´¢å¼•ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡çš„å‘é‡æ£€ç´¢å’Œè¿‘ä¼¼æ£€ç´¢ã€‚IndexIVFPQï¼šåŸºäºå€’æ’ç´¢å¼•å’Œ Product Quantization çš„ç´¢å¼•ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡çš„å‘é‡æ£€ç´¢å’Œé«˜æ•ˆçš„è¿‘ä¼¼æ£€ç´¢ã€‚eg<span class="token punctuation">:</span><span class="token keyword">import</span> faissd <span class="token operator">=</span> <span class="token number">128</span>  <span class="token comment"># å‘é‡ç»´åº¦</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>IndexFlatL2<span class="token punctuation">(</span>d<span class="token punctuation">)</span>    åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†å‘é‡çš„ç»´åº¦ dï¼Œç„¶åä½¿ç”¨ faiss<span class="token punctuation">.</span>IndexFlatL2 ç±»åˆ›å»ºäº†ä¸€ä¸ªåŸºäº L2 è·ç¦»åº¦é‡çš„ Flat ç´¢å¼•ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡ indexã€‚è¿™ä¸ªç´¢å¼•å¯¹è±¡å¯ä»¥ç”¨æ¥å­˜å‚¨å‘é‡å’Œè¿›è¡Œç²¾ç¡®çš„å‘é‡æ£€ç´¢ã€‚<span class="token comment">###</span><span class="token comment">###æ–¹æ³•</span><span class="token keyword">def</span> <span class="token function">add_texts</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        texts<span class="token punctuation">:</span> Iterable<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        metadatas<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>        ids<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    å‘ç´¢å¼•ä¸­æ·»åŠ æ–‡æœ¬æ•°æ®ã€‚    :param texts: ä¸€ä¸ªåŒ…å«å¤šä¸ªæ–‡æœ¬çš„å¯è¿­ä»£å¯¹è±¡ï¼Œæ¯ä¸ªå…ƒç´ è¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬ã€‚    :param metadatas: ä¸€ä¸ªå¯é€‰çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸ªæ–‡æœ¬çš„å…ƒæ•°æ®ã€‚æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«æ–‡æœ¬çš„å…¶å®ƒå±æ€§ä¿¡æ¯ã€‚    :param ids: ä¸€ä¸ªå¯é€‰çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸ªæ–‡æœ¬çš„ IDã€‚å¦‚æœä¸æä¾›ï¼Œåˆ™é»˜è®¤ä¸º 0, 1, 2, ...    :param kwargs: å…¶å®ƒå¯é€‰å‚æ•°ï¼Œç”¨äºæ§åˆ¶æ–‡æœ¬å¤„ç†å’Œç‰¹å¾æå–çš„è¿‡ç¨‹ã€‚    :return: ä¸€ä¸ªåŒ…å«æ¯ä¸ªæ–‡æœ¬çš„ ID çš„åˆ—è¡¨ã€‚    """</span>    ç”Ÿæˆå‘é‡çš„æ–¹å¼ï¼šembeddings <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>embedding_function<span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token keyword">for</span> text <span class="token keyword">in</span> texts<span class="token punctuation">]</span>   <span class="token comment">#é¢„è®­ç»ƒçš„æ¨¡å‹ï¼Œç”¨çš„Transformer</span>    vector <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>embeddings<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>                <span class="token comment">###</span><span class="token keyword">def</span> <span class="token function">add_embeddings</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        text_embeddings<span class="token punctuation">:</span> Iterable<span class="token punctuation">[</span>Tuple<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        metadatas<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>        ids<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    å‘ç´¢å¼•ä¸­æ·»åŠ æ–‡æœ¬ç‰¹å¾å‘é‡æ•°æ®ã€‚    :param text_embeddings: ä¸€ä¸ªåŒ…å«å¤šä¸ªæ–‡æœ¬ç‰¹å¾å‘é‡çš„å¯è¿­ä»£å¯¹è±¡ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå…ƒç»„ (text, embedding)ï¼Œè¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬å’Œå…¶å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚    :param metadatas: ä¸€ä¸ªå¯é€‰çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸ªæ–‡æœ¬çš„å…ƒæ•°æ®ã€‚æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«æ–‡æœ¬çš„å…¶å®ƒå±æ€§ä¿¡æ¯ã€‚    :param ids: ä¸€ä¸ªå¯é€‰çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸ªæ–‡æœ¬çš„ IDã€‚å¦‚æœä¸æä¾›ï¼Œåˆ™é»˜è®¤ä¸º 0, 1, 2, ...    :param kwargs: å…¶å®ƒå¯é€‰å‚æ•°ï¼Œç”¨äºæ§åˆ¶ç‰¹å¾å¤„ç†å’Œç‰¹å¾æå–çš„è¿‡ç¨‹ã€‚    :return: ä¸€ä¸ªåŒ…å«æ¯ä¸ªæ–‡æœ¬çš„ ID çš„åˆ—è¡¨ã€‚    """</span>                    <span class="token comment">###</span><span class="token keyword">def</span> <span class="token function">similarity_search_with_score_by_vector</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        embedding<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>        <span class="token builtin">filter</span><span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>        fetch_k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Tuple<span class="token punctuation">[</span>Document<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    æ ¹æ®è¾“å…¥çš„ç‰¹å¾å‘é‡è¿›è¡Œç›¸ä¼¼åº¦æ£€ç´¢ï¼Œå¹¶è¿”å›æ–‡æœ¬åˆ—è¡¨åŠå…¶ä¸è¾“å…¥å‘é‡çš„ç›¸ä¼¼åº¦å¾—åˆ†ã€‚    :param embedding: ä¸€ä¸ªåŒ…å«æ–‡æœ¬ç‰¹å¾å‘é‡çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºè¾“å…¥çš„ç‰¹å¾å‘é‡ã€‚    :param k: ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºéœ€è¦æ£€ç´¢çš„æœ€è¿‘é‚»è¿‘ä¼¼åº¦æ•°é‡ã€‚    :param filter: ä¸€ä¸ªå¯é€‰çš„å­—å…¸ï¼Œè¡¨ç¤ºéœ€è¦è¿‡æ»¤çš„æ¡ä»¶ã€‚å­—å…¸çš„é”®è¡¨ç¤ºè¿‡æ»¤æ¡ä»¶ï¼Œå€¼è¡¨ç¤ºè¿‡æ»¤æ¡ä»¶å¯¹åº”çš„å€¼ã€‚    :param fetch_k: ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºéœ€è¦ä»ç´¢å¼•ä¸­è·å–çš„æ–‡æœ¬æ•°é‡ã€‚    :param kwargs: å…¶å®ƒå¯é€‰å‚æ•°ï¼Œç”¨äºæ§åˆ¶ç‰¹å¾å¤„ç†å’Œç‰¹å¾æå–çš„è¿‡ç¨‹ã€‚    :return: ä¸€ä¸ªåŒ…å«å…ƒç»„çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç»„è¡¨ç¤ºä¸€ä¸ªæ£€ç´¢åˆ°çš„æ–‡æœ¬åŠå…¶ä¸è¾“å…¥å‘é‡çš„ç›¸ä¼¼åº¦å¾—åˆ†ã€‚    """</span><span class="token operator">**</span><span class="token operator">*</span>æ³¨æ„<span class="token operator">**</span><span class="token operator">*</span>`k` å’Œ `fetch_k` å‚æ•°å¹¶ä¸ç›´æ¥å†²çªï¼Œå› ä¸ºå®ƒä»¬æ§åˆ¶çš„æ˜¯ä¸åŒçš„å†…å®¹ã€‚`k` å‚æ•°æ§åˆ¶çš„æ˜¯éœ€è¦æ£€ç´¢çš„æœ€è¿‘é‚»è¿‘ä¼¼åº¦æ•°é‡ï¼Œè€Œ `fetch_k` å‚æ•°æ§åˆ¶çš„æ˜¯éœ€è¦ä»ç´¢å¼•ä¸­è·å–çš„æ–‡æœ¬æ•°é‡ã€‚åœ¨è¿›è¡Œç›¸ä¼¼åº¦æ£€ç´¢æ—¶ï¼Œé¦–å…ˆä¼šä»ç´¢å¼•ä¸­è·å– `fetch_k` ä¸ªæ–‡æœ¬ï¼Œç„¶åä»è¿™äº›æ–‡æœ¬ä¸­é€‰æ‹©ä¸è¾“å…¥å‘é‡ç›¸ä¼¼åº¦æœ€é«˜çš„ `k` ä¸ªæ–‡æœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `k<span class="token operator">=</span><span class="token number">4</span>`ï¼Œ`fetch_k<span class="token operator">=</span><span class="token number">20</span>`ï¼Œåˆ™è¡¨ç¤ºéœ€è¦ä»ç´¢å¼•ä¸­è·å–ä¸è¾“å…¥å‘é‡ç›¸ä¼¼åº¦æœ€é«˜çš„ <span class="token number">20</span> ä¸ªæ–‡æœ¬ï¼Œç„¶åå†ä»è¿™ <span class="token number">20</span> ä¸ªæ–‡æœ¬ä¸­é€‰æ‹©ä¸è¾“å…¥å‘é‡ç›¸ä¼¼åº¦æœ€é«˜çš„ <span class="token number">4</span> ä¸ªæ–‡æœ¬ã€‚å®é™…ä¸Šï¼Œ`fetch_k` çš„å–å€¼å¯ä»¥æ¯” `k` å¤§ï¼Œè¿™æ ·å¯ä»¥ä¿è¯åœ¨é€‰æ‹©ä¸è¾“å…¥å‘é‡ç›¸ä¼¼åº¦æœ€é«˜çš„ `k` ä¸ªæ–‡æœ¬æ—¶ï¼Œæœ‰æ›´å¤šçš„æ–‡æœ¬å¯ä¾›é€‰æ‹©ï¼Œä»è€Œæé«˜æ£€ç´¢çš„å‡†ç¡®æ€§ã€‚ä½†æ˜¯ï¼Œè®¾ç½®è¿‡å¤§çš„ `fetch_k` å€¼å¯èƒ½ä¼šå½±å“æ£€ç´¢æ•ˆç‡å’Œå†…å­˜æ¶ˆè€—ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹ä¸Šé¢similarity_search_with_score_by_vectorçš„å°è£…ã€‚<span class="token keyword">def</span> <span class="token function">similarity_search_with_score</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>        k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>        <span class="token builtin">filter</span><span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>        fetch_k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Tuple<span class="token punctuation">[</span>Document<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    æ ¹æ®è¾“å…¥çš„æ–‡æœ¬è¿›è¡Œç›¸ä¼¼åº¦æ£€ç´¢ï¼Œå¹¶è¿”å›æ–‡æœ¬åˆ—è¡¨åŠå…¶ä¸è¾“å…¥æ–‡æœ¬çš„ç›¸ä¼¼åº¦å¾—åˆ†ã€‚    :param query: ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¾“å…¥çš„æ–‡æœ¬ã€‚    :param k: ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºéœ€è¦æ£€ç´¢çš„æœ€è¿‘é‚»è¿‘ä¼¼åº¦æ•°é‡ã€‚    :param filter: ä¸€ä¸ªå¯é€‰çš„å­—å…¸ï¼Œè¡¨ç¤ºéœ€è¦è¿‡æ»¤çš„æ¡ä»¶ã€‚å­—å…¸çš„é”®è¡¨ç¤ºè¿‡æ»¤æ¡ä»¶ï¼Œå€¼è¡¨ç¤ºè¿‡æ»¤æ¡ä»¶å¯¹åº”çš„å€¼ã€‚    :param fetch_k: ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºéœ€è¦ä»ç´¢å¼•ä¸­è·å–çš„æ–‡æœ¬æ•°é‡ã€‚    :param kwargs: å…¶å®ƒå¯é€‰å‚æ•°ï¼Œç”¨äºæ§åˆ¶ç‰¹å¾å¤„ç†å’Œç‰¹å¾æå–çš„è¿‡ç¨‹ã€‚    :return: ä¸€ä¸ªåŒ…å«å…ƒç»„çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç»„è¡¨ç¤ºä¸€ä¸ªæ£€ç´¢åˆ°çš„æ–‡æœ¬åŠå…¶ä¸è¾“å…¥æ–‡æœ¬çš„ç›¸ä¼¼åº¦å¾—åˆ†ã€‚    """</span><span class="token builtin">filter</span> å‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„å­—å…¸ï¼Œè¡¨ç¤ºéœ€è¦è¿‡æ»¤çš„æ¡ä»¶ã€‚å­—å…¸çš„é”®è¡¨ç¤ºè¿‡æ»¤æ¡ä»¶ï¼Œå€¼è¡¨ç¤ºè¿‡æ»¤æ¡ä»¶å¯¹åº”çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ <span class="token builtin">filter</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'category'</span><span class="token punctuation">:</span> <span class="token string">'sports'</span><span class="token punctuation">}</span> æ¥è¿‡æ»¤ç±»åˆ«ä¸º <span class="token string">'sports'</span> çš„æ–‡æœ¬ã€‚<span class="token comment">#æŸ¥è¯¢å¾—åˆ†</span><span class="token keyword">for</span> doc<span class="token punctuation">,</span> score <span class="token keyword">in</span> results<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>text<span class="token punctuation">,</span> score<span class="token punctuation">)</span>                <span class="token comment">###</span><span class="token keyword">def</span> <span class="token function">similarity_search_by_vector</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        embedding<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>        <span class="token builtin">filter</span><span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>        fetch_k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Document<span class="token punctuation">]</span><span class="token punctuation">:</span>    embeddingï¼šä¸€ä¸ªæµ®ç‚¹æ•°åˆ—è¡¨ï¼Œè¡¨ç¤ºæŸ¥è¯¢å‘é‡çš„åµŒå…¥ï¼ˆembeddingï¼‰ã€‚kï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦è¿”å›çš„æœ€ç›¸ä¼¼æ–‡æ¡£çš„æ•°é‡ã€‚é»˜è®¤ä¸º <span class="token number">4</span>ã€‚<span class="token builtin">filter</span>ï¼šä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºè¦è¿‡æ»¤çš„æ–‡æ¡£å±æ€§ã€‚è¯¥å­—å…¸çš„é”®å€¼å¯¹è¡¨ç¤ºè¦è¿‡æ»¤çš„å±æ€§å’Œå…¶å¯¹åº”çš„å€¼ã€‚é»˜è®¤   ä¸º <span class="token boolean">None</span>ï¼Œè¡¨ç¤ºä¸è¿›è¡Œè¿‡æ»¤ã€‚fetch_kï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦ä»å€’æ’ç´¢å¼•ä¸­æ£€ç´¢çš„æ–‡æ¡£æ•°é‡ã€‚é»˜è®¤ä¸º <span class="token number">20</span>ã€‚<span class="token operator">**</span>kwargsï¼šä¸€ä¸ªå¯å˜å…³é”®å­—å‚æ•°ï¼Œè¡¨ç¤ºå…¶ä»–å‚æ•°        è¿™ä¸ªæ–¹æ³•çš„å®ç°ä¾æ®similarity_search_with_scoreæ–¹æ³•ï¼Œä¸è¿‡åªå–å‡ºäº†å‰é¢éƒ¨åˆ†<span class="token keyword">def</span> <span class="token function">similarity_search</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>        k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>        <span class="token builtin">filter</span><span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>        fetch_k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Document<span class="token punctuation">]</span><span class="token punctuation">:</span>    queryï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæŸ¥è¯¢çš„æ–‡æœ¬ã€‚kï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦è¿”å›çš„æœ€ç›¸ä¼¼æ–‡æ¡£çš„æ•°é‡ã€‚é»˜è®¤ä¸º <span class="token number">4</span>ã€‚<span class="token builtin">filter</span>ï¼šä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºè¦è¿‡æ»¤çš„æ–‡æ¡£å±æ€§ã€‚è¯¥å­—å…¸çš„é”®å€¼å¯¹è¡¨ç¤ºè¦è¿‡æ»¤çš„å±æ€§å’Œå…¶å¯¹åº”çš„å€¼ã€‚é»˜è®¤ä¸º <span class="token boolean">None</span>ï¼Œè¡¨ç¤ºä¸è¿›è¡Œè¿‡æ»¤ã€‚fetch_kï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦ä»å€’æ’ç´¢å¼•ä¸­æ£€ç´¢çš„æ–‡æ¡£æ•°é‡ã€‚é»˜è®¤ä¸º <span class="token number">20</span>ã€‚<span class="token operator">**</span>kwargsï¼šä¸€ä¸ªå¯å˜å…³é”®å­—å‚æ•°ï¼Œè¡¨ç¤ºå…¶ä»–å‚æ•°ã€‚        <span class="token comment">###</span><span class="token keyword">def</span> <span class="token function">max_marginal_relevance_search_by_vector</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        embedding<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>        fetch_k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>        lambda_mult<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span>        <span class="token builtin">filter</span><span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Document<span class="token punctuation">]</span><span class="token punctuation">:</span>    embeddingï¼šä¸€ä¸ªæµ®ç‚¹æ•°åˆ—è¡¨ï¼Œè¡¨ç¤ºæŸ¥è¯¢å‘é‡çš„åµŒå…¥ï¼ˆembeddingï¼‰ã€‚kï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦è¿”å›çš„æœ€ç›¸ä¼¼æ–‡æ¡£çš„æ•°é‡ã€‚é»˜è®¤ä¸º <span class="token number">4</span>ã€‚fetch_kï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦ä»å€’æ’ç´¢å¼•ä¸­æ£€ç´¢çš„æ–‡æ¡£æ•°é‡ã€‚é»˜è®¤ä¸º <span class="token number">20</span>ã€‚lambda_multï¼šä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œè¡¨ç¤ºæŸ¥è¯¢å‘é‡å’Œæ–‡æ¡£å‘é‡ä¹‹é—´çš„æƒé‡ã€‚é»˜è®¤ä¸º <span class="token number">0.5</span>ã€‚<span class="token builtin">filter</span>ï¼šä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºè¦è¿‡æ»¤çš„æ–‡æ¡£å±æ€§ã€‚è¯¥å­—å…¸çš„é”®å€¼å¯¹è¡¨ç¤ºè¦è¿‡æ»¤çš„å±æ€§å’Œå…¶å¯¹åº”çš„å€¼ã€‚é»˜è®¤ä¸º <span class="token boolean">None</span>ï¼Œè¡¨ç¤ºä¸è¿›è¡Œè¿‡æ»¤ã€‚<span class="token operator">**</span>kwargsï¼šä¸€ä¸ªå¯å˜å…³é”®å­—å‚æ•°ï¼Œè¡¨ç¤ºå…¶ä»–å‚æ•°ã€‚             <span class="token operator">**</span><span class="token operator">*</span>è¯¥å‡½æ•°çš„ç®—æ³•        å½“æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªæ–‡æ¡£é›†åˆä¸­è¿›è¡Œç›¸ä¼¼åº¦æœç´¢æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å€’æ’ç´¢å¼•ç­‰æŠ€æœ¯æ¥å¿«é€Ÿå®šä½ä¸æŸ¥è¯¢æ–‡æœ¬æˆ–å‘é‡æœ€ç›¸ä¼¼çš„æ–‡æ¡£ã€‚ç„¶è€Œï¼Œä»…ä»…æ ¹æ®ç›¸ä¼¼åº¦æ¥æ’åºæ–‡æ¡£åˆ—è¡¨å¹¶ä¸ä¸€å®šèƒ½å¾—åˆ°æœ€å¥½çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ–°é—»æœç´¢å¼•æ“ä¸­ï¼Œå¦‚æœç”¨æˆ·æŸ¥è¯¢ <span class="token string">"å·´è¥¿è¶³çƒ"</span>ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¾—åˆ°å¾ˆå¤šç›¸å…³çš„æ–°é—»æ–‡ç« ï¼Œä½†è¿™äº›æ–‡ç« ä¹‹é—´å¯èƒ½ä¼šæœ‰å¾ˆå¤šé‡å¤çš„å†…å®¹å’Œè§‚ç‚¹ï¼Œè¿™æ ·å°±ä¸èƒ½æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€å¤§è¾¹é™…ç›¸å…³æ€§ <span class="token punctuation">(</span>MMR<span class="token punctuation">)</span> ç®—æ³•æ¥å¯¹æ–‡æ¡£åˆ—è¡¨è¿›è¡Œæ’åºå’Œç­›é€‰ã€‚MMR ç®—æ³•é€šè¿‡å°†æŸ¥è¯¢å‘é‡å’Œå·²ç»é€‰æ‹©çš„æ–‡æ¡£å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦è¿›è¡Œæƒè¡¡ï¼Œé€‰æ‹©ä¸æŸ¥è¯¢å‘é‡æœ€ç›¸å…³ä¸”å½¼æ­¤ä¹‹é—´ä¸å¤ªç›¸ä¼¼çš„æ–‡æ¡£ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ç»„æœ‰ä»£è¡¨æ€§ã€å¤šæ ·æ€§å’Œç›¸å…³æ€§çš„æ–‡æ¡£åˆ—è¡¨ï¼Œä»è€Œæ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨å®ç° `max_marginal_relevance_search_by_vector` å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š<span class="token number">1.</span> ä½¿ç”¨å€’æ’ç´¢å¼•æŸ¥æ‰¾ä¸æŸ¥è¯¢å‘é‡æœ€ç›¸ä¼¼çš„æ–‡æ¡£ï¼Œå¹¶å°†å®ƒä»¬æŒ‰ç›¸ä¼¼åº¦ä»é«˜åˆ°ä½æ’åˆ—ã€‚<span class="token number">2.</span> åˆå§‹åŒ–ä¸€ä¸ªæ–‡æ¡£åˆ—è¡¨ `selected_docs`ï¼Œå…¶ä¸­åŒ…å«ä¸æŸ¥è¯¢å‘é‡æœ€ç›¸ä¼¼çš„å‰ `k` ä¸ªæ–‡æ¡£ã€‚<span class="token number">3.</span> å¯¹äºå‰©ä½™çš„æ–‡æ¡£ï¼Œè®¡ç®—å®ƒä»¬ä¸æŸ¥è¯¢å‘é‡çš„ç›¸ä¼¼åº¦å’Œå®ƒä»¬ä¸å·²é€‰æ‹©æ–‡æ¡£çš„ç›¸ä¼¼åº¦ï¼Œå¹¶è®¡ç®—å®ƒä»¬çš„ MMR å€¼ã€‚MMR å€¼å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š   ````   MMR<span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">=</span> Î» Ã— sim<span class="token punctuation">(</span>d<span class="token punctuation">,</span> q<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> Î»<span class="token punctuation">)</span> Ã— <span class="token builtin">max</span><span class="token punctuation">(</span>sim<span class="token punctuation">(</span>d<span class="token punctuation">,</span> d<span class="token string">') for d'</span> <span class="token keyword">in</span> selected_docs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>å…¶ä¸­ï¼Œ`d` è¡¨ç¤ºå½“å‰æ–‡æ¡£ï¼Œ`q` è¡¨ç¤ºæŸ¥è¯¢å‘é‡ï¼Œ`Î»` è¡¨ç¤ºæŸ¥è¯¢å‘é‡å’Œæ–‡æ¡£å‘é‡ä¹‹é—´çš„æƒé‡ï¼Œ`sim(d, q)` è¡¨ç¤ºæ–‡æ¡£ `d` å’ŒæŸ¥è¯¢å‘é‡ `q` ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œ`sim(d, d')` è¡¨ç¤ºæ–‡æ¡£ `d` å’Œå·²é€‰æ‹©æ–‡æ¡£ `d'` ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚</code></pre><p>   å…¬å¼çš„æ„ä¹‰æ˜¯ï¼Œé€‰æ‹©ä¸æŸ¥è¯¢å‘é‡æœ€ç›¸å…³çš„æ–‡æ¡£ï¼Œå¹¶å‡å°‘ä¸å·²é€‰æ‹©æ–‡æ¡£ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œä»è€Œå¾—åˆ°ä¸æŸ¥è¯¢å‘é‡æœ€ç›¸å…³ä¸”å½¼æ­¤ä¹‹é—´ä¸å¤ªç›¸ä¼¼çš„æ–‡æ¡£ã€‚<br>4. å°†å‰©ä½™æ–‡æ¡£æŒ‰ç…§ MMR å€¼ä»é«˜åˆ°ä½æ’åºï¼Œå¹¶é€‰æ‹©å‰ <code>k</code> ä¸ªæ–‡æ¡£åŠ å…¥ <code>selected_docs</code> ä¸­ã€‚<br>5. è¿”å› <code>selected_docs</code>ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMMR ç®—æ³•çš„æ€§èƒ½å’Œæ•ˆæœå—åˆ°å‚æ•° <code>Î»</code> çš„å½±å“ã€‚å½“ <code>Î»</code> çš„å€¼è¾ƒå°æ—¶ï¼Œç®—æ³•æ›´åŠ æ³¨é‡æ–‡æ¡£ä¹‹é—´çš„å¤šæ ·æ€§ï¼Œè€Œå½“ <code>Î»</code> çš„å€¼è¾ƒå¤§æ—¶ï¼Œç®—æ³•æ›´åŠ æ³¨é‡æ–‡æ¡£ä¸æŸ¥è¯¢çš„ç›¸ä¼¼åº¦ã€‚åœ¨å®è·µä¸­ï¼Œå¯ä»¥æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œç”¨æˆ·éœ€æ±‚æ¥è°ƒæ•´ <code>Î»</code> çš„å€¼ã€‚</p><p>def max_marginal_relevance_search(<br>        self,<br>        query: str,<br>        k: int = 4,<br>        fetch_k: int = 20,<br>        lambda_mult: float = 0.5,<br>        filter: Optional[Dict[str, Any]] = None,<br>        **kwargs: Any,<br>    ) -&gt; List[Document]:</p><p>å‚æ•°ï¼š</p><ul><li><code>query</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæŸ¥è¯¢æ–‡æœ¬ã€‚</li><li><code>k</code>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦è¿”å›çš„æœ€ç›¸ä¼¼æ–‡æ¡£çš„æ•°é‡ã€‚é»˜è®¤ä¸º 4ã€‚</li><li><code>fetch_k</code>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦ä»å€’æ’ç´¢å¼•ä¸­æ£€ç´¢çš„æ–‡æ¡£æ•°é‡ã€‚é»˜è®¤ä¸º 20ã€‚</li><li><code>lambda_mult</code>ï¼šä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œè¡¨ç¤ºæŸ¥è¯¢å‘é‡å’Œæ–‡æ¡£å‘é‡ä¹‹é—´çš„æƒé‡ã€‚é»˜è®¤ä¸º 0.5ã€‚</li><li><code>filter</code>ï¼šä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºè¦è¿‡æ»¤çš„æ–‡æ¡£å±æ€§ã€‚è¯¥å­—å…¸çš„é”®å€¼å¯¹è¡¨ç¤ºè¦è¿‡æ»¤çš„å±æ€§å’Œå…¶å¯¹åº”çš„å€¼ã€‚é»˜è®¤ä¸º <code>None</code>ï¼Œè¡¨ç¤ºä¸è¿›è¡Œè¿‡æ»¤ã€‚</li><li><code>**kwargs</code>ï¼šä¸€ä¸ªå¯å˜å…³é”®å­—å‚æ•°ï¼Œè¡¨ç¤ºå…¶ä»–å‚æ•°ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>ä¸€ä¸ª <code>List[Document]</code> ç±»å‹çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºä¸æŸ¥è¯¢æ–‡æœ¬æœ€ç›¸å…³çš„æ–‡æ¡£åˆ—è¡¨ã€‚è¯¥åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª <code>Document</code> å¯¹è±¡ï¼ŒåŒ…å«ä¸æŸ¥è¯¢æ–‡æœ¬æœ€ç›¸å…³çš„æ–‡æ¡£çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ–‡æœ¬ã€å¾—åˆ†ã€ID ç­‰ã€‚</li></ul><p>å…·ä½“æ¥è¯´ï¼Œè¯¥å‡½æ•°çš„ä½œç”¨ä¸ <code>max_marginal_relevance_search_by_vector</code> å‡½æ•°ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒæ¥å—ä¸€ä¸ªæŸ¥è¯¢æ–‡æœ¬è€Œä¸æ˜¯æŸ¥è¯¢å‘é‡ä½œä¸ºè¾“å…¥ï¼Œå¹¶å°†æŸ¥è¯¢æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡åè°ƒç”¨ <code>max_marginal_relevance_search_by_vector</code> å‡½æ•°æ¥å®ç°ç›¸ä¼¼åº¦æœç´¢å’Œæ£€ç´¢ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨è¯­è¨€æ¨¡å‹æˆ–è¯åµŒå…¥æ¨¡å‹å°†æŸ¥è¯¢æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Œç„¶åå°†å‘é‡ä¼ é€’ç»™ <code>max_marginal_relevance_search_by_vector</code> å‡½æ•°è¿›è¡Œåç»­å¤„ç†ã€‚è¯¥å‡½æ•°é€šå¸¸ç”¨äºåœ¨æ–‡æ¡£é›†åˆä¸­è¿›è¡Œç›¸ä¼¼åº¦æœç´¢å’Œæ£€ç´¢ã€‚</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>def merge_from(self, target: FAISS) -&gt; None:</p><p>è¿™æ˜¯ä¸€ä¸ªæ–¹æ³•åä¸º merge_from çš„å‡½æ•°ï¼Œå®ƒå®šä¹‰åœ¨ä¸€ä¸ªåä¸º FAISS çš„å¯¹è±¡ä¸­ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å°†å¦ä¸€ä¸ª FAISS å¯¹è±¡åˆå¹¶è¿›å½“å‰å¯¹è±¡ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†ä¸¤ä¸ª FAISS å¯¹è±¡åˆå¹¶æˆä¸€ä¸ªæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ merge_from æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„å‚æ•° target æ˜¯ä¸€ä¸ª FAISS å¯¹è±¡ï¼Œè¡¨ç¤ºè¦åˆå¹¶è¿›å½“å‰å¯¹è±¡çš„ç›®æ ‡å¯¹è±¡ã€‚åˆå¹¶åï¼Œç›®æ ‡å¯¹è±¡çš„æ–‡æ¡£å°†è¢«æ·»åŠ åˆ°å½“å‰å¯¹è±¡çš„æ–‡æ¡£å­˜å‚¨å™¨ (docstore) ä¸­ï¼Œå¹¶ä¸”ç›®æ ‡å¯¹è±¡çš„ç´¢å¼• (index) å°†è¢«åˆå¹¶åˆ°å½“å‰å¯¹è±¡çš„ç´¢å¼•ä¸­ã€‚<br>###</p><pre><code>                                                                           def __from(  cls,  texts: List[str],  embeddings: List[List[float]],  embedding: Embeddings,  metadatas: Optional[List[dict]] = None,  ids: Optional[List[str]] = None,  normalize_L2: bool = False,  **kwargs: Any,</code></pre><p>  ) -&gt; FAISS:<br>                                                                                 è¿™æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œç”¨äºä»æ–‡æœ¬å’ŒåµŒå…¥åˆ—è¡¨ä¸­æ„å»ºä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ã€‚è¯¥å‡½æ•°çš„å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li><code>cls</code>ï¼šç±»æœ¬èº«ã€‚</li><li><code>texts</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒåŒ…å«å¾…ç´¢å¼•çš„æ–‡æœ¬ã€‚</li><li><code>embeddings</code>ï¼šä¸€ä¸ªæµ®ç‚¹æ•°åˆ—è¡¨çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸ªæ–‡æœ¬å¯¹åº”çš„åµŒå…¥å‘é‡ã€‚</li><li><code>embedding</code>ï¼šä¸€ä¸ª <code>Embeddings</code> å¯¹è±¡ï¼Œè¡¨ç¤ºç”¨äºç”ŸæˆåµŒå…¥å‘é‡çš„åµŒå…¥å™¨ã€‚</li><li><code>metadatas</code>ï¼šä¸€ä¸ªå­—å…¸åˆ—è¡¨ï¼ŒåŒ…å«æ¯ä¸ªæ–‡æ¡£çš„å…ƒæ•°æ®ã€‚é»˜è®¤ä¸º <code>None</code>ã€‚</li><li><code>ids</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸ªæ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚é»˜è®¤ä¸º <code>None</code>ã€‚</li><li><code>normalize_L2</code>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å¯¹åµŒå…¥å‘é‡è¿›è¡ŒL2èŒƒæ•°å½’ä¸€åŒ–ã€‚é»˜è®¤ä¸º <code>False</code>ã€‚</li><li><code>**kwargs</code>ï¼šä¸€ä¸ªå¯å˜å…³é”®å­—å‚æ•°ï¼Œè¡¨ç¤ºå…¶ä»–å‚æ•°ã€‚</li></ul><p>è¿”å›å€¼ï¼šä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ï¼Œè¡¨ç¤ºæ„å»ºçš„ç´¢å¼•ã€‚</p><p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°†æ–‡æœ¬åˆ—è¡¨å’ŒåµŒå…¥åˆ—è¡¨è½¬æ¢ä¸º <code>FAISS</code> å¯¹è±¡ï¼Œä»¥è¿›è¡Œç›¸ä¼¼åº¦æœç´¢å’Œæ£€ç´¢ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>embedding</code> å¯¹è±¡å°†æ–‡æœ¬è½¬æ¢ä¸ºåµŒå…¥å‘é‡ï¼Œç„¶åå°†åµŒå…¥å‘é‡ä¼ é€’ç»™ <code>FAISS</code> å¯¹è±¡è¿›è¡Œç´¢å¼•å’Œæœç´¢ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œè¯¥å‡½æ•°é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ï¼Œå¹¶å°†åµŒå…¥å‘é‡æ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚å¦‚æœæŒ‡å®šäº†å…ƒæ•°æ®å’Œæ–‡æ¡£ IDï¼Œåˆ™å°†å®ƒä»¬ä¸åµŒå…¥å‘é‡ä¸€èµ·æ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚ä¸ºäº†å¿«é€Ÿæœç´¢ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹åµŒå…¥å‘é‡è¿›è¡Œ L2 èŒƒæ•°å½’ä¸€åŒ–ï¼Œè¿™å¯ä»¥æé«˜æœç´¢æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚</p><p>æœ€åï¼Œè¯¥æ–¹æ³•è¿”å›åˆ›å»ºçš„ <code>FAISS</code> å¯¹è±¡ã€‚ä½ å¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡æ‰§è¡Œç›¸ä¼¼åº¦æœç´¢å’Œæ£€ç´¢ï¼Œå¹¶è·å–ä¸æŸ¥è¯¢æ–‡æœ¬æœ€ç›¸å…³çš„æ–‡æ¡£åˆ—è¡¨ã€‚<br>                                                                               ###<br>def from_texts(<br>        cls,<br>        texts: List[str],<br>        embedding: Embeddings,<br>        metadatas: Optional[List[dict]] = None,<br>        ids: Optional[List[str]] = None,<br>        **kwargs: Any,<br>    ) -&gt; FAISS:<br>                                                                                  ä½¿ç”¨ä¸Šä¸€ä¸ªæ–¹æ³•çš„__fromè¿›è¡Œå®ç°<br>                                                                               è¿™æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œç”¨äºä»æ–‡æœ¬åˆ—è¡¨ä¸­æ„å»ºä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ã€‚è¯¥å‡½æ•°çš„å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li><code>cls</code>ï¼šç±»æœ¬èº«ã€‚</li><li><code>texts</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒåŒ…å«å¾…ç´¢å¼•çš„æ–‡æœ¬ã€‚</li><li><code>embedding</code>ï¼šä¸€ä¸ª <code>Embeddings</code> å¯¹è±¡ï¼Œè¡¨ç¤ºç”¨äºç”ŸæˆåµŒå…¥å‘é‡çš„åµŒå…¥å™¨ã€‚</li><li><code>metadatas</code>ï¼šä¸€ä¸ªå­—å…¸åˆ—è¡¨ï¼ŒåŒ…å«æ¯ä¸ªæ–‡æ¡£çš„å…ƒæ•°æ®ã€‚é»˜è®¤ä¸º <code>None</code>ã€‚</li><li><code>ids</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸ªæ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚é»˜è®¤ä¸º <code>None</code>ã€‚</li><li><code>**kwargs</code>ï¼šä¸€ä¸ªå¯å˜å…³é”®å­—å‚æ•°ï¼Œè¡¨ç¤ºå…¶ä»–å‚æ•°ã€‚</li></ul><p>è¿”å›å€¼ï¼šä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ï¼Œè¡¨ç¤ºæ„å»ºçš„ç´¢å¼•ã€‚</p><p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°†æ–‡æœ¬åˆ—è¡¨è½¬æ¢ä¸º <code>FAISS</code> å¯¹è±¡ï¼Œä»¥è¿›è¡Œç›¸ä¼¼åº¦æœç´¢å’Œæ£€ç´¢ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>embedding</code> å¯¹è±¡å°†æ–‡æœ¬è½¬æ¢ä¸ºåµŒå…¥å‘é‡ï¼Œç„¶åå°†åµŒå…¥å‘é‡ä¼ é€’ç»™ <code>FAISS</code> å¯¹è±¡è¿›è¡Œç´¢å¼•å’Œæœç´¢ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œè¯¥å‡½æ•°é¦–å…ˆä½¿ç”¨ <code>embedding</code> å¯¹è±¡å°†æ–‡æœ¬åˆ—è¡¨è½¬æ¢ä¸ºåµŒå…¥å‘é‡åˆ—è¡¨ã€‚ç„¶åï¼Œåˆ›å»ºä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ï¼Œå¹¶å°†åµŒå…¥å‘é‡æ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚å¦‚æœæŒ‡å®šäº†å…ƒæ•°æ®å’Œæ–‡æ¡£ IDï¼Œåˆ™å°†å®ƒä»¬ä¸åµŒå…¥å‘é‡ä¸€èµ·æ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚ä¸ºäº†å¿«é€Ÿæœç´¢ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹åµŒå…¥å‘é‡è¿›è¡Œ L2 èŒƒæ•°å½’ä¸€åŒ–ï¼Œè¿™å¯ä»¥æé«˜æœç´¢æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚</p><p>æœ€åï¼Œè¯¥æ–¹æ³•è¿”å›åˆ›å»ºçš„ <code>FAISS</code> å¯¹è±¡ã€‚ä½ å¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡æ‰§è¡Œç›¸ä¼¼åº¦æœç´¢å’Œæ£€ç´¢ï¼Œå¹¶è·å–ä¸æŸ¥è¯¢æ–‡æœ¬æœ€ç›¸å…³çš„æ–‡æ¡£åˆ—è¡¨ã€‚</p><pre><code>                                                                           ###</code></pre><p>def from_embeddings(<br>        cls,<br>        text_embeddings: List[Tuple[str, List[float]]],<br>        embedding: Embeddings,<br>        metadatas: Optional[List[dict]] = None,<br>        ids: Optional[List[str]] = None,<br>        **kwargs: Any,<br>    ) -&gt; FAISS:                                                               è¿™æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œç”¨äºä»æ–‡æœ¬åµŒå…¥å…ƒç»„åˆ—è¡¨ä¸­æ„å»ºä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ã€‚è¯¥å‡½æ•°çš„å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li><code>cls</code>ï¼šç±»æœ¬èº«ã€‚</li><li><code>text_embeddings</code>ï¼šä¸€ä¸ªå…ƒç»„åˆ—è¡¨ï¼ŒåŒ…å«æ¯ä¸ªæ–‡æœ¬çš„å”¯ä¸€æ ‡è¯†ç¬¦å’Œå¯¹åº”çš„åµŒå…¥å‘é‡ã€‚</li><li><code>embedding</code>ï¼šä¸€ä¸ª <code>Embeddings</code> å¯¹è±¡ï¼Œè¡¨ç¤ºç”¨äºç”ŸæˆåµŒå…¥å‘é‡çš„åµŒå…¥å™¨ã€‚</li><li><code>metadatas</code>ï¼šä¸€ä¸ªå­—å…¸åˆ—è¡¨ï¼ŒåŒ…å«æ¯ä¸ªæ–‡æ¡£çš„å…ƒæ•°æ®ã€‚é»˜è®¤ä¸º <code>None</code>ã€‚</li><li><code>ids</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸ªæ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚é»˜è®¤ä¸º <code>None</code>ã€‚</li><li><code>**kwargs</code>ï¼šä¸€ä¸ªå¯å˜å…³é”®å­—å‚æ•°ï¼Œè¡¨ç¤ºå…¶ä»–å‚æ•°ã€‚</li></ul><p>è¿”å›å€¼ï¼šä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ï¼Œè¡¨ç¤ºæ„å»ºçš„ç´¢å¼•ã€‚</p><p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°†æ–‡æœ¬åµŒå…¥å…ƒç»„åˆ—è¡¨è½¬æ¢ä¸º <code>FAISS</code> å¯¹è±¡ï¼Œä»¥è¿›è¡Œç›¸ä¼¼åº¦æœç´¢å’Œæ£€ç´¢ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>embedding</code> å¯¹è±¡å°†åµŒå…¥å‘é‡æ·»åŠ åˆ° <code>FAISS</code> å¯¹è±¡çš„ç´¢å¼•ä¸­ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œè¯¥å‡½æ•°é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ï¼Œå¹¶å°†åµŒå…¥å‘é‡æ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚å¦‚æœæŒ‡å®šäº†å…ƒæ•°æ®å’Œæ–‡æ¡£ IDï¼Œåˆ™å°†å®ƒä»¬ä¸åµŒå…¥å‘é‡ä¸€èµ·æ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚ä¸ºäº†å¿«é€Ÿæœç´¢ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹åµŒå…¥å‘é‡è¿›è¡Œ L2 èŒƒæ•°å½’ä¸€åŒ–ï¼Œè¿™å¯ä»¥æé«˜æœç´¢æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚</p><p>æœ€åï¼Œè¯¥æ–¹æ³•è¿”å›åˆ›å»ºçš„ <code>FAISS</code> å¯¹è±¡ã€‚ä½ å¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡æ‰§è¡Œç›¸ä¼¼åº¦æœç´¢å’Œæ£€ç´¢ï¼Œå¹¶è·å–ä¸æŸ¥è¯¢æ–‡æœ¬æœ€ç›¸å…³çš„æ–‡æ¡£åˆ—è¡¨ã€‚</p><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><pre><code>                                                                           def save_local(self, folder_path: str, index_name: str = "index") -&gt; None:</code></pre><p>è¿™æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œç”¨äºå°† <code>FAISS</code> å¯¹è±¡ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ã€‚è¯¥å‡½æ•°çš„å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li><code>folder_path</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæœ¬åœ°æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œç”¨äºä¿å­˜ç´¢å¼•æ–‡ä»¶ã€‚</li><li><code>index_name</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºç´¢å¼•æ–‡ä»¶çš„åç§°ã€‚é»˜è®¤ä¸º <code>"index"</code>ã€‚</li></ul><p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°† <code>FAISS</code> å¯¹è±¡ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ä¸­ï¼Œä»¥ä¾¿åœ¨ä»¥åçš„æ—¶é—´å†…è¿›è¡ŒåŠ è½½å’Œä½¿ç”¨ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ <code>faiss.write_index</code> å‡½æ•°å°†ç´¢å¼•å¯¹è±¡å†™å…¥æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸­ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œè¯¥æ–¹æ³•é¦–å…ˆæ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ã€‚ç„¶åï¼Œä½¿ç”¨ <code>faiss.write_index</code> å‡½æ•°å°†ç´¢å¼•å¯¹è±¡å†™å…¥æ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸­ã€‚ä¿å­˜çš„ç´¢å¼•æ–‡ä»¶å¯ä»¥åœ¨ä»¥åçš„æ—¶é—´å†…ä½¿ç”¨ <code>load_local</code> æ–¹æ³•åŠ è½½ã€‚</p><p>æœ€åï¼Œè¯¥æ–¹æ³•è¿”å› <code>None</code>ã€‚<br>                                                                               ###<br>def load_local(<br>        cls, folder_path: str, embeddings: Embeddings, index_name: str = â€œindexâ€<br>    ) -&gt; FAISS:<br>                                                                               è¿™æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œç”¨äºä»æœ¬åœ°æ–‡ä»¶å¤¹ä¸­åŠ è½½ <code>FAISS</code> ç´¢å¼•å¯¹è±¡ã€‚è¯¥å‡½æ•°çš„å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li><code>cls</code>ï¼šç±»æœ¬èº«ã€‚</li><li><code>folder_path</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæœ¬åœ°æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œç”¨äºåŠ è½½ç´¢å¼•æ–‡ä»¶ã€‚</li><li><code>embeddings</code>ï¼šä¸€ä¸ª <code>Embeddings</code> å¯¹è±¡ï¼Œè¡¨ç¤ºç”¨äºç”ŸæˆåµŒå…¥å‘é‡çš„åµŒå…¥å™¨ã€‚</li><li><code>index_name</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºç´¢å¼•æ–‡ä»¶çš„åç§°ã€‚é»˜è®¤ä¸º <code>"index"</code>ã€‚</li></ul><p>è¿”å›å€¼ï¼šä¸€ä¸ª <code>FAISS</code> å¯¹è±¡ï¼Œè¡¨ç¤ºå·²åŠ è½½çš„ç´¢å¼•ã€‚</p><p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯ä»æœ¬åœ°æ–‡ä»¶å¤¹ä¸­åŠ è½½ <code>FAISS</code> ç´¢å¼•å¯¹è±¡ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ä»¥ä¾›ä½¿ç”¨ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ <code>faiss.read_index</code> å‡½æ•°ä»æ–‡ä»¶ä¸­è¯»å–ç´¢å¼•å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ <code>embeddings</code> å¯¹è±¡ç”ŸæˆåµŒå…¥å‘é‡ã€‚ç„¶åï¼Œå°†åµŒå…¥å‘é‡æ·»åŠ åˆ°ç´¢å¼•ä¸­ï¼Œå¹¶è¿”å›åˆ›å»ºçš„ <code>FAISS</code> ç´¢å¼•å¯¹è±¡ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä½¿ç”¨ <code>faiss.read_index</code> å‡½æ•°ä»æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸­è¯»å–ç´¢å¼•å¯¹è±¡ã€‚ç„¶åï¼Œä½¿ç”¨ <code>embeddings</code> å¯¹è±¡å°†å­˜å‚¨åœ¨ç´¢å¼•ä¸­çš„åµŒå…¥å‘é‡é‡æ–°ç”Ÿæˆï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°ç´¢å¼•å¯¹è±¡ä¸­ã€‚æœ€åï¼Œè¯¥æ–¹æ³•è¿”å›åˆ›å»ºçš„ <code>FAISS</code> å¯¹è±¡ï¼Œä»¥ä¾›è¿›è¡Œæ–‡æœ¬æ£€ç´¢å’Œç›¸ä¼¼åº¦æœç´¢ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŠ è½½çš„ç´¢å¼•å¯¹è±¡å¿…é¡»ä¸åµŒå…¥å™¨å¯¹è±¡ <code>embeddings</code> å…¼å®¹ï¼Œå³ç´¢å¼•å¯¹è±¡å’ŒåµŒå…¥å™¨å¯¹è±¡å¿…é¡»ä½¿ç”¨ç›¸åŒçš„åµŒå…¥ç­–ç•¥å’Œå‚æ•°ã€‚å¦åˆ™ï¼Œåœ¨è¿›è¡Œæ–‡æœ¬æ£€ç´¢å’Œç›¸ä¼¼åº¦æœç´¢æ—¶å¯èƒ½ä¼šå¯¼è‡´ä¸å‡†ç¡®çš„ç»“æœã€‚</p><h3 id="def-similarity-search-with-relevance-scores"><a href="#def-similarity-search-with-relevance-scores" class="headerlink" title="def _similarity_search_with_relevance_scores("></a>def _similarity_search_with_relevance_scores(</h3><pre><code>    self,    query: str,    k: int = 4,    filter: Optional[Dict[str, Any]] = None,    fetch_k: int = 20,    **kwargs: Any,) -&gt; List[Tuple[Document, float]]:                                                                           </code></pre><p>è¿™æ˜¯ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œå¸¦æœ‰ç›¸å…³åº¦å¾—åˆ†çš„ç›¸ä¼¼åº¦æœç´¢ã€‚è¯¥å‡½æ•°çš„å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li><code>query</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæŸ¥è¯¢æ–‡æœ¬ã€‚</li><li><code>k</code>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ¯ä¸ªæŸ¥è¯¢çš„è¿”å›æ–‡æ¡£æ•°ã€‚é»˜è®¤ä¸º <code>4</code>ã€‚</li><li><code>filter</code>ï¼šä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºç”¨äºè¿‡æ»¤æœç´¢ç»“æœçš„è¿‡æ»¤å™¨ã€‚é»˜è®¤ä¸º <code>None</code>ã€‚</li><li><code>fetch_k</code>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºåœ¨è¿‡æ»¤ä¹‹åè¦è¿”å›çš„æ–‡æ¡£æ•°ã€‚é»˜è®¤ä¸º <code>20</code>ã€‚</li><li><code>**kwargs</code>ï¼šä¸€ä¸ªå¯å˜å…³é”®å­—å‚æ•°ï¼Œè¡¨ç¤ºå…¶ä»–å‚æ•°ã€‚</li></ul><p>è¿”å›å€¼ï¼šä¸€ä¸ªå…ƒç»„åˆ—è¡¨ï¼Œè¡¨ç¤ºæŸ¥è¯¢æ–‡æœ¬ä¸æ¯ä¸ªè¿”å›æ–‡æ¡£çš„ç›¸å…³åº¦å¾—åˆ†ã€‚</p><p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯æ‰§è¡Œå¸¦æœ‰ç›¸å…³åº¦å¾—åˆ†çš„ç›¸ä¼¼åº¦æœç´¢ï¼Œå¹¶è¿”å›ä¸æŸ¥è¯¢æ–‡æœ¬æœ€ç›¸å…³çš„æ–‡æ¡£åˆ—è¡¨ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ <code>faiss.StandardGpuResources</code> åˆ›å»º GPU èµ„æºï¼Œå¹¶ä½¿ç”¨ <code>embeddings</code> å¯¹è±¡å°†æŸ¥è¯¢æ–‡æœ¬è½¬æ¢ä¸ºåµŒå…¥å‘é‡ã€‚ç„¶åï¼Œä½¿ç”¨ <code>faiss.Index.search</code> å‡½æ•°æ‰§è¡Œç›¸ä¼¼åº¦æœç´¢ï¼Œå¹¶æ ¹æ®ç›¸ä¼¼åº¦å¾—åˆ†å¯¹æœç´¢ç»“æœè¿›è¡Œæ’åºã€‚æœ€åï¼Œè¯¥æ–¹æ³•è¿”å›æŸ¥è¯¢æ–‡æœ¬ä¸æ¯ä¸ªè¿”å›æ–‡æ¡£çš„ç›¸å…³åº¦å¾—åˆ†ï¼Œå¹¶å°†å®ƒä»¬å°è£…ä¸ºå…ƒç»„åˆ—è¡¨ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä½¿ç”¨ <code>faiss.StandardGpuResources</code> åˆ›å»º GPU èµ„æºï¼Œå¹¶ä½¿ç”¨ <code>embeddings</code> å¯¹è±¡å°†æŸ¥è¯¢æ–‡æœ¬è½¬æ¢ä¸ºåµŒå…¥å‘é‡ã€‚ç„¶åï¼Œä½¿ç”¨ <code>faiss.Index.search</code> å‡½æ•°æ‰§è¡Œç›¸ä¼¼åº¦æœç´¢ï¼Œå¹¶è·å–ä¸æŸ¥è¯¢æ–‡æœ¬æœ€ç›¸å…³çš„æ–‡æ¡£åˆ—è¡¨ã€‚åœ¨è·å–æ–‡æ¡£åˆ—è¡¨åï¼Œè¯¥æ–¹æ³•å¯¹è¿”å›æ–‡æ¡£è¿›è¡Œæ’åºï¼Œå¹¶è®¡ç®—æ¯ä¸ªæ–‡æ¡£çš„ç›¸å…³åº¦å¾—åˆ†ã€‚å¦‚æœæŒ‡å®šäº†è¿‡æ»¤å™¨ï¼Œåˆ™ä½¿ç”¨è¿‡æ»¤å™¨ä»æœç´¢ç»“æœä¸­è¿‡æ»¤æ–‡æ¡£ã€‚æœ€åï¼Œè¯¥æ–¹æ³•å°†æŸ¥è¯¢æ–‡æœ¬ä¸æ¯ä¸ªè¿”å›æ–‡æ¡£çš„ç›¸å…³åº¦å¾—åˆ†å°è£…ä¸ºå…ƒç»„ï¼Œå¹¶è¿”å›å…ƒç»„åˆ—è¡¨ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ GPU èµ„æºæ‰§è¡Œç›¸ä¼¼åº¦æœç´¢ï¼Œå› æ­¤éœ€è¦ç¡®ä¿è®¡ç®—æœºä¸Šå®‰è£…äº†æ”¯æŒ GPU è®¡ç®—çš„ <code>faiss</code> åº“ï¼Œå¹¶ä¸” GPU èµ„æºå¯ç”¨ã€‚<br>   </p><pre class="line-numbers language-none"><code class="language-none">##### indexå®šä¹‰æ˜¯Anyå¯¹è±¡ï¼Œæˆ‘ä¸çŸ¥é“å®ƒä¸‹ä¸€æ­¥è°ƒç”¨çš„æ˜¯å“ªä¸ª`````cores, indices = self.index.search(vector, k)` æ˜¯ `faiss` åº“ä¸­ `Index` ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåœ¨ç´¢å¼•ä¸­æŸ¥æ‰¾ä¸ç»™å®šå‘é‡æœ€ç›¸ä¼¼çš„ k ä¸ªå‘é‡ã€‚å®ƒè¿”å›ä¸¤ä¸ªæ•°ç»„ï¼š`cores` å’Œ `indices`ã€‚å…¶ä¸­ï¼Œ`cores` è¡¨ç¤ºæ¯ä¸ªæŸ¥è¯¢å‘é‡çš„ç›¸ä¼¼åº¦å¾—åˆ†ï¼ˆå³ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰ï¼Œ`indices` è¡¨ç¤ºä¸æ¯ä¸ªæŸ¥è¯¢å‘é‡æœ€ç›¸ä¼¼çš„ k ä¸ªå‘é‡çš„ç´¢å¼•å·ã€‚è¯·ç¡®ä¿æ‚¨å·²ç»æ­£ç¡®å¯¼å…¥ `faiss` åº“ï¼Œå¹¶åœ¨ä»£ç ä¸­åˆ›å»ºäº† `Index` å¯¹è±¡å¹¶å°†å…¶å­˜å‚¨åœ¨ `self.index` å˜é‡ä¸­ã€‚å¦‚æœæ‚¨çš„ä»£ç ä¸­ä»ç„¶æ‰¾ä¸åˆ° `search` æ–¹æ³•ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ä»£ç æ˜¯å¦æ­£ç¡®å¯¼å…¥ `faiss` åº“ï¼Œå¹¶åˆ›å»ºäº†æ­£ç¡®çš„ `Index` å¯¹è±¡ã€‚`Any` æ˜¯ Python ä¸­çš„ä¸€ä¸ªç±»å‹æ³¨è§£ï¼Œå®ƒè¡¨ç¤ºå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œå½“æ‚¨å®šä¹‰ä¸€ä¸ªç±»å‹ä¸º `Any` çš„å˜é‡æ—¶ï¼Œå®ƒå¯ä»¥å¼•ç”¨ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ã€å†…ç½®ç±»å‹ã€æ¨¡å—ã€å‡½æ•°ç­‰ç­‰ã€‚åœ¨æ‚¨çš„ä»£ç ä¸­ï¼Œ`index` å˜é‡çš„ç±»å‹ä¸º `Any`ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥å¼•ç”¨ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚å¦‚æœæ‚¨ä¸ç¡®å®šå®ƒå¼•ç”¨çš„æ˜¯å“ªç§ç±»å‹çš„å¯¹è±¡ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ `type` å‡½æ•°æ¥æŸ¥çœ‹å®ƒçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>print(type(index))<p></p><pre class="line-numbers language-none"><code class="language-none">è¿™å°†è¾“å‡º `index` å˜é‡çš„ç±»å‹ã€‚ä¸€æ—¦æ‚¨çŸ¥é“äº† `index` å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡çš„ç±»å‹ï¼Œå°±å¯ä»¥æŸ¥æ‰¾è¯¥å¯¹è±¡çš„æ–‡æ¡£æˆ–æºä»£ç ï¼Œä»¥äº†è§£å®ƒæ”¯æŒå“ªäº›æ–¹æ³•å’Œå±æ€§ã€‚å¦‚æœè¯¥å¯¹è±¡æ˜¯ `faiss` åº“ä¸­çš„ `Index` ç±»çš„å®ä¾‹ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ”¯æŒ `search` æ–¹æ³•ï¼Œç”¨äºåœ¨ç´¢å¼•ä¸­æŸ¥æ‰¾ä¸ç»™å®šå‘é‡æœ€ç›¸ä¼¼çš„å‘é‡ã€‚````##### scores, indices = self.index.search(vector, k)#scores è¡¨ç¤ºæ¯ä¸ªæŸ¥è¯¢å‘é‡çš„ç›¸ä¼¼åº¦å¾—åˆ†ï¼ˆå³ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰ï¼Œindices è¡¨ç¤ºä¸æ¯ä¸ªæŸ¥è¯¢å‘é‡æœ€ç›¸ä¼¼çš„ k ä¸ªå‘é‡çš„ç´¢å¼•å·ã€‚for j,i in enumerate(indices[0]):è¿™ä¸ªåœ°æ–¹ä¸ºä»€ä¹ˆç”¨indices[0]ï¼Œä»–æœ‰ä»€ä¹ˆå«ä¹‰````åœ¨ `faiss` ä¸­ï¼Œ`search` æ–¹æ³•å¯ä»¥åŒæ—¶æŸ¥è¯¢å¤šä¸ªå‘é‡ï¼Œå¹¶è¿”å›æ¯ä¸ªæŸ¥è¯¢å‘é‡ä¸æ•°æ®åº“ä¸­å…¶ä»–å‘é‡çš„ç›¸ä¼¼åº¦å¾—åˆ†å’Œç´¢å¼•å·ã€‚å¦‚æœæŸ¥è¯¢å‘é‡çš„æ•°é‡ä¸º `n`ï¼Œåˆ™ `search` æ–¹æ³•è¿”å›çš„ `scores` å’Œ `indices` æ˜¯ä¸¤ä¸ªå…·æœ‰ `shape = (n, k)` çš„æ•°ç»„ï¼Œå…¶ä¸­ `k` è¡¨ç¤ºæ¯ä¸ªæŸ¥è¯¢å‘é‡è¿”å›çš„æœ€ç›¸ä¼¼å‘é‡çš„æ•°é‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ä»¥ä¸‹ä»£ç ä¸­ï¼š```pythonscores, indices = self.index.search(queries, k)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœ <code>queries</code> æ˜¯ä¸€ä¸ª <code>m</code> è¡Œ <code>d</code> åˆ—çš„äºŒç»´æ•°ç»„ï¼Œè¡¨ç¤º <code>m</code> ä¸ªæŸ¥è¯¢å‘é‡ï¼Œæ¯ä¸ªå‘é‡æœ‰ <code>d</code> ä¸ªç»´åº¦ï¼Œåˆ™ <code>scores</code> å’Œ <code>indices</code> çš„ <code>shape</code> åˆ†åˆ«ä¸º <code>(m, k)</code> å’Œ <code>(m, k)</code>ã€‚</p><p>åœ¨è¯¥ç®—æ³•ä¸­ï¼Œæ¯æ¬¡åªæŸ¥è¯¢ä¸€ä¸ªå‘é‡ï¼Œå› æ­¤ <code>scores</code> å’Œ <code>indices</code> éƒ½æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå…¶ä¸­ <code>scores[0]</code> è¡¨ç¤ºæŸ¥è¯¢å‘é‡ä¸ k ä¸ªæœ€ç›¸ä¼¼å‘é‡çš„ç›¸ä¼¼åº¦å¾—åˆ†ï¼Œ<code>indices[0]</code> è¡¨ç¤º k ä¸ªæœ€ç›¸ä¼¼å‘é‡åœ¨ç´¢å¼•ä¸­çš„ç¼–å·ã€‚</p><p>å› æ­¤ï¼Œåœ¨å¾ªç¯ä¸­åªç”¨åˆ°äº† <code>indices[0]</code>ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªæŸ¥è¯¢å‘é‡çš„ k ä¸ªæœ€ç›¸ä¼¼å‘é‡åœ¨ç´¢å¼•ä¸­çš„ç¼–å·ã€‚è‡³äº <code>indices[1]</code> è¡¨ç¤ºä»€ä¹ˆï¼Œç”±äºæœ¬ç®—æ³•æ¯æ¬¡åªæŸ¥è¯¢ä¸€ä¸ªå‘é‡ï¼Œå› æ­¤ <code>indices[1]</code> æ²¡æœ‰å®é™…æ„ä¹‰ï¼Œå¯ä»¥å¿½ç•¥ã€‚</p><p>æš‚æ—¶çš„ç†è§£</p><pre class="line-numbers language-none"><code class="language-none">LLM streaming reponse       STREAMING = True       è¿™ä¸ªåŠ ä¸åŠ æœ‰ä»€ä¹ˆåŒºåˆ«```è¿™ä¸ªä»£ç ç‰‡æ®µå®šä¹‰äº†ä¸€ä¸ªåä¸º `STREAMING` çš„å˜é‡ï¼Œå®ƒçš„å€¼ä¸º `True`ã€‚è¿™ä¸ªå˜é‡çš„ä½œç”¨æ˜¯æ§åˆ¶æ˜¯å¦å¯ç”¨æµå¼å“åº”ï¼ˆstreaming responseï¼‰ã€‚å¦‚æœå°† `STREAMING` è®¾ç½®ä¸º `False`ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨æµå¼å“åº”ï¼Œè¿™æ„å‘³ç€æœåŠ¡ç«¯åœ¨å¤„ç†å®Œæ•´ä¸ªè¯·æ±‚åæ‰ä¼šå‘å®¢æˆ·ç«¯å‘é€å“åº”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯éœ€è¦ç­‰å¾…æœåŠ¡ç«¯å¤„ç†å®Œæ•´ä¸ªè¯·æ±‚åæ‰èƒ½å¼€å§‹å¤„ç†å“åº”ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å®¢æˆ·ç«¯ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§å‹è¯·æ±‚æˆ–å“åº”æ—¶ã€‚å¦‚æœå°† `STREAMING` è®¾ç½®ä¸º `True`ï¼Œåˆ™è¡¨ç¤ºå¯ç”¨æµå¼å“åº”ï¼ŒæœåŠ¡ç«¯ä¼šåœ¨å¤„ç†è¯·æ±‚æœŸé—´ä¸æ–­å‘å®¢æˆ·ç«¯å‘é€å“åº”ã€‚è¿™ç§æ–¹å¼å¯ä»¥æœ‰æ•ˆå‡å°‘å®¢æˆ·ç«¯ç­‰å¾…çš„æ—¶é—´ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€æ­¥è¿”å›å“åº”ç»“æœï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥æ›´æ—©åœ°å¼€å§‹å¤„ç†å“åº”ã€‚ä½†æ˜¯ï¼Œå¯ç”¨æµå¼å“åº”ä¹Ÿä¼šå¢åŠ æœåŠ¡ç«¯çš„è´Ÿæ‹…ï¼Œå› ä¸ºæœåŠ¡ç«¯éœ€è¦åœ¨å¤„ç†è¯·æ±‚æ—¶ä¸æ–­ç”Ÿæˆå“åº”æ•°æ®å¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› æ­¤ï¼Œæ˜¯å¦å¯ç”¨æµå¼å“åº”å–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚å¦‚æœè¯·æ±‚å’Œå“åº”è¾ƒå°ï¼Œå¯ä»¥ç¦ç”¨æµå¼å“åº”ä»¥ç®€åŒ–å®ç°ï¼›å¦‚æœè¯·æ±‚å’Œå“åº”è¾ƒå¤§ï¼Œå¯ä»¥è€ƒè™‘å¯ç”¨æµå¼å“åº”ä»¥æé«˜æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚```##### @lru_cache(CACHED_VS_NUM)ä»€ä¹ˆæ„æ€æ˜¯```python@lru_cache(CACHED_VS_NUM)def load_vector_store(vs_path, embeddings):    return MyFAISS.load_local(vs_path, embeddings)`@lru_cache(CACHED_VS_NUM)` æ˜¯ Python ä¸­çš„ä¸€ä¸ªè£…é¥°å™¨è¯­æ³•ï¼Œå®ƒå¯ä»¥ç”¨æ¥ç¼“å­˜å‡½æ•°çš„ç»“æœï¼Œä»¥é¿å…é‡å¤è®¡ç®—ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚`@lru_cache` æ˜¯ Python æ ‡å‡†åº“ `functools` ä¸­æä¾›çš„ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒå¯ä»¥ç”¨æ¥å®ç°ä¸€ä¸ªâ€œæœ€è¿‘æœ€å°‘ä½¿ç”¨â€ï¼ˆLeast Recently Usedï¼ŒLRUï¼‰çš„ç¼“å­˜æœºåˆ¶ã€‚LRU ç¼“å­˜ä¼šåœ¨ç¼“å­˜æ»¡æ—¶åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜é¡¹ï¼Œä»¥ä¿æŒç¼“å­˜çš„æœ€æ–°å’Œæœ€å¸¸ç”¨çŠ¶æ€ã€‚`CACHED_VS_NUM` æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œå®ƒç”¨æ¥æŒ‡å®šç¼“å­˜çš„æœ€å¤§å®¹é‡ï¼Œå³ç¼“å­˜å¯ä»¥å­˜å‚¨çš„æœ€å¤šçš„å‡½æ•°è°ƒç”¨ç»“æœæ•°é‡ã€‚å½“ç¼“å­˜å·²æ»¡æ—¶ï¼Œæ–°çš„å‡½æ•°è°ƒç”¨ä¼šå¯¼è‡´æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜é¡¹è¢«åˆ é™¤ï¼Œä»¥è…¾å‡ºç©ºé—´ç»™æ–°çš„ç¼“å­˜é¡¹ã€‚å› æ­¤ï¼Œ`@lru_cache(CACHED_VS_NUM)` çš„æ„æ€å°±æ˜¯ä½¿ç”¨ LRU ç¼“å­˜æœºåˆ¶æ¥ç¼“å­˜å‡½æ•°çš„ç»“æœï¼Œå¹¶æŒ‡å®šç¼“å­˜çš„æœ€å¤§å®¹é‡ä¸º `CACHED_VS_NUM`ã€‚``````pythonå¦‚ä½•å‡å°‘æ¨¡å‹çš„å“åº”é€Ÿåº¦å‘¢ï¼response = {"query": query,            "result": resp,            "source_documents": related_docs_with_score}#è¿™ä¸ªæ˜¯responseçš„å“åº”print(response["source_documents"])metadata={'source': 'pdf/è®¡ç®—æœºç½‘ç»œ.pdf', 'score': 0})]{'query': '2', 'result': '','source_documents': [Document(page_content='AS 100 ', metadata={'source': 'pdf/è®¡ç®—æœºç½‘ç»œ.pdf', 'score': 0})]}```##### if search_type == "similarity":      return self.similarity_search(query, **kwargs)   elif search_type == "mmr":        return self.max_marginal_relevance_search(query, **kwargs)è¿™ä¸¤ä¸ªæœç´¢å“ªä¸ªæ›´å¥½ä¸€ç‚¹```è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚`similarity_search` å‡½æ•°å’Œ `max_marginal_relevance_search` å‡½æ•°éƒ½æ˜¯ç”¨äºæœç´¢æœ€ç›¸ä¼¼çš„å‘é‡ï¼Œä½†æ˜¯å®ƒä»¬çš„å®ç°æ–¹å¼ç•¥æœ‰ä¸åŒï¼Œå› æ­¤åœ¨ä¸åŒçš„åœºæ™¯ä¸‹å¯èƒ½ä¼šæœ‰ä¸åŒçš„è¡¨ç°ã€‚`similarity_search` å‡½æ•°ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æ¥è®¡ç®—å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦å¾—åˆ†ï¼Œå¹¶è¿”å›ä¸æŸ¥è¯¢å‘é‡æœ€ç›¸ä¼¼çš„å‰ k ä¸ªå‘é‡ã€‚è¿™ç§æ–¹æ³•ç®€å•ç›´æ¥ï¼Œé€‚ç”¨äºå¤§å¤šæ•°çš„åŸºæœ¬æœç´¢éœ€æ±‚ã€‚å¦‚æœæ‚¨åªéœ€è¦æ‰¾åˆ°ä¸æŸ¥è¯¢å‘é‡æœ€ç›¸ä¼¼çš„å‘é‡ï¼Œé‚£ä¹ˆ `similarity_search` å‡½æ•°å¯èƒ½æ›´é€‚åˆæ‚¨çš„éœ€æ±‚ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ`max_marginal_relevance_search` å‡½æ•°ä½¿ç”¨æœ€å¤§è¾¹é™…ç›¸å…³æ€§ç®—æ³•ï¼ˆMMRï¼‰æ¥è®¡ç®—å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦å¾—åˆ†ï¼Œå¹¶å°è¯•æœ€å¤§åŒ–è¿”å›çš„å‘é‡ä¹‹é—´çš„å·®å¼‚æ€§ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©æ‚¨æ‰¾åˆ°ä¸æŸ¥è¯¢å‘é‡ä¸ä»…ç›¸ä¼¼ï¼Œè€Œä¸”å°½å¯èƒ½ä¸åŒçš„å‘é‡ï¼Œä»è€Œæé«˜æœç´¢ç»“æœçš„å¤šæ ·æ€§ã€‚å¦‚æœæ‚¨éœ€è¦è¿”å›ä¸€ç»„ä¸ä»…ç›¸ä¼¼è€Œä¸”å¤šæ ·åŒ–çš„å‘é‡ï¼Œé‚£ä¹ˆ `max_marginal_relevance_search` å‡½æ•°å¯èƒ½æ›´é€‚åˆæ‚¨çš„éœ€æ±‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ `max_marginal_relevance_search` å‡½æ•°å¯èƒ½ä¼šå¢åŠ è®¡ç®—çš„å¤æ‚åº¦å’Œæ—¶é—´ï¼Œå› ä¸ºå®ƒéœ€è¦è®¡ç®—å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦å¾—åˆ†ï¼Œå¹¶è¿›è¡Œå¤šæ¬¡è¿­ä»£ä»¥ä¼˜åŒ–æœç´¢ç»“æœã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ `max_marginal_relevance_search` å‡½æ•°æ—¶ï¼Œéœ€è¦æƒè¡¡è®¡ç®—çš„å¤æ‚åº¦å’Œæœç´¢ç»“æœçš„è´¨é‡ã€‚```##### å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªæ¨¡å‹æœ‰å“ªäº›å±‚æ¬¡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¦æŸ¥çœ‹ä¸€ä¸ªæ¨¡å‹çš„å±‚æ¬¡ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨PyTorchä¸­çš„<code>named_parameters()</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œç”¨äºè¿­ä»£æ¨¡å‹çš„æ‰€æœ‰å‚æ•°åŠå…¶å¯¹åº”çš„åç§°ã€‚é€šè¿‡éå†è¿™ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€å±‚æŸ¥çœ‹æ¨¡å‹çš„ç»“æ„ï¼Œæ‰¾åˆ°æ¯ä¸ªå±‚çš„åç§°ä»¥åŠç›¸åº”çš„å‚æ•°ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæŸ¥çœ‹æ¨¡å‹å±‚æ¬¡ç»“æ„çš„ç¤ºä¾‹ä»£ç ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> transformers <span class="token keyword">import</span> AutoModel<span class="token comment"># åŠ è½½ä¸€ä¸ªé¢„è®­ç»ƒçš„æ¨¡å‹</span>model <span class="token operator">=</span> AutoModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">'bert-base-cased'</span><span class="token punctuation">)</span><span class="token comment"># éå†æ¨¡å‹çš„æ‰€æœ‰å‚æ•°åŠå…¶å¯¹åº”çš„åç§°</span><span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># æ‰“å°å‚æ•°çš„åç§°å’Œå½¢çŠ¶</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>param<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨<code>AutoModel.from_pretrained()</code>æ–¹æ³•åŠ è½½äº†ä¸€ä¸ªé¢„è®­ç»ƒçš„BERTæ¨¡å‹ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>named_parameters()</code>æ–¹æ³•éå†äº†è¿™ä¸ªæ¨¡å‹çš„æ‰€æœ‰å‚æ•°åŠå…¶å¯¹åº”çš„åç§°ï¼Œå¹¶æ‰“å°äº†æ¯ä¸ªå‚æ•°çš„åç§°å’Œå½¢çŠ¶ã€‚é€šè¿‡è§‚å¯Ÿè¿™äº›è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£è¿™ä¸ªæ¨¡å‹çš„å±‚æ¬¡ç»“æ„ï¼Œå¹¶æŸ¥æ‰¾æ¯ä¸ªå±‚çš„åç§°ä»¥åŠç›¸åº”çš„å‚æ•°ã€‚</p><pre><code>##### å›è°ƒå‡½æ•°<pre class="line-numbers language-none"><code class="language-none">def change_chunk_conent(mode, label_conent, history):    conent = ""    if "chunk_conent" in label_conent:        conent = "æœç´¢ç»“æœä¸Šä¸‹æ–‡å…³è”"    elif "one_content_segmentation" in label_conent:  # è¿™é‡Œæ²¡ç”¨ä¸Šï¼Œå¯ä»¥å…ˆç•™ç€        conent = "å†…å®¹åˆ†æ®µå…¥åº“"    if mode:        return gr.update(visible=True), history + [[None, f"ã€å·²å¼€å¯{conent}ã€‘"]]    else:        return gr.update(visible=False), history + [[None, f"ã€å·²å…³é—­{conent}ã€‘"]]                chunk_conent.change(fn=change_chunk_conent,                                        inputs=[chunk_conent, gr.Textbox(value="chunk_conent", visible=False), chatbot],                                        outputs=[chunk_sizes, chatbot])                                                                                `change_chunk_conent` å‡½æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç”¨äºå“åº” `chunk_content` å¤é€‰æ¡†çš„çŠ¶æ€å˜åŒ–ï¼Œå¹¶æ›´æ–°ç›¸å…³çš„ç»„ä»¶çŠ¶æ€ã€‚åœ¨ Gradio åº“ä¸­ï¼Œå›è°ƒå‡½æ•°é€šå¸¸ä½¿ç”¨ `change()` æ–¹æ³•è¿›è¡Œæ³¨å†Œï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·äº¤äº’æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚åœ¨è¿™é‡Œï¼Œ`chunk_conent.change(fn=change_chunk_conent, inputs=[chunk_conent, gr.Textbox(value="chunk_conent", visible=False), chatbot], outputs=[chunk_sizes, chatbot])` æ–¹æ³•æ³¨å†Œäº† `change_chunk_conent` å‡½æ•°ï¼Œå¹¶æŒ‡å®šäº†è¯¥å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºç»„ä»¶ã€‚å…·ä½“æ¥è¯´ï¼Œ`inputs` å‚æ•°åŒ…æ‹¬äº† `chunk_conent` å¤é€‰æ¡†ã€ä¸€ä¸ªéšè—çš„æ–‡æœ¬æ¡†ï¼ˆç”¨äºè®°å½•å½“å‰çš„ `chunk_content` çŠ¶æ€ï¼‰å’Œä¸€ä¸ªåä¸º `chatbot` çš„èŠå¤©æœºå™¨äººç»„ä»¶ï¼Œ`outputs` å‚æ•°åŒ…æ‹¬äº†ä¸€ä¸ªåä¸º `chunk_sizes` çš„ä¸‹æ‹‰æ¡†å’ŒåŒæ ·çš„ `chatbot` èŠå¤©æœºå™¨äººç»„ä»¶ã€‚è¿™äº›è¾“å…¥å’Œè¾“å‡ºç»„ä»¶éƒ½æ˜¯åœ¨ `gr.Interface()` ä¸­åˆ›å»ºå¹¶æ·»åŠ åˆ°å¸ƒå±€ä¸­çš„ã€‚å½“ç”¨æˆ·åœ¨ Web ç•Œé¢ä¸­å‹¾é€‰æˆ–å–æ¶ˆ `chunk_content` å¤é€‰æ¡†æ—¶ï¼ŒGradio åº“ä¼šè‡ªåŠ¨è°ƒç”¨ `change_chunk_conent` å‡½æ•°ï¼Œå¹¶ä¼ é€’å½“å‰ `chunk_content` å¤é€‰æ¡†çš„çŠ¶æ€ã€éšè—çš„æ–‡æœ¬æ¡†çš„å€¼å’ŒèŠå¤©æœºå™¨äººçš„å†å²è®°å½•ç­‰å‚æ•°ã€‚`change_chunk_conent` å‡½æ•°æ ¹æ®è¾“å…¥å‚æ•°çš„å€¼è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œç„¶åè¿”å›ä¸€ä¸ª `gr.update()` å¯¹è±¡ï¼Œç”¨äºæ›´æ–° `chunk_sizes` å’Œ `chatbot` ç»„ä»¶çš„æ˜¾ç¤ºçŠ¶æ€å’Œå†…å®¹ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>##### ä»£ç è§£é‡Š<pre class="line-numbers language-none"><code class="language-none">for file in files:    filename = os.path.split(file.name)[-1]    shutil.move(file.name, os.path.join(KB_ROOT_PATH, vs_id, "content", filename))    filelist.append(os.path.join(KB_ROOT_PATH, vs_id, "content", filename))            è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨ä¸­çš„æ–‡ä»¶ä»åŸæ¥çš„ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šçš„ç›®æ ‡ç›®å½•ï¼Œå¹¶å°†ç§»åŠ¨åçš„æ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°ä¸€ä¸ªæ–‡ä»¶è·¯å¾„åˆ—è¡¨ä¸­ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™æ®µä»£ç ä½¿ç”¨äº†Pythonæ ‡å‡†åº“ä¸­çš„`os.path.split()`å‡½æ•°å’Œ`shutil.move()`å‡½æ•°ã€‚`os.path.split(file.name)`å‡½æ•°å°†æ–‡ä»¶è·¯å¾„`file.name`åˆ†å‰²æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šç›®å½•è·¯å¾„å’Œæ–‡ä»¶åã€‚`[-1]`ç´¢å¼•è¡¨ç¤ºè¿”å›åˆ†å‰²åçš„ç»“æœä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ã€‚ç„¶åï¼Œ`shutil.move()`å‡½æ•°å°†æ–‡ä»¶ä»åŸæ¥çš„ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šçš„ç›®æ ‡ç›®å½•ã€‚ç§»åŠ¨åçš„æ–‡ä»¶åä¸å˜ï¼Œå› æ­¤ç§»åŠ¨åçš„æ–‡ä»¶è·¯å¾„å¯ä»¥é€šè¿‡å°†ç›®æ ‡ç›®å½•è·¯å¾„å’Œæ–‡ä»¶åæ‹¼æ¥è€Œå¾—åˆ°ã€‚æœ€åï¼Œ`filelist.append()`å‡½æ•°å°†ç§»åŠ¨åçš„æ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°ä¸€ä¸ªæ–‡ä»¶è·¯å¾„åˆ—è¡¨ä¸­ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨ä¸­çš„æ–‡ä»¶ç§»åŠ¨åˆ°æŒ‡å®šçš„ç›®æ ‡ç›®å½•ï¼Œå¹¶å°†ç§»åŠ¨åçš„æ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°ä¸€ä¸ªæ–‡ä»¶è·¯å¾„åˆ—è¡¨ä¸­ï¼Œä»¥å¤‡åç»­ä½¿ç”¨ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">ç»è¿‡å¤šæ¬¡å®éªŒï¼Œç»“åˆé€Ÿåº¦ï¼Œè´¨é‡çš„è€ƒè™‘ï¼Œæ–‡æœ¬æŸ¥æ‰¾é‡ä¸º1ï¼Œæ–‡ä»¶æ‰©å±•é•¿åº¦ä¸º150.{'query': '11', 'prompt': 'å·²çŸ¥ä¿¡æ¯ï¼šé€šè¿‡è¿œå°„æ‰“è¿›å”¯ä¸€è¿›çƒï¼Œ å°½ç®¡æ…¢åŠ¨ä½œæ˜¾ç¤ºæ˜¯æ‰“åœ¨ç‘å…¸é˜Ÿåå«è…¿ä¸Šå¼¹å°„å…¥ç½‘ï¼Œ ä½†ä»è¿‡ç¨‹åˆ°ç»“æœï¼Œ å‡æ˜¾ç¤ºäº†ç›¸åŒå†…å®¹â€”â€”â€œç‘å…¸é˜Ÿçš„é˜²å®ˆå¹¶éæ— æ‡ˆå¯å‡»â€ã€‚ \u3000\u3000å•†ç‘åè®©ç§‘ç ”æ•™ç»ƒæ›¹æ™“ä¸œç­‰äººå¯¹è¿™åœºæ¯”èµ›è¿›è¡Œç²¾å¿ƒå‰ªè¾‘ï¼Œ å°¤å…¶æ˜¯ç‘å…¸é˜Ÿå¤±çƒä»¥åŠç¾å›½é˜Ÿå½¢æˆæœ‰å¨èƒå°„é—¨çš„ç‰‡æ®µï¼Œ æ›´æ˜¯è¢«æ”¾å¤§è¿›è¡ŒåŠ¨ä½œåˆ†è§£ï¼Œ\næ ¹æ®ä¸Šè¿°å·²çŸ¥ä¿¡æ¯ï¼Œç®€æ´ä¸”ä¸“ä¸šåœ°å›ç­”ç”¨æˆ·åœ°é—®é¢˜ã€‚å¦‚æœé—®é¢˜ä¸æ¸…æ™°æˆ–æ— æ³•ä»å·²çŸ¥ä¿¡æ¯ä¸­å¾—åˆ°ç­”æ¡ˆï¼Œè¯·å›å¤"æ ¹æ®å·²çŸ¥ä¿¡æ¯æ— æ³•å›ç­”è¯¥é—®é¢˜ï¼Œè¯·æä¾›è¶³å¤Ÿçš„æœ¬åœ°çŸ¥è¯†åº“ä¿¡æ¯"ï¼Œåˆ‡å‹¿åœ¨ç­”æ¡ˆä¸­èƒ¡ç¼–ä¹±é€ ï¼Œåˆ‡å‹¿å›ç­”å·²çŸ¥ä¿¡æ¯ä»¥å¤–çš„é—®é¢˜ï¼Œé—®é¢˜ä¸æ˜ç¡®çš„æ—¶ï¼Œè¯·å›ç­”é—®é¢˜ä¸æ˜ç¡®ï¼Œç­”æ¡ˆè¯·ä½¿ç”¨ä¸­æ–‡ã€‚é—®é¢˜æ˜¯ï¼š11', 'result': 'æ ¹æ®å·²çŸ¥ä¿¡æ¯ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š\n\n1. è¿›çƒæ˜¯é€šè¿‡è¿œå°„æ‰“è¿›çš„ï¼Œå°½ç®¡æ…¢åŠ¨ä½œæ˜¾ç¤ºæ˜¯æ‰“åœ¨ç‘å…¸é˜Ÿåå«è…¿ä¸Šå¼¹å°„å…¥ç½‘ï¼Œä½†è¿‡ç¨‹æ˜¾ç¤ºç‘å…¸é˜Ÿçš„é˜²å®ˆå¹¶éæ— æ‡ˆå¯å‡»ã€‚\n2. è¿™åœºæ¯”èµ›çš„ç²¾å¿ƒå‰ªè¾‘åŒ…æ‹¬å¯¹ç‘å…¸é˜Ÿå¤±çƒä»¥åŠç¾å›½é˜Ÿå½¢æˆæœ‰å¨èƒå°„é—¨çš„ç‰‡æ®µè¿›è¡ŒåŠ¨ä½œåˆ†è§£ã€‚\n3. å•†ç‘åè®©ç§‘ç ”æ•™ç»ƒæ›¹æ™“ä¸œç­‰äººå¯¹è¿™åœºæ¯”èµ›è¿›è¡Œç²¾å¿ƒå‰ªè¾‘ï¼Œä»¥ç¡®ä¿æ¯”èµ›ç»“æœç¬¦åˆé¢„æœŸï¼Œå°¤å…¶æ˜¯ç‘å…¸é˜Ÿçš„é˜²å®ˆå¹¶éæ— æ‡ˆå¯å‡»ã€‚\n\nå› æ­¤ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼šè¿™åœºæ¯”èµ›çš„å‰ªè¾‘ä½“ç°äº†å•†ç‘åè®©ç§‘ç ”æ•™ç»ƒæ›¹æ™“ä¸œ', 'source_documents': [Document(page_content='é€šè¿‡è¿œå°„æ‰“è¿›å”¯ä¸€è¿›çƒï¼Œ å°½ç®¡æ…¢åŠ¨ä½œæ˜¾ç¤ºæ˜¯æ‰“åœ¨ç‘å…¸é˜Ÿåå«è…¿ä¸Šå¼¹å°„å…¥ç½‘ï¼Œ ä½†ä»è¿‡ç¨‹åˆ°ç»“æœï¼Œ å‡æ˜¾ç¤ºäº†ç›¸åŒå†…å®¹â€”â€”â€œç‘å…¸é˜Ÿçš„é˜²å®ˆå¹¶éæ— æ‡ˆå¯å‡»â€ã€‚ \u3000\u3000å•†ç‘åè®©ç§‘ç ”æ•™ç»ƒæ›¹æ™“ä¸œç­‰äººå¯¹è¿™åœºæ¯”èµ›è¿›è¡Œç²¾å¿ƒå‰ªè¾‘ï¼Œ å°¤å…¶æ˜¯ç‘å…¸é˜Ÿå¤±çƒä»¥åŠç¾å›½é˜Ÿå½¢æˆæœ‰å¨èƒå°„é—¨çš„ç‰‡æ®µï¼Œ æ›´æ˜¯è¢«æ”¾å¤§è¿›è¡ŒåŠ¨ä½œåˆ†è§£ï¼Œ', metadata={'source': '1.txt', 'score': 983}, _lc_kwargs={'page_content': 'é€šè¿‡è¿œå°„æ‰“è¿›å”¯ä¸€è¿›çƒï¼Œ', 'metadata': {'source': '1.txt', 'score': 983}})]}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> chatgpt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2023/07/05/top-down-lun-wen-fen-xi/"/>
      <url>/2023/07/05/top-down-lun-wen-fen-xi/</url>
      
        <content type="html"><![CDATA[<h5 id="MIXUPæŠ€æœ¯å¯¹æ¨¡å‹çš„å½±å“"><a href="#MIXUPæŠ€æœ¯å¯¹æ¨¡å‹çš„å½±å“" class="headerlink" title="MIXUPæŠ€æœ¯å¯¹æ¨¡å‹çš„å½±å“"></a>MIXUPæŠ€æœ¯å¯¹æ¨¡å‹çš„å½±å“</h5><pre class="line-numbers language-none"><code class="language-none">if mixup_active:        mixup_fn = Mixup(            mixup_alpha=args.mixup, cutmix_alpha=args.cutmix, cutmix_minmax=args.cutmix_minmax,            prob=args.mixup_prob, switch_prob=args.mixup_switch_prob, mode=args.mixup_mode,            label_smoothing=args.smoothing, num_classes=args.nb_classes)                        è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªåä¸º"mixup_fn"çš„Mixupå¯¹è±¡ï¼Œå¦‚æœ"mixup_active"å˜é‡ä¸ºTrueï¼Œåˆ™ä½¿ç”¨Mixupæ–¹æ³•å¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ•°æ®å¢å¼ºï¼Œè¿™æ˜¯ä¸€ç§åœ¨è®­ç»ƒæœŸé—´å¢å¼ºæ¨¡å‹é²æ£’æ€§çš„æŠ€æœ¯ã€‚å…·ä½“æ¥è¯´ï¼ŒMixupæ–¹æ³•ä½¿ç”¨éšæœºçš„çº¿æ€§ç»„åˆå°†ä¸¤ä¸ªä¸åŒçš„è¾“å…¥æ ·æœ¬æ··åˆåœ¨ä¸€èµ·ï¼Œä»è€Œç”Ÿæˆä¸€ä¸ªæ–°çš„æ ·æœ¬ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä»¥ä¸‹å…¬å¼è¡¨ç¤ºï¼šnew_x = lam * x_i + (1 - lam) * x_jnew_y = lam * y_i + (1 - lam) * y_jå…¶ä¸­ï¼Œx_iå’Œy_iæ˜¯ç¬¬ä¸€ä¸ªè¾“å…¥æ ·æœ¬çš„ç‰¹å¾å’Œæ ‡ç­¾ï¼Œx_jå’Œy_jæ˜¯ç¬¬äºŒä¸ªè¾“å…¥æ ·æœ¬çš„ç‰¹å¾å’Œæ ‡ç­¾ï¼Œlamæ˜¯ä¸€ä¸ªä»‹äº[0, 1]ä¹‹é—´çš„éšæœºæ•°ï¼Œç”¨äºæ§åˆ¶ä¸¤ä¸ªè¾“å…¥æ ·æœ¬çš„æ··åˆç¨‹åº¦ã€‚Mixupæ–¹æ³•å¯ä»¥å¸®åŠ©æ¨¡å‹å­¦ä¹ åˆ°æ›´é²æ£’çš„ç‰¹å¾è¡¨ç¤ºï¼Œå¹¶å¯ä»¥é™ä½è¿‡æ‹Ÿåˆçš„é£é™©ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒMixupå¯¹è±¡çš„å‚æ•°ç”±ä¸€ç³»åˆ—å‘½ä»¤è¡Œå‚æ•°(args)æ§åˆ¶ï¼ŒåŒ…æ‹¬"mixup_alpha"ã€"cutmix_alpha"ã€"cutmix_minmax"ã€"prob"ã€"switch_prob"ã€"mode"ã€"label_smoothing"å’Œ"num_classes"ã€‚è¿™äº›å‚æ•°ç”¨äºæŒ‡å®šMixupæ–¹æ³•çš„å…·ä½“å®ç°æ–¹å¼ï¼Œä¾‹å¦‚æ··åˆæ¯”ä¾‹ã€å‰ªåˆ‡æ¯”ä¾‹ã€æ ‡ç­¾å¹³æ»‘ã€æ··åˆæ¨¡å¼ç­‰ç­‰ã€‚è¿™ä¸ªMixupå¯¹è±¡å¯ä»¥ä½œä¸ºæ•°æ®å¢å¼ºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå¯¹è®­ç»ƒæ•°æ®è¿›è¡Œå¤„ç†ï¼Œä»è€Œæé«˜æ¨¡å‹çš„æ€§èƒ½å’Œé²æ£’æ€§ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="å…¨è¿æ¥å±‚çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œæ•°æ®ç»´åº¦ä¼šå˜åŒ–å—"><a href="#å…¨è¿æ¥å±‚çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œæ•°æ®ç»´åº¦ä¼šå˜åŒ–å—" class="headerlink" title="å…¨è¿æ¥å±‚çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œæ•°æ®ç»´åº¦ä¼šå˜åŒ–å—"></a>å…¨è¿æ¥å±‚çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œæ•°æ®ç»´åº¦ä¼šå˜åŒ–å—</h5><pre class="line-numbers language-none"><code class="language-none">å…¨è¿æ¥å±‚æ˜¯ç¥ç»ç½‘ç»œä¸­å¸¸ç”¨çš„ä¸€ç§å±‚ï¼Œä¹Ÿç§°ä¸ºçº¿æ€§å±‚æˆ–å¯†é›†è¿æ¥å±‚ï¼ˆDense Layerï¼‰ã€‚å…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„ç‰¹å¾å‘é‡è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œå¹¶æ·»åŠ åç½®é¡¹ï¼Œä»è€Œç”Ÿæˆæ–°çš„ç‰¹å¾å‘é‡ã€‚å…·ä½“æ¥è¯´ï¼Œå…¨è¿æ¥å±‚çš„è¾“å…¥ä¸ºä¸€ä¸ªå‘é‡æˆ–çŸ©é˜µï¼Œå…¶ä¸­å‘é‡å¯¹åº”äºå•ä¸ªæ ·æœ¬çš„ç‰¹å¾å‘é‡ï¼ŒçŸ©é˜µå¯¹åº”äºå¤šä¸ªæ ·æœ¬çš„ç‰¹å¾å‘é‡ã€‚å…¨è¿æ¥å±‚çš„è¾“å‡ºä¹Ÿæ˜¯ä¸€ä¸ªå‘é‡æˆ–çŸ©é˜µï¼Œå…¶ç»´åº¦ç”±å…¨è¿æ¥å±‚ä¸­çš„ç¥ç»å…ƒæ•°é‡å†³å®šã€‚åœ¨å…¨è¿æ¥å±‚ä¸­ï¼Œæ¯ä¸ªç¥ç»å…ƒä¸è¾“å…¥å‘é‡ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æœ‰è¿æ¥ï¼Œå› æ­¤å¯ä»¥æ•æ‰è¾“å…¥å‘é‡ä¸­çš„æ‰€æœ‰ç‰¹å¾ä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆæ–°çš„ç‰¹å¾è¡¨ç¤ºã€‚åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œå…¨è¿æ¥å±‚é€šå¸¸ç”¨äºå°†ä½çº§ç‰¹å¾è½¬æ¢ä¸ºé«˜çº§ç‰¹å¾ï¼Œå¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›å’Œåˆ†ç±»æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾åƒåˆ†ç±»ä»»åŠ¡ä¸­ï¼Œå…¨è¿æ¥å±‚å¯ä»¥å°†å·ç§¯å±‚ä¸­æå–çš„ç©ºé—´ç‰¹å¾å’Œé€šé“ç‰¹å¾è¿›è¡Œç»„åˆï¼Œç”Ÿæˆæ›´å…·æœ‰åˆ¤åˆ«åŠ›çš„ç‰¹å¾è¡¨ç¤ºï¼Œä»è€Œæé«˜æ¨¡å‹çš„åˆ†ç±»å‡†ç¡®ç‡ã€‚åœ¨å…¨è¿æ¥å±‚ä¸­ï¼Œæ•°æ®çš„ç»´åº¦é€šå¸¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœå…¨è¿æ¥å±‚çš„è¾“å…¥æ˜¯ä¸€ä¸ªå¤§å°ä¸º(batch_size, input_dim)çš„çŸ©é˜µï¼Œå…¶ä¸­batch_sizeè¡¨ç¤ºæ‰¹æ¬¡å¤§å°ï¼Œinput_dimè¡¨ç¤ºè¾“å…¥ç‰¹å¾å‘é‡çš„ç»´åº¦ï¼Œè€Œå…¨è¿æ¥å±‚åŒ…å«nä¸ªç¥ç»å…ƒï¼Œé‚£ä¹ˆå…¨è¿æ¥å±‚çš„è¾“å‡ºå°†æ˜¯ä¸€ä¸ªå¤§å°ä¸º(batch_size, n)çš„çŸ©é˜µï¼Œå…¶ä¸­æ‰¹æ¬¡å¤§å°batch_sizeä¸å˜ï¼Œè€Œè¾“å‡ºç»´åº¦å˜ä¸ºnã€‚å› æ­¤ï¼Œå…¨è¿æ¥å±‚çš„ä½œç”¨ä¸ä»…æ˜¯ç”Ÿæˆæ–°çš„ç‰¹å¾è¡¨ç¤ºï¼ŒåŒæ—¶ä¹Ÿæ¶‰åŠåˆ°æ•°æ®çš„ç»´åº¦å˜æ¢ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="çº¿æ€§å±‚ä»£ç åˆ†æ"><a href="#çº¿æ€§å±‚ä»£ç åˆ†æ" class="headerlink" title="çº¿æ€§å±‚ä»£ç åˆ†æ"></a>çº¿æ€§å±‚ä»£ç åˆ†æ</h5><pre class="line-numbers language-none"><code class="language-none">class Decode_Block(nn.Module):    def __init__(self, inplanes):        super().__init__()        self.linear = nn.Linear(inplanes, inplanes, bias=False)        self.linear2 = nn.Linear(inplanes, inplanes, bias=False)    def forward(self, x):        x = self.linear(x)        out = self.linear2(x)        return x, outç»è¿‡è¿™ä¸ªå±‚ï¼Œæ•°æ®çš„ç»´åº¦ä¼šæ€ä¹ˆå˜åŒ–ç»è¿‡Decode_Blockæ¨¡å—çš„å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œè¾“å…¥å¼ é‡xçš„ç»´åº¦ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚å…·ä½“æ¥è¯´ï¼Œè¾“å…¥å¼ é‡xçš„ç»´åº¦ä¸º(inplanes,)ï¼Œå…¶ä¸­inplanesè¡¨ç¤ºè¾“å…¥ç‰¹å¾çš„ç»´åº¦ï¼Œä¹Ÿæ˜¯çº¿æ€§å±‚çš„è¾“å…¥ç»´åº¦ã€‚åœ¨æ¨¡å—ä¸­ï¼Œxé¦–å…ˆé€šè¿‡self.linearçº¿æ€§å±‚è¿›è¡Œå˜æ¢ï¼Œå…¶è¾“å‡ºç»´åº¦ä»ä¸º(inplanes,)ï¼Œè¡¨ç¤ºå¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œäº†çº¿æ€§å˜æ¢ã€‚ç„¶åï¼Œxå†æ¬¡é€šè¿‡self.linear2çº¿æ€§å±‚è¿›è¡Œå˜æ¢ï¼Œå…¶è¾“å‡ºç»´åº¦ä»ä¸º(inplanes,)ï¼Œè¡¨ç¤ºå¯¹ä¸Šä¸€å±‚çš„è¾“å‡ºè¿›è¡Œäº†å¦ä¸€æ¬¡çº¿æ€§å˜æ¢ã€‚æ€»ä¹‹ï¼ŒDecode_Blockæ¨¡å—çš„ä½œç”¨æ˜¯å¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œä¸¤æ¬¡çº¿æ€§å˜æ¢ï¼Œè¾“å‡ºä¸¤ä¸ªå¼ é‡xå’Œoutï¼Œå…¶ç»´åº¦å‡ä¸º(inplanes,)ã€‚åœ¨å…·ä½“çš„Transformer decoderä¸­ï¼ŒDecode_Blockæ¨¡å—é€šå¸¸è¢«å¤šæ¬¡å †å åœ¨ä¸€èµ·ï¼Œä»¥æ„æˆå®Œæ•´çš„è§£ç å™¨å±‚ã€‚æ•´ä¸ªè§£ç å™¨å±‚ä¼šæ¥æ”¶æ¥è‡ªç¼–ç å™¨çš„ç‰¹å¾å‘é‡ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºè§£ç åçš„ç‰¹å¾å‘é‡ï¼Œå…¶ç»´åº¦ä¸è¾“å…¥ç‰¹å¾å‘é‡ç›¸åŒã€‚ä½œç”¨æ˜¯ä»€ä¹ˆDecode_Blockæ¨¡å—æ˜¯Transformerä¸­decoderéƒ¨åˆ†çš„åŸºæœ¬æ¨¡å—ä¹‹ä¸€ï¼Œå…¶ä½œç”¨æ˜¯å¯¹ç¼–ç å™¨è¾“å‡ºçš„ç‰¹å¾å‘é‡è¿›è¡Œè§£ç ï¼Œå³å°†ç¼–ç å™¨çš„è¾“å‡ºç‰¹å¾å‘é‡è½¬æ¢ä¸ºç›®æ ‡åºåˆ—æˆ–ç›®æ ‡ç‰¹å¾å‘é‡ã€‚å…·ä½“æ¥è¯´ï¼ŒDecode_Blockæ¨¡å—é€šè¿‡ä¸¤ä¸ªçº¿æ€§å±‚å¯¹è¾“å…¥ç‰¹å¾å‘é‡è¿›è¡Œä¸¤æ¬¡éçº¿æ€§å˜æ¢ï¼Œå¢å¼ºäº†ç‰¹å¾å‘é‡çš„è¡¨è¾¾èƒ½åŠ›ï¼Œä½¿å…¶æ›´å®¹æ˜“è¢«æ¨¡å‹æ‰€ç†è§£å’Œåˆ©ç”¨ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªçº¿æ€§å±‚å¯ä»¥çœ‹ä½œæ˜¯è‡ªæ³¨æ„åŠ›å±‚ï¼Œç”¨äºè®¡ç®—è¾“å…¥ç‰¹å¾å‘é‡ä¸­ä¸åŒä½ç½®ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œä»è€Œæ•æ‰è¾“å…¥ç‰¹å¾å‘é‡ä¹‹é—´çš„å…³ç³»ã€‚ç¬¬äºŒä¸ªçº¿æ€§å±‚åˆ™å¯ä»¥çœ‹ä½œæ˜¯å‰é¦ˆç¥ç»ç½‘ç»œï¼Œç”¨äºè¿›ä¸€æ­¥æ˜ å°„è¾“å…¥ç‰¹å¾å‘é‡çš„è¡¨ç¤ºï¼Œä»è€Œæ›´å¥½åœ°é€‚åº”ç‰¹å®šä»»åŠ¡ã€‚åœ¨Transformer decoderä¸­ï¼Œé€šå¸¸ä¼šå°†å¤šä¸ªDecode_Blockæ¨¡å—å †å åœ¨ä¸€èµ·ï¼Œä»¥æ„æˆå®Œæ•´çš„è§£ç å™¨å±‚ã€‚æ•´ä¸ªè§£ç å™¨å±‚ä¼šæ¥æ”¶æ¥è‡ªç¼–ç å™¨çš„ç‰¹å¾å‘é‡ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºè§£ç åçš„ç‰¹å¾å‘é‡ï¼Œå…¶ç»´åº¦ä¸è¾“å…¥ç‰¹å¾å‘é‡ç›¸åŒï¼Œç”¨äºè¿›è¡Œä¸‹æ¸¸ä»»åŠ¡ï¼Œå¦‚æœºå™¨ç¿»è¯‘ã€æ–‡æœ¬ç”Ÿæˆç­‰ã€‚æ€»ä¹‹ï¼ŒDecode_Blockæ¨¡å—æ˜¯Transformer decoderçš„åŸºæœ¬æ¨¡å—ä¹‹ä¸€ï¼Œå…¶ä½œç”¨æ˜¯å¯¹ç¼–ç å™¨è¾“å‡ºçš„ç‰¹å¾å‘é‡è¿›è¡Œè§£ç ï¼Œå¢å¼ºç‰¹å¾å‘é‡çš„è¡¨è¾¾èƒ½åŠ›ï¼Œä»è€Œæ›´å¥½åœ°é€‚åº”ç‰¹å®šä»»åŠ¡ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="TRANSFORMERä»£ç åˆ†æ"><a href="#TRANSFORMERä»£ç åˆ†æ" class="headerlink" title="TRANSFORMERä»£ç åˆ†æ"></a>TRANSFORMERä»£ç åˆ†æ</h5><pre class="line-numbers language-none"><code class="language-none">def __init__(            self, dim, num_heads, mlp_ratio=4., qkv_bias=False, drop=0., attn_drop=0., init_values=None,            drop_path=0., act_layer=nn.GELU, norm_layer=nn.LayerNorm):        super().__init__()        self.norm1 = norm_layer(dim)        self.attn = Attention(dim, num_heads=num_heads, qkv_bias=qkv_bias, attn_drop=attn_drop, proj_drop=drop)        self.ls1 = LayerScale(dim, init_values=init_values) if init_values else nn.Identity()        # NOTE: drop path for stochastic depth, we shall see if this is better than dropout here        self.drop_path1 = DropPath(drop_path) if drop_path &gt; 0. else nn.Identity()        self.norm2 = norm_layer(dim)        self.mlp = Mlp(in_features=dim, hidden_features=int(dim * mlp_ratio), act_layer=act_layer, drop=drop)        self.ls2 = LayerScale(dim, init_values=init_values) if init_values else nn.Identity()        self.drop_path2 = DropPath(drop_path) if drop_path &gt; 0. else nn.Identity()å®ƒéƒ½æœ‰é‚£äº›å±‚ï¼Œä½œç”¨æ˜¯ä»€ä¹ˆè¿™æ®µä»£ç ä¸­çš„ç±»å®šä¹‰äº†ä¸€ä¸ªåŸºæœ¬çš„Transformeræ¨¡å—ï¼Œå…¶åŒ…æ‹¬äº†å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶å’Œå‰é¦ˆç¥ç»ç½‘ç»œã€‚å…·ä½“æ¥è¯´ï¼Œè¯¥æ¨¡å—åŒ…å«ä»¥ä¸‹å‡ ä¸ªå±‚ï¼š- norm1: LayerNormå±‚ï¼Œç”¨äºå¯¹è¾“å…¥ç‰¹å¾å‘é‡è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ã€‚- attn: Attentionå±‚ï¼Œç”¨äºè®¡ç®—è¾“å…¥ç‰¹å¾å‘é‡ä¸­ä¸åŒä½ç½®ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œä»è€Œæ•æ‰è¾“å…¥ç‰¹å¾å‘é‡ä¹‹é—´çš„å…³ç³»ã€‚- ls1: LayerScaleå±‚ï¼Œç”¨äºå¯¹Attentionå±‚çš„è¾“å‡ºè¿›è¡Œç¼©æ”¾ï¼Œä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸ã€‚- drop_path1: DropPathå±‚ï¼Œç”¨äºå®ç°éšæœºæ·±åº¦å‰ªæï¼Œä»¥æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚- norm2: LayerNormå±‚ï¼Œç”¨äºå¯¹Attentionå±‚çš„è¾“å‡ºè¿›è¡Œå½’ä¸€åŒ–å¤„ç†ã€‚- mlp: Mlpå±‚ï¼Œç”¨äºè¿›ä¸€æ­¥æ˜ å°„Attentionå±‚çš„è¾“å‡ºï¼Œä»è€Œæ›´å¥½åœ°é€‚åº”ç‰¹å®šä»»åŠ¡ã€‚- ls2: LayerScaleå±‚ï¼Œç”¨äºå¯¹Mlpå±‚çš„è¾“å‡ºè¿›è¡Œç¼©æ”¾ï¼Œä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸ã€‚- drop_path2: DropPathå±‚ï¼Œç”¨äºå®ç°éšæœºæ·±åº¦å‰ªæï¼Œä»¥æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚æ€»ä¹‹ï¼Œè¿™ä¸ªTransformeræ¨¡å—åŒ…å«äº†å¤šä¸ªå±‚ï¼Œå…¶ä¸­åŒ…æ‹¬äº†è‡ªæ³¨æ„åŠ›å±‚å’Œå‰é¦ˆç¥ç»ç½‘ç»œå±‚ï¼Œç”¨äºå¯¹è¾“å…¥ç‰¹å¾å‘é‡è¿›è¡Œè¡¨ç¤ºå­¦ä¹ å’Œç‰¹å¾æå–ã€‚è¿™äº›å±‚å¯ä»¥è¢«å †å åœ¨ä¸€èµ·ï¼Œä»¥æ„æˆå®Œæ•´çš„Transformerç¼–ç å™¨æˆ–è§£ç å™¨ï¼Œç”¨äºå¤„ç†åºåˆ—æ•°æ®ã€å›¾åƒæ•°æ®ç­‰ä»»åŠ¡ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="cos-sim-x3D-F-normalize-x-dim-x3D-1-F-normalize-self-prompt-None-â€¦-None-dim-x3D-1-B-N-1"><a href="#cos-sim-x3D-F-normalize-x-dim-x3D-1-F-normalize-self-prompt-None-â€¦-None-dim-x3D-1-B-N-1" class="headerlink" title="cos_sim = F.normalize(x, dim=-1) @ F.normalize(self.prompt[None, â€¦, None], dim=1)  # B, N, 1"></a>cos_sim = F.normalize(x, dim=-1) @ F.normalize(self.prompt[None, â€¦, None], dim=1)  # B, N, 1</h5><pre class="line-numbers language-none"><code class="language-none">è¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯è®¡ç®—è¾“å…¥å¼ é‡ `x` å’Œæ¨¡å‹å‚æ•° `self.prompt` ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå¯¹è¾“å…¥å¼ é‡ `x` è¿›è¡Œäº† L2 å½’ä¸€åŒ–æ“ä½œï¼Œç„¶åå°†å…¶ä¸æ¨¡å‹å‚æ•° `self.prompt` è¿›è¡Œ L2 å½’ä¸€åŒ–åçš„è½¬ç½®çŸ©é˜µç›¸ä¹˜ï¼Œå¾—åˆ°ä¸€ä¸ª BÃ—NÃ—1 çš„è¾“å‡ºå¼ é‡ï¼Œå…¶ä¸­ B æ˜¯è¾“å…¥å¼ é‡çš„æ‰¹æ¬¡å¤§å°ï¼ŒN æ˜¯è¾“å…¥å¼ é‡ä¸­æ¯ä¸ªå‘é‡çš„ç»´åº¦ã€‚åœ¨è¿™é‡Œï¼Œ`F.normalize(x, dim=-1)` çš„ä½œç”¨æ˜¯å¯¹è¾“å…¥å¼ é‡ `x` åœ¨æœ€åä¸€ä¸ªç»´åº¦ä¸Šè¿›è¡Œ L2 å½’ä¸€åŒ–ï¼Œå³å¯¹æ¯ä¸ªå‘é‡è¿›è¡Œ L2 å½’ä¸€åŒ–ï¼Œä½¿å¾—æ¯ä¸ªå‘é‡çš„ L2 èŒƒæ•°ä¸º 1ã€‚è¿™ä¸ªæ“ä½œå¯ä»¥ä½¿å¾—è¾“å…¥å¼ é‡ä¸­çš„å‘é‡æ›´å®¹æ˜“è¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—ï¼Œå› ä¸º L2 å½’ä¸€åŒ–åçš„å‘é‡åœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´ä¸­éƒ½ä½äºå•ä½çƒé¢ä¸Šï¼Œè·ç¦»å¯ä»¥è½¬åŒ–ä¸ºä½™å¼¦ç›¸ä¼¼åº¦ï¼Œæ›´æ˜“äºè®¡ç®—å’Œæ¯”è¾ƒã€‚ç„¶åï¼Œ`F.normalize(self.prompt[None, ..., None], dim=1)` çš„ä½œç”¨æ˜¯å¯¹æ¨¡å‹å‚æ•° `self.prompt` è¿›è¡Œ L2 å½’ä¸€åŒ–ï¼Œå¹¶å°†å…¶æ‰©å±•ä¸ºä¸€ä¸ª BÃ—1Ã—D çš„å¼ é‡ï¼Œå…¶ä¸­ D æ˜¯æ¨¡å‹å‚æ•° `self.prompt` çš„ç»´åº¦ã€‚è¿™ä¸ªæ“ä½œå¯ä»¥ä½¿å¾—æ¨¡å‹å‚æ•° `self.prompt` å¯ä»¥å’Œæ¯ä¸ªè¾“å…¥å‘é‡è¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—ã€‚æœ€åï¼Œ`@` è¿ç®—ç¬¦è¡¨ç¤ºçŸ©é˜µä¹˜æ³•ï¼Œå®ƒå°† L2 å½’ä¸€åŒ–åçš„è¾“å…¥å¼ é‡å’Œè½¬ç½®åçš„ L2 å½’ä¸€åŒ–çš„æ¨¡å‹å‚æ•°è¿›è¡ŒçŸ©é˜µä¹˜æ³•è¿ç®—ï¼Œå¾—åˆ°ä¸€ä¸ª BÃ—NÃ—1 çš„å¼ é‡ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ è¡¨ç¤ºè¾“å…¥å¼ é‡ä¸­çš„ä¸€ä¸ªå‘é‡ä¸æ¨¡å‹å‚æ•°ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>äººé—´è§‚å¯Ÿ</title>
      <link href="/2023/06/30/ren-jian-guan-cha/"/>
      <url>/2023/06/30/ren-jian-guan-cha/</url>
      
        <content type="html"><![CDATA[<h4 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h4><p>ä»å‰æœ‰ä¸€ä¸ªå°ç‹å­ï¼Œ<br>é•¿å¾—ä¿Šç¾åˆæœºçµã€‚<br>ä»–å–œæ¬¢ç©é—¹ï¼Œä¸çˆ±è¯»ä¹¦ï¼Œ<br>å¸¸å¸¸æƒ¹å¾—çš‡å¸ç”Ÿæ°”ã€‚</p><p>çš‡å¸æ˜¯å¤©ä¸Šçš„ç‰å¸ï¼Œ<br>ç»Ÿæ²»ç€å¤©å®«å’Œå¤©åœ°ã€‚<br>ä»–çœ‹ä¸æƒ¯å°ç‹å­çš„è¡Œä¸ºï¼Œ<br>å†³å®šå°†ä»–è´¬åˆ°å‡¡é—´ã€‚</p><p>å°ç‹å­æ¥åˆ°äººé—´ï¼Œ<br>çœ‹åˆ°äº†è®¸å¤šæ–°å¥‡çš„äº‹ç‰©ã€‚<br>ä»–æ¬£å–œåœ°ç©è€ï¼Œ<br>å¿˜è®°äº†å›å¤©ä¸Šã€‚</p><p>å¯æ˜¯ï¼Œäººé—´çš„ç”Ÿæ´»å¹¶ä¸å®¹æ˜“ï¼Œ<br>å°ç‹å­å¼€å§‹æ„Ÿåˆ°å­¤ç‹¬å’Œå›°æƒ‘ã€‚<br>ä»–å¼€å§‹æ€å¿µå¤©å®«çš„ç¾å¥½ï¼Œ<br>å¸Œæœ›èƒ½å¤Ÿå›åˆ°å¤©ä¸Šã€‚</p><p>äºæ˜¯ï¼Œä»–å¼€å§‹åŠªåŠ›è¯»ä¹¦å­¦ä¹ ï¼Œ<br>è®¤çœŸæ€è€ƒäººç”Ÿçš„æ„ä¹‰ã€‚<br>æœ€ç»ˆï¼Œä»–å¾—åˆ°äº†ç‰å¸çš„åŸè°…ï¼Œ<br>å›åˆ°äº†å¤©å®«ï¼Œæˆä¸ºä¸€åå‹¤å¥‹çš„ä»™å­ã€‚</p><p>è´ªç©ä¸åŠ¡æ­£ä¸šçš„äººï¼Œ<br>ç»ˆç©¶éš¾ä»¥å¾—åˆ°çœŸæ­£çš„å¹¸ç¦ã€‚<br>åªæœ‰é€šè¿‡å‹¤å¥‹å’ŒåŠªåŠ›ï¼Œ<br>æ‰èƒ½è·å¾—æˆåŠŸå’Œå¿«ä¹ã€‚</p><h5 id="æŠŠæ¯ä¸€å¤©éƒ½å½“ä½œæœ€åä¸€å¤©ï¼Œæ²¡æœ‰â€æ˜å¤©â€ï¼Œæ°¸è¿œæ²¡æœ‰"><a href="#æŠŠæ¯ä¸€å¤©éƒ½å½“ä½œæœ€åä¸€å¤©ï¼Œæ²¡æœ‰â€æ˜å¤©â€ï¼Œæ°¸è¿œæ²¡æœ‰" class="headerlink" title="æŠŠæ¯ä¸€å¤©éƒ½å½“ä½œæœ€åä¸€å¤©ï¼Œæ²¡æœ‰â€æ˜å¤©â€ï¼Œæ°¸è¿œæ²¡æœ‰"></a>æŠŠæ¯ä¸€å¤©éƒ½å½“ä½œæœ€åä¸€å¤©ï¼Œæ²¡æœ‰â€æ˜å¤©â€ï¼Œæ°¸è¿œæ²¡æœ‰</h5><h5 id="6æœˆ30æ—¥ï¼Œäººé—´è§‚å¯Ÿç¬¬7063æ—¥"><a href="#6æœˆ30æ—¥ï¼Œäººé—´è§‚å¯Ÿç¬¬7063æ—¥" class="headerlink" title="6æœˆ30æ—¥ï¼Œäººé—´è§‚å¯Ÿç¬¬7063æ—¥"></a>6æœˆ30æ—¥ï¼Œäººé—´è§‚å¯Ÿç¬¬7063æ—¥</h5><pre class="line-numbers language-none"><code class="language-none">å°ç‹å­å‡¡èƒè‚‰ä½“ï¼Œè™½æ— å¾€æ—¥ç¥åŠ›ï¼Œç„¶å¤©èµ„èªæ…§ï¼Œé£æµå€œå‚¥ï¼Œå®šåšäººé—´ç¬¬ä¸€æµã€‚æ­¦æ±‰å¤§å­¦è®¡ç®—æœºå­¦é™¢å¤§æ¥¼  æ™´å¤©ä»Šå¤©ä¸»è¦åšäº†æ™ºèƒ½å®¢æœçš„æ¨¡å‹å’ŒçŸ¥è¯†æ•°æ®åº“çš„åˆ›å»ºé˜¶æ®µï¼Œå¤§éƒ¨åˆ†æ—¶é—´åœ¨è®¡ç®—æœºå­¦é™¢å¤§æ¥¼åº¦è¿‡ã€‚ä»Šå¤©æ—©ä¸Šåˆèµ·æ™šäº†ï¼Œä¸»è¦åŸå› è¿˜æ˜¯å› ä¸ºæ˜¨å¤©æ™šä¸Šç©ç‹è€…ç©åˆ°ä¸¤ç‚¹ã€‚å¾…ä¼šæ™šä¸Šæ™šä¸€ç‚¹è¦å»è·‘æ­¥ï¼Œç„¶åå¼€ç»„ä¼šï¼Œè¿›è¡Œä¸‹ä¸€é¡¹ç›®çš„è°ƒç ”å·¥ä½œã€‚ç›®å‰ç§‘ç ”å­˜åœ¨çš„é—®é¢˜è¿˜æ˜¯ä»£ç æ°´å¹³ä¸è¶³ï¼Œä¸èƒ½ä¾èµ–å®éªŒå®¤é‡Œçš„å¤§ä½¬ï¼Œè‡ªåŠ›æ›´ç”Ÿï¼Œåšå¤§åšå¼ºã€‚ä»Šå¤©æ™šä¸Šè¦åœ¨11ç‚¹ç¡è§‰ï¼Œç¡å‰ä¸è¦å–å¤ªå¤šæ°´ã€‚ç„¶åä»Šå¤©æ™šä¸Šç»§ç»­åšæ™ºèƒ½å®¢æœçš„é¡¹ç›®ã€‚æ˜å¤©æ˜¯2023å¹´ä¸‹åŠå¹´ç¬¬ä¸€å¤©äº†ï¼Œè¯·æ‹¿å‡ºåè¶³çš„å‹‡æ°”æ¯…åŠ›ï¼Œä¸æ‰æ­¤ç”Ÿï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="7æœˆ1æ—¥ï¼Œäººé—´è§‚å¯Ÿ7064å¤©"><a href="#7æœˆ1æ—¥ï¼Œäººé—´è§‚å¯Ÿ7064å¤©" class="headerlink" title="7æœˆ1æ—¥ï¼Œäººé—´è§‚å¯Ÿ7064å¤©"></a>7æœˆ1æ—¥ï¼Œäººé—´è§‚å¯Ÿ7064å¤©</h5><pre class="line-numbers language-none"><code class="language-none">æ­¦æ±‰å¤§å­¦ä¿¡æ¯å­¦éƒ¨å›½è½¯C4  æ™´å¤©é—·çƒ­ä»Šå¤©ä¾ç„¶æ˜¯åœ¨å®Œæˆæ™ºèƒ½å®¢æœæœºå™¨äººçš„é¡¹ç›®ï¼Œä½†æ˜¯åœ¨åšé¡¹ç›®çš„æ—¶å€™ä¸å¤Ÿä¸“å¿ƒï¼Œå·¥ä½œä¸å¤Ÿè®¤çœŸï¼Œå¯¼è‡´è¿›åº¦æœ‰äº›æ…¢ï¼Œä¸»è¦åœ¨è®¡ç®—æœºå­¦é™¢å¤§æ¥¼åº¦è¿‡ã€‚ä¸»è¦æ˜¯æƒ³è¦å®ŒæˆMOSSæ¨¡å‹çš„åˆ›å»ºå’ŒçŸ¥è¯†å‘é‡åº“çš„æ·»åŠ æ–‡ä»¶ï¼Œåˆ é™¤å’Œåˆ›å»ºä»¥åŠæ¨¡å‹å‚æ•°çš„è®¾ç½®ï¼Œæš‚æ—¶æœªå®ç°MOSSæ¨¡å‹åˆ›å»ºä»¥åŠæ¨¡å‹çš„å‚æ•°è®¾ç½®ã€‚æ˜¨å¤©æ™šä¸Šç¡æ™šäº†ï¼Œå› ä¸ºå¥–åŠ±ï¼ˆè£‚å¼€äº†ï¼‰ã€‚ä»Šå¤©æ™šä¸Šæ²¡æœ‰è·‘æ­¥ï¼Œæ˜å¤©ä¸€å®šè¦å»å¥èº«æˆ¿ï¼ŒåŠ 3kmã€‚ä»Šå¤©æ™šä¸Šä¸€å®šè¦11ç‚¹ç¡è§‰ï¼Œç„¶åæ˜å¤©æŠŠç›®å‰çš„ä»£ç è°ƒè¯•åˆ°æ²¡æœ‰bugï¼Œå®ç°ç»“åˆæµè§ˆå™¨ä¸Šç½‘åŠŸèƒ½ï¼Œå¹¶ä¸”å¼€å§‹çœ‹é‚£ä¸ªæ³¨æ„åŠ›æœºåˆ¶ã€‚æˆ‘æƒ³æŠŠæˆ‘çš„é¡¹ç›®åšæˆå‰åç«¯ä»Šå¤©æ˜¯2023å¹´7æœˆ1æ—¥å»ºå…šèŠ‚ï¼Œç°åœ¨ä¸å¹´è½»è¿˜ä½•æ—¶å¹´è½»<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="7æœˆ2æ—¥ï¼Œäººé—´è§‚å¯Ÿ7065å¤©"><a href="#7æœˆ2æ—¥ï¼Œäººé—´è§‚å¯Ÿ7065å¤©" class="headerlink" title="7æœˆ2æ—¥ï¼Œäººé—´è§‚å¯Ÿ7065å¤©"></a>7æœˆ2æ—¥ï¼Œäººé—´è§‚å¯Ÿ7065å¤©</h5><pre class="line-numbers language-none"><code class="language-none">æ­¦æ±‰å¤§å­¦æ–‡ç†å­¦éƒ¨æ€»å›¾ä¹¦é¦†A2åŒº æ™´å¤©é—·çƒ­ä»Šå¤©å®è®­æ”¾å‡ä¸€å¤©ï¼Œä»Šå¤©ä¸»è¦å¯¹æ™ºèƒ½å®¢æœæœºå™¨äººåšäº†è°ƒè¯•ï¼Œä½†æ˜¯ååˆ†ä¸è®¤çœŸã€‚é¡¹ç›®è¿›åº¦ç¼“æ…¢ï¼Œè°ƒè¯•äº†ä¸€äº›éƒ¨åˆ†ï¼Œå‘ç°æŸ¥æ‰¾è®¾ç½®æŸ¥æ‰¾æ•°é‡ä¸º1ï¼Œæ¨¡å‹ç›¸åº”é€Ÿåº¦ç›¸å¯¹æ›´å¿«ï¼Œå¥å­å¡«å……é•¿åº¦ä¸º150ï¼Œé€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ã€‚æ•ˆæœè¿˜æœ‰å¾…ç ”ç©¶ï¼Œä»Šå¤©æ™šä¸Šå»äº†å¥èº«æˆ¿ï¼Œè‡ªå·±æ˜¯çœŸçš„èœã€‚æ™šä¸Šçœ‹äº†ç–¯ç‹‚åŸå§‹äººï¼Œæ´»ç€ä¸å®¹æ˜“ï¼Œä¼˜é›…è‡ªç”±åœ°æ´»ç€éœ€è¦æå¤§çš„å‹‡æ°”ã€‚11ç‚¹å·¦å³ï¼Œçªå‘æƒ³å¥–åŠ±ï¼Œè¿˜å¥½æåŠ›å…‹åˆ¶ï¼Œ11ç‚¹å·¦å³å°±å¯ã€‚æ˜å¤©è¦å®Œæˆæ™ºèƒ½å®¢æœæœºå™¨äººçš„äº¤æµæ¨¡å¼ï¼Œä»¥åŠå‰ç«¯å¯¹è¯æ¨¡å‹ï¼Œå‰©ä¸‹å‡ å¤©è¦åšè°ƒè¯•å·¥ä½œã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="7æœˆ3æ—¥ï¼Œäººé—´è§‚å¯Ÿ7066å¤©"><a href="#7æœˆ3æ—¥ï¼Œäººé—´è§‚å¯Ÿ7066å¤©" class="headerlink" title="7æœˆ3æ—¥ï¼Œäººé—´è§‚å¯Ÿ7066å¤©"></a>7æœˆ3æ—¥ï¼Œäººé—´è§‚å¯Ÿ7066å¤©</h5><pre class="line-numbers language-none"><code class="language-none">æ­¦æ±‰å¤§å­¦è®¡ç®—æœºå­¦é™¢å¤§æ¥¼ æ™´å¤©å¾ˆçƒ­ä»Šå¤©åœ¨åšæ™ºèƒ½å®¢æœæœºå™¨äººçš„å‰ç«¯ï¼Œè¿›å±•ä¸æ˜¯å¾ˆé¡ºåˆ©ï¼Œæœ‰äº›ç¼“æ…¢ï¼Œæ€»çš„æ¥è¯´æ˜¯æœ‰äº›æ¦‚å¿µæ€§çš„å†…å®¹ä¸äº†è§£ã€‚ä¸­åˆåƒçš„æ‰‹æŠ“é¥¼å’Œå¯ä¹ã€‚æ™šä¸Šå»è¸¢çƒäº†ï¼Œä¸€ä¸ªè€é»‘æŠŠæˆ‘å˜´æ’å‡ºè¡€äº†ï¼Œä½†é—®é¢˜ä¸å¤§ï¼Œè¿˜æ˜¯æŒºå¼€å¿ƒçš„ï¼Œä½†æ˜¯çƒæŠ€æ˜æ˜¾ä¸‹é™ã€‚ä½“åŠ›è‚ºæ´»é‡æ˜æ˜¾è·Ÿä¸ä¸Šï¼Œæ™šä¸Šæ˜¯åä¸€ç‚¹ç¡è§‰çš„ï¼Œä½†æ˜¯å–æ°´è¿‡å¤šï¼Œç¡çœ è´¨é‡ä¸æ˜¯å¾ˆå¥½ã€‚è¿™ä¸¤å¤©è¦ä¼‘æ¯å¥½ï¼Œé¡¹ç›®æœ€å…³é”®çš„é˜¶æ®µäº†ã€‚è¸¢å®Œçƒå›åˆ°å¯å®¤åˆ·äº†2ä¸ªå°æ—¶æ‰‹æœºã€‚å…»å¥½ç²¾åŠ›ï¼Œä½“åŠ›ï¼Œå¥½å¥½å·¥ä½œï¼ŒåŠ æ²¹ï¼ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="7æœˆ4æ—¥ï¼Œäººé—´è§‚å¯Ÿ7067å¤©"><a href="#7æœˆ4æ—¥ï¼Œäººé—´è§‚å¯Ÿ7067å¤©" class="headerlink" title="7æœˆ4æ—¥ï¼Œäººé—´è§‚å¯Ÿ7067å¤©"></a>7æœˆ4æ—¥ï¼Œäººé—´è§‚å¯Ÿ7067å¤©</h5><pre class="line-numbers language-none"><code class="language-none">æ­¦æ±‰å¤§å­¦å›½è½¯C4 æ™´å¤©å¾ˆçƒ­ä»Šå¤©åœ¨åšæ™ºèƒ½å®¢æœæœºå™¨äººçš„å‰ç«¯éƒ¨åˆ†ï¼Œç›®æ ‡ä¸æ˜¯å¾ˆæ˜ç¡®ï¼Œå¯¼è‡´åšé”™ã€‚æ˜å¤©è¦åŠ æŠŠåŠ²ï¼Œè¿˜è¦æxmç»™çš„ä»»åŠ¡ã€‚ã€‚ä»Šå¤©æ™šä¸Šå¥–åŠ±äº†è‡ªå·±ï¼Œå¾ˆåæ‚”ï¼Œé’æ˜¥ä¸æ˜¯åœ¨åºŠä¸Šæ‰­æ‰­ææï¼Œè€Œæ˜¯è¦åœ¨è‡ªå·±æ“…é•¿çš„é¢†åŸŸå‘å…‰å‘çƒ­ï¼è®°ä½ï¼ŒæŠŠæ¯ä¸€å¤©éƒ½å½“ä½œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="7æœˆ5æ—¥ï¼Œäººé—´è§‚å¯Ÿ7068å¤©"><a href="#7æœˆ5æ—¥ï¼Œäººé—´è§‚å¯Ÿ7068å¤©" class="headerlink" title="7æœˆ5æ—¥ï¼Œäººé—´è§‚å¯Ÿ7068å¤©"></a>7æœˆ5æ—¥ï¼Œäººé—´è§‚å¯Ÿ7068å¤©</h5><pre class="line-numbers language-none"><code class="language-none">æ­¦æ±‰å¤§å­¦è®¡ç®—æœºå­¦é™¢å¤§æ¥¼ å¤©æ°”å¾ˆçƒ­ä»Šå¤©ä¾ç„¶åœ¨åšé¡¹ç›®ï¼Œä½†æ˜¯è¿˜æ˜¯å·¥ä½œä¸è®¤çœŸï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè€æ˜¯å–œæ¬¢åœ¨æœ€åé˜¶æ®µæ¾æ‡ˆï¼Œæƒ³ä¸€æƒ³ï¼Œå‡å¦‚ä½ ä¸¤å¹´å‰çš„6æœˆ8æ—¥æ²¡æœ‰æ‘†çƒ‚ï¼Œä¸­åˆæ²¡æœ‰åˆ·æ‰‹æœºï¼Œç†ç»¼è€ƒè¯•æ²¡æœ‰å‘å‘†ï¼Œè‹±è¯­è€ƒè¯•æ²¡æœ‰åˆ†ç¥ï¼Œä½ ç°åœ¨ä¼šåœ¨å“ªé‡Œï¼Ÿæ²¡æœ‰å¦‚æœï¼Œäººç”Ÿå¾ˆéš¾ï¼Œä½†è¯·åŠªåŠ›ã€‚æ™šä¸Šçš„æ—¶å€™åœ¨æ•™å®¤é‡Œåˆ·äº†ä¸€æ®µæ—¶é—´æ‰‹æœºï¼Œç„¶åæ¥äº†xmçš„ä»»åŠ¡ğŸ˜µ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="7æœˆ6æ—¥ï¼Œäººé—´è§‚å¯Ÿ7069å¤©"><a href="#7æœˆ6æ—¥ï¼Œäººé—´è§‚å¯Ÿ7069å¤©" class="headerlink" title="7æœˆ6æ—¥ï¼Œäººé—´è§‚å¯Ÿ7069å¤©"></a>7æœˆ6æ—¥ï¼Œäººé—´è§‚å¯Ÿ7069å¤©</h5><pre class="line-numbers language-none"><code class="language-none">æ­¦æ±‰å¤§å­¦è®¡ç®—æœºå­¦é™¢å¤§æ¥¼ å¤©æ°”å¾ˆçƒ­ä»Šå¤©æ˜¯é¡¹ç›®å®Œå·¥æœ€åä¸€å¤©ï¼Œä»Šå¤©ä¸Šåˆå®Œæˆäº†top downæºç çš„åˆ†æï¼Œä¸æ˜¯å¾ˆéš¾ï¼Œèƒ½æ„Ÿå—åˆ°è‡ªå·±çš„ä»£ç èƒ½åŠ›åœ¨æå‡ã€‚ä¸‹åˆçš„æ—¶å€™è·‘é€šäº†ä¸€ä¸ªæŸ æª¬çš„æ¨¡å‹ï¼Œåœ¨æœåŠ¡å™¨ä¸Šå®ç°äº†å¾®è°ƒï¼Œä¸­åˆåˆ·äº†æœ¨é±¼çš„ç¼–è¾‘éƒ¨çš„æ•…äº‹ã€‚æ€»çš„æ¥è¯´ä»Šå¤©æ²¡æœ‰æ‘†çƒ‚ã€‚æ˜å¤©é¡¹ç›®éªŒæ”¶ï¼Œä»Šå¤©æ™šä¸Šè¦æœ€åä¸€æ¬¡ä¿®æ”¹ä»£ç ï¼Œå®Œæˆé¡¹ç›®æ— è®ºå¦‚ä½•ï¼Œä»Šå¤©æ™šä¸Šå¿…å»å¥èº«æˆ¿ï¼ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="7æœˆ7æ—¥-7æœˆ14ï¼Œäººé—´è™šåº¦"><a href="#7æœˆ7æ—¥-7æœˆ14ï¼Œäººé—´è™šåº¦" class="headerlink" title="7æœˆ7æ—¥~7æœˆ14ï¼Œäººé—´è™šåº¦"></a>7æœˆ7æ—¥~7æœˆ14ï¼Œäººé—´è™šåº¦</h5><h5 id="7æœˆ15æ—¥ï¼Œäººé—´è§‚å¯Ÿ7070å¤©"><a href="#7æœˆ15æ—¥ï¼Œäººé—´è§‚å¯Ÿ7070å¤©" class="headerlink" title="7æœˆ15æ—¥ï¼Œäººé—´è§‚å¯Ÿ7070å¤©"></a>7æœˆ15æ—¥ï¼Œäººé—´è§‚å¯Ÿ7070å¤©</h5><pre class="line-numbers language-none"><code class="language-none">ä»Šå¤©å¼€å§‹åšç®—æ³•é¢˜ï¼ŒåŠ¨ä¸€ä¸‹è„‘å­<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="7æœˆ16æ—¥ï¼Œäººé—´è§‚å¯Ÿ7071å¤©"><a href="#7æœˆ16æ—¥ï¼Œäººé—´è§‚å¯Ÿ7071å¤©" class="headerlink" title="7æœˆ16æ—¥ï¼Œäººé—´è§‚å¯Ÿ7071å¤©"></a>7æœˆ16æ—¥ï¼Œäººé—´è§‚å¯Ÿ7071å¤©</h5><pre class="line-numbers language-none"><code class="language-none">ä»Šå¤©æ™šä¸Šå»è¸¢çƒäº†ï¼Œå¹³æ—¶æµªè´¹æ—¶é—´æœ‰ç‚¹å¤šã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="7æœˆ17æ—¥ï¼Œäººé—´è§‚å¯Ÿ7072å¤©"><a href="#7æœˆ17æ—¥ï¼Œäººé—´è§‚å¯Ÿ7072å¤©" class="headerlink" title="7æœˆ17æ—¥ï¼Œäººé—´è§‚å¯Ÿ7072å¤©"></a>7æœˆ17æ—¥ï¼Œäººé—´è§‚å¯Ÿ7072å¤©</h5><pre class="line-numbers language-none"><code class="language-none">ä»Šå¤©å®Œå…¨æ˜¯ä¸€å‰¯ä¸åœ¨çŠ¶æ€çš„æ ·å­ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="7æœˆ21ï¼Œäººé—´è§‚å¯Ÿ7076å¤©"><a href="#7æœˆ21ï¼Œäººé—´è§‚å¯Ÿ7076å¤©" class="headerlink" title="7æœˆ21ï¼Œäººé—´è§‚å¯Ÿ7076å¤©"></a>7æœˆ21ï¼Œäººé—´è§‚å¯Ÿ7076å¤©</h5><pre class="line-numbers language-none"><code class="language-none">ä»Šå¤©è¦å®Œæˆtop_downè®ºæ–‡çš„æ”¹è¿›ï¼Œleetcodeåˆ·é¢˜ï¼Œç»§ç»­å­¦ä¹ äººå·¥æ™ºèƒ½<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="7æœˆ24æ—¥ï¼Œäººé—´è§‚å¯Ÿ7079å¤©"><a href="#7æœˆ24æ—¥ï¼Œäººé—´è§‚å¯Ÿ7079å¤©" class="headerlink" title="7æœˆ24æ—¥ï¼Œäººé—´è§‚å¯Ÿ7079å¤©"></a>7æœˆ24æ—¥ï¼Œäººé—´è§‚å¯Ÿ7079å¤©</h5><pre class="line-numbers language-none"><code class="language-none">çªç„¶æ„è¯†åˆ°è‡ªå·±å·²ç»å¿˜è®°å†™å¾ˆå¤šå¤©çš„æ—¥è®°äº†ï¼Œæœ€è¿‘è¦å°½å¿«å®Œæˆè®¡ç®—æœºç½‘ç»œè¯¾ç¨‹è®¾è®¡å’Œæ“ä½œç³»ç»Ÿè¯¾ç¨‹è®¾è®¡ï¼ï¼ï¼è¿½æ±‚å¾—åˆ°ä¹‹æ—¥å³å…¶ç»ˆæ­¢ä¹‹æ—¶ï¼Œå¯»è§…çš„è¿‡ç¨‹äº¦å³å¤±å»çš„è¿‡ç¨‹ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="7æœˆ26æ—¥ï¼Œäººé—´è§‚å¯Ÿ7081å¤©"><a href="#7æœˆ26æ—¥ï¼Œäººé—´è§‚å¯Ÿ7081å¤©" class="headerlink" title="7æœˆ26æ—¥ï¼Œäººé—´è§‚å¯Ÿ7081å¤©"></a>7æœˆ26æ—¥ï¼Œäººé—´è§‚å¯Ÿ7081å¤©</h5><pre class="line-numbers language-none"><code class="language-none">æ²³å—ä¸Šè”¡å¼ é¾™åˆæ‘ä»Šå¤©æ‰“äº†ä¸€å¤©çš„ç‹è€…ï¼Œæœ‰ç‚¹ç–²æƒ«ï¼Œçœ‹åˆ°äº†åˆ«äººçœŸçš„ååˆ†ä¼˜ç§€ï¼Œè‡ªå·±çš„ä¸¤å¹´æœ‰äº›æ··äº†ï¼Œå¾ˆä¼¤å¿ƒã€‚æ°¸è¿œä¸è¦åšå¯¹è‡ªå·±æœ‰å®³çš„äº‹æƒ…ï¼ï¼ä¸€åˆ‡éƒ½ä¼šå¥½çš„ä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ï¼ï¼ï¼å®šä¸ªè®¡åˆ’ï¼Œæ™šä¸Š11ç‚¹ä¹‹å‰ç¡è§‰ï¼Œæ—©ä¸Š6ç‚¹èµ·åºŠï¼ŒåšæŒä¸€ä¸ªæœˆï¼ï¼ï¼7ç‚¹åŠå¼€å§‹å·¥ä½œï¼Œä¸­åˆåˆä¼‘åŠå°æ—¶ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> éšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšç¬” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€æ™Œè´ªæ¬¢</title>
      <link href="/2023/06/23/yi-shang-tan-huan/"/>
      <url>/2023/06/23/yi-shang-tan-huan/</url>
      
        <content type="html"><![CDATA[<p>é˜´é˜³æ€ªæ°”ï¼š</p><ol><li>äººç”Ÿæœ¬å°±äº”é¢œå…­è‰²ï¼Œä½ å´å¡åœ¨äº†é»„è‰²å’Œç»¿è‰²ã€‚</li><li>ç™è›¤èŸ†æ²¾ç‚¹æµ·æ°´ï¼ŒçœŸå½“è‡ªå·±æ˜¯æµ·é²œäº†ã€‚</li><li>å¤šç…§ç…§é•œå­ï¼Œä½ å°±æ˜ç™½å…¶ä¸­çš„åŸå› äº†ã€‚</li><li>ä¸Šå¸å¾€äººé—´æ´’æ»¡æ™ºæ…§ï¼Œå”¯ç‹¬ä½ æ‰“å¼€äº†ä¼ã€‚</li><li>ä½ ä¸€æ¥ï¼Œè¿™ä¸€é”…ç²¥éƒ½ä¸èƒ½è¦äº†ã€‚</li><li>å…¶å®åšäººæŒºæœ‰è¶£çš„ï¼Œä½ ä¸å¦¨è¯•ä¸€è¯•ã€‚</li><li>å°ä¸œè¥¿ï¼Œé•¿çš„æŒºéšæœºçš„ã€‚</li></ol><p>æ‰§å­ä¹‹æ‰‹ï¼Œä¸å­å•è€ï¼š</p><p>é¡¶çº§äº«å—ï¼š</p><ol><li>é«˜äºŒé‚£å¹´ï¼Œè‡ªå·±ç”¨å¾®ç§¯åˆ†æ¨å¯¼å‡ºäº†æµä½“åŠ›å­¦æ–¹ç¨‹ï¼Œåæ¥æŸ¥åˆ°å·²ç»è¢«ç§°ä½œä¼¯åŠªåˆ©æµä½“æ–¹ç¨‹ã€‚é‚£ä¸€ç¬é—´ä¸å…ˆè´¤é½è‚©çš„æ„Ÿè§‰ï¼Œä¸€ç›´è®°åˆ°ç°åœ¨ã€‚</li><li>åšå£«è®ºæ–‡é€šè¿‡çš„é‚£ä¸€ç¬é—´ï¼Œä½ è¦çŸ¥é“ï¼Œä½ äº²æ‰‹æ¨åŠ¨äº†äººç±»çš„å‰è¿›ï¼Œåœ¨è¿™ä¸ªæ–¹å‘ä¸Šï¼Œä½ æ˜¯äººç±»å†å²ä¸Šåˆ°è¾¾è¿™é‡Œçš„ç¬¬ä¸€äººã€‚</li></ol><p>é¸¡æ±¤æ¥å–½:</p><ol><li><p>çœ‹ä¼¼ä¸èµ·æ³¢æ¾œçš„æ—¥å¤ä¸€æ—¥ï¼Œä¸€å®šä¼šåœ¨æŸä¸€å¤©è®©ä½ çœ‹åˆ°åšæŒçš„æ„ä¹‰ï¼Œç©·åˆ™ç‹¬å–„å…¶èº«ï¼Œè¾¾åˆ™å…¼æµå¤©ä¸‹ï¼Œæ²¡æœ‰è°çš„ä¸€ç”Ÿæ˜¯ä¸€å¸†é£é¡ºçš„ï¼Œèµ·èµ·ä¼ä¼è·Œè·Œæ’æ’æ‰æ˜¯å¸¸æœ‰çš„çŠ¶æ€ï¼Œå†è´µçš„ä¸œè¥¿é™¤ä»¥365éƒ½ä¼šå˜å¾—å¾ˆä¾¿å®œã€‚å†™ä½œæ–‡çš„æ—¶å€™è¦åˆ†å¼€å¤´ã€ä¸­é—´ã€ç»“å°¾ï¼Œäººç”Ÿä¹Ÿæ˜¯ï¼Œä»å‡ºç”Ÿå…¥å­¦ã€ä¸‰åè€Œç«‹åˆ°è€äº†å…¥åœŸä¸ºå®‰ï¼Œæ¯ä¸€ä¸ªäººéƒ½æƒ³åŠªåŠ›æ´»æˆè‡ªå·±æƒ³è¦çš„æ ·å­ï¼Œä½ èƒ½ä½œèŒ§è‡ªç¼šå°±èƒ½ç ´èŒ§æˆè¶ï¼Œäººç”Ÿå°±æ˜¯ä¸€åœºè‡ªæˆ‘å®Œå–„çš„ä¿®è¡Œï¼Œè¿™ä¸€åˆ‡çš„è‹¦éš¾å’ŒæŠ˜ç£¨éƒ½æ˜¯å¯¹è‡ªå·±çš„ç£¨ç»ƒï¼Œæ›¾ç»æ‰€æœ‰çš„å“­æ³£å’Œæ‚²æ¬¢å–œä¹ï¼Œéƒ½æ˜¯å¡‘é€ ä¸€ä¸ªæ›´åŠ å®Œç¾çš„è‡ªå·±ã€‚æœ‰å¥è¯æ˜¯è¿™æ ·è¯´çš„ï¼šå¤ªé˜³å‡èµ·æ—¶äº‹ä¸šå’Œå·¥ä½œå°±è¦æŠ•èº«ï¼Œå¤ªé˜³è½ä¸‹æ—¶å°±æ˜¯è‡ªæˆ‘å®Œå–„å¤ç›˜çš„æ—¶å€™ã€‚ä½ è¦ç›¸ä¿¡ï¼Œæ‰€æœ‰çš„äº‹ä¸æ„¿è¿å’Œè‹¦éš¾éƒ½æ˜¯æœªæ¥æƒŠå–œçš„é“ºå«ï¼Œæ— è®ºä½ ç°åœ¨æ··æˆä»€ä¹ˆæ¨¡æ ·ï¼Œéƒ½è¦ç›¸ä¿¡è‡ªå·±å‰é€”æ— é‡ï¼Œç„¶ååŠªåŠ›æ‹¼æï¼Œåƒä¸‡åˆ«è®©æ¸©æ°´ç…®äº†ä½ çš„å°†å†›æ¢¦ï¼Œäººç”Ÿå°±ä¸€æ¬¡ï¼Œåˆ«è®¤è¾“ï¼</p></li><li><p>äººåœ¨å¹´è½»çš„æ—¶å€™å¯ä»¥é€ƒé¿å¾ˆå¤šä¸œè¥¿ï¼Œä½†åœ¨æ‰¿æ‹…è´£ä»»çš„é‚£ä¸€åˆ»ï¼Œä½ å°±æ²¡æœ‰èµ„æ ¼å¹´è½»äº†ï¼Œå·¥ä½œä½ å¾—æœ‰ï¼Œå®¶åº­ä½ å¾—é¡¾ï¼Œå­©å­ä½ å¾—æŠ¤ï¼Œå½¢è±¡ä½ å¾—æ ‘ã€‚åå¹´å‰ï¼Œè¿å¤šæ„å–„æ„Ÿéƒ½è¦æ¸²æŸ“çš„æƒŠå¤©åŠ¨åœ°ï¼Œåå¹´åï¼Œè¶Šç—›è¶Šä¸åŠ¨å£°è‰²ï¼Œè¶Šè‹¦è¶Šä¿æŒæ²‰é»˜ã€‚ä¸ä¹°æ¡‚èŠ±åŒè½½é…’ï¼Œç»ˆä¸ä¼¼ï¼Œå°‘å¹´æ¸¸ï¼Œæ—¶é—´ç£¨å»äº†å¹´å°‘è½»ç‹‚ï¼Œä¹Ÿæ¸æ¸æ²‰æ·€äº†å†·æš–è‡ªçŸ¥ã€‚å»åšå’Œä½ å¹´é¾„ç›¸åŒ¹é…çš„äº‹ï¼Œè¿™å«è´£ä»»ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªäººæ´»ç€çš„ä»·å€¼ã€‚é£æ™¯ä¾æ—§åœ¨ï¼Œäººå·²éå°‘å¹´ã€‚</p></li><li><p>è¿™äº›å¹´ä½ å¯èƒ½ç»å†äº†äººç”Ÿçš„è‡³æš—æ—¶åˆ»ï¼Œä¹Ÿè®¸æ»¡æ˜¯å¿ƒé…¸ï¼Œä¹Ÿè®¸ç–²æƒ«ä¸å ªï¼Œä¹Ÿè®¸å¾ˆå¤šé—æ†¾ã€‚ä½†è¯·ä½ æ‰¾åˆ°ä¸€ä¸ªç›®æ ‡ï¼ŒåŠ¡å¿…åšæŒä¸‹å»ï¼Œåƒç™¾æ¬¡çš„ç«™èµ·æ¥ã€‚é‚£äº›å¸¦ç€æ™¨é—´çš„å¯‚é™ï¼Œä¸çœ çš„æ˜Ÿå…‰ï¼Œå­¤å†›å¥‹æˆ˜çš„æ¸…é†’ã€‚ä½ è‹¥å†³å®šç¿çƒ‚ï¼Œé‚£ä¹ˆå±±æ— é®ï¼Œæµ·æ— æ ï¼Œå…‰æ€»ä¼šæ’’åœ¨ä½ çš„èº«ä¸Šã€‚å°½ç®¡çœ¼ä¸‹ååˆ†è‰°éš¾ï¼Œä½†æ—¥åè¿™æ®µç»å†ï¼Œè¯´ä¸å®šä¼šå¼€èŠ±ç»“æœï¼Œæˆ‘ä»¬ç»ˆå…¶ä¸€ç”Ÿï¼Œå¹¶ä¸æ˜¯ä¸ºäº†æ»¡è¶³æ‰€æœ‰äººã€‚åªè¦ä½ å–œæ¬¢ï¼Œæ¯ä¸€ç§’éƒ½æ˜¯è±†è”»å¹´åï¼Œæˆ‘ä»¬ä¸ç”¨æ´»åœ¨ä»–äººçš„è¨€è¯­ä¹‹ä¸‹ï¼Œå¤–ç•Œçš„å£°éŸ³åªæ˜¯å‚è€ƒã€‚å±±æœ‰é¡¶å³°ï¼Œæ¹–æœ‰å½¼å²¸ã€‚åœ¨äººç”Ÿæ¼«æ¼«é•¿è·¯ä¸­ï¼Œä¸‡ç‰©çš†æœ‰å›è½¬ï¼Œå½“æˆ‘ä»¬ä»»åŠ¡ä½™å‘³è‹¦æ¶©ï¼Œè¯·ä½ ç›¸ä¿¡ä¸€åˆ‡çš†æœ‰å›ç”˜ã€‚å‘æœªæ¥å¼ æœ›çš„æ—¶å…‰ï¼Œä¹Ÿè®¸å­¤ç‹¬è€Œæ¼«é•¿ï¼ŒåŠªåŠ›è¿‡åå›äº‹æ™´æœ—ï¼Œå°½ç®¡èµ°ï¼Œèµ°åˆ°ç¯ç«é€šæ˜ï¼Œèµ°åˆ°æ˜¥æš–èŠ±å¼€ï¼Œèµ°åˆ°è‹¦å°½ç”˜æ¥ï¼Œæˆ‘ä»¬ç»ˆå°†æˆä¸ºæ›´å¥½åœ°è‡ªå·±ã€‚åœ¨è‹¦éš¾çš„æ—¶å€™åˆ«å¿˜è®°äº†ï¼Œç»™è‡ªå·±ç‚¹ç‡ƒä¸€ç›åå«å¸Œæœ›çš„ç¯ï¼Œç”¨å°½å…¨åŠ›ï¼Œè¿‡å®Œè¿™å¹³å‡¡ä½†ä¸å¹³åº¸çš„ä¸€ç”Ÿã€‚</p></li><li><p>çˆ±è‡ªå·±çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œç»™è‡ªå·±ä¸€ç‚¹æ—¶é—´å§ï¼Œå¥½å¥½çš„ç¼“ä¸€ç¼“ï¼Œç„¶åå°±å¥½å¥½çˆ±è‡ªå·±ï¼ŒæŠŠæœŸæœ›é™ä½ï¼ŒæŠŠä¾èµ–å˜å°‘ï¼Œæˆ‘ç›¸ä¿¡ä½ ä¸€å®šä¼šè¿‡çš„å¾ˆå¥½ã€‚ä½ è¦æ´»ç€è‡ªå·±çš„ä¸–ç•Œé‡Œï¼Œè¿™çŸ­æš‚çš„ä¸€ç”Ÿè¦ä¸ºè‡ªå·±è€Œæ´»ï¼Œå»ç»å†å»åæ‚”å»æ”¹å˜ï¼Œä¸è¦è¢«åˆ«äººå·¦å³ï¼Œå‹‡æ•¢çš„å»å°è¯•ä¸€åˆ‡ã€‚æƒ³è¡¨ç™½å°±è¡¨ç™½ï¼Œæƒ³å‘ç…§ç‰‡å°±å‘ç…§ç‰‡ï¼Œæƒ³ç©¿ä»€ä¹ˆå°±ç©¿ä»€ä¹ˆï¼Œæƒ³åšä»€ä¹ˆå°±åšä»€ä¹ˆï¼Œå¹²å˜›éå¾—æ´»åœ¨åˆ«äººçš„å˜´é‡Œå‘¢ã€‚æ´»åœ¨è‡ªå·±çš„ä¸–ç•Œé‡Œï¼Œä¸ä¹ŸæŒºå¥½çš„å—ï¼Œæ€»æœ‰ä¸€å¤©ï¼Œä½ ä¼šå‘ç°ï¼Œèƒ½è®©ä½ é‡æ–°æŒ¯ä½œèµ·æ¥çš„äººï¼Œåªæœ‰ä½ è‡ªå·±ã€‚æ‰€ä»¥åƒä¸‡ä¸è¦å†è‡ªå‘å’Œç„¦è™‘ä¸­ï¼Œåº¦è¿‡è¿™ä¸€ç”Ÿï¼Œä½ è¦å¦ç„¶åœ°æ¥å—ä¸å®Œç¾çš„è‡ªå·±ï¼Œå‹‡æ•¢çš„é¢å¯¹è¿™ä¸ªç¤¾ä¼šï¼Œè¯´å¥å®è¯ï¼Œæ²¡æœ‰äººä¼šåœ¨æ„ä½ ï¼Œå°±åƒä½ æ²¡é‚£ä¹ˆåœ¨æ„åˆ«äººä¸€æ ·ã€‚ä½ åªéœ€è¦å¤§å¤§æ–¹æ–¹åœ°åšè‡ªå·±å°±å¥½äº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬éƒ½æ˜¯äººï¼Œç»ˆç‚¹éƒ½æ˜¯é¢ä¸´æ­»äº¡ï¼Œæ‰€ä»¥åœ¨åªæœ‰ä¸€æ¬¡çš„äººç”Ÿé‡Œï¼Œæˆ‘å¸Œæœ›ä½ æ— è®ºå‡ å²ï¼Œéƒ½å¯ä»¥é¡ºç€è‡ªå·±çš„å¿ƒæ„è€Œæ´»ã€‚</p></li></ol><p>ç†è§£ï¼š</p><ol><li>ä½ å§”å±ˆäº†å¯ä»¥æ‘”é—¨è€Œå‡ºï¼Œå¦ˆå¦ˆå§”å±ˆäº†åªèƒ½åšç€å®¶åŠ¡ï¼Œå·å·æ‰çœ¼æ³ªã€‚ â€”â€”ä¸‰æ¯›</li><li>ä¸è¦è¸©ç€çˆ¶æ¯çš„è‚©è†€çœ‹è¿‡ä¸–é—´çš„ç¹åä¹‹åï¼Œå«Œå¼ƒå®ƒä»¬ä»æœªè¯»ä¹¦è¯†å­—ã€‚ â€”â€”ä½™å</li><li>ä½ è®¨åŒçˆ¶äº²çš„å¹³åº¸ï¼Œæ®Šä¸çŸ¥ï¼Œä»–ä¹Ÿæ›¾æ˜¯æ€€æ£æ¢¦æƒ³çš„å°‘å¹´ã€‚</li><li>äººç”Ÿçš„ä¸‰ç§å¢ƒç•Œï¼šæ¥å—çˆ¶æ¯çš„å¹³å‡¡ï¼Œæ¥å—è‡ªå·±çš„å¹³å‡¡ï¼Œæ¥å—å­å¥³çš„å¹³å‡¡ã€‚ â€”â€”æ¢æ™“å£°</li><li>ä¸€ä¸ªå¥½çš„å®¶åº­ä¸æ˜¯å¤šä¹ˆæ®·å®å¯Œæœ‰ï¼Œè€Œæ˜¯ä¸€ä»£ä¸€ä»£çš„å‘ä¸Šæ‰˜ä¸¾ï¼Œè®©ä¸‹ä¸€ä»£æ›´ä¸Šä¸€å±‚æ¥¼ï¼Œä»£ä»£ç›¸æ‰¿ã€‚</li><li>å½“æœ‰ä¸€å¤©ï¼Œç”Ÿä½ å…»ä½ çš„ä¸¤ä¸ªäººéƒ½èµ°äº†ï¼Œè¿™ä¸–é—´å†ä¹Ÿæ²¡æœ‰äººçœŸå¿ƒåœ°ç–¼ä½ äº†ï¼Œä¹Ÿæ²¡æœ‰äººåœ¨æ„ä½ è¿‡çš„å¥½ä¸å¥½ã€‚çˆ¶æ¯åœ¨ï¼Œäººç”Ÿä¸Šæœ‰æ¥å¾€ï¼Œçˆ¶æ¯å»ï¼Œäººç”Ÿåªå‰©å½’é€”ã€‚  â€”â€”ä¸°å­æº</li><li>æ­¤ç”Ÿæœ€å¤§åœ°é—æ†¾ï¼Œåœ¨çˆ¶æ¯æœ¬è¯¥äº«ç¦åœ°å¹´çºªï¼Œæˆ‘ä»¬ä¾æ—§æ˜¯ä¸ªä¸æˆå™¨çš„æ ·å­ï¼Œä¾æ—§æ˜¯ä»–ä»¬çš„è´Ÿæ‹…å’Œæœ€æ”¾ä¸ä¸‹çš„ç‰µæŒ‚ã€‚</li></ol><h5 id="æ­‡åè¯­"><a href="#æ­‡åè¯­" class="headerlink" title="æ­‡åè¯­"></a>æ­‡åè¯­</h5><p>1.éª‘è‡ªè¡Œè½¦å»é…’å§â€”â€”è¯¥çœçœè¯¥èŠ±èŠ±</p><p>2.å•æ‰€é‡Œæ‰“åœ°é“ºâ€”â€”ç¦»æ­»ä¸è¿œäº†</p><p>3.å°åˆ€å‰²å±è‚¡â€”â€”å¼€äº†çœ¼äº†</p><p>4.çš®è£¤å¥—æ£‰è£¤ï¼Œå¿…å®šæœ‰ç¼˜æ•…</p><p>5.é©´â€”â€”å…‰å±è‚¡æ‹‰ç£¨ï¼Œè½¬ç€åœˆä¸¢äºº</p>]]></content>
      
      
      <categories>
          
          <category> éšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšç¬” </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
